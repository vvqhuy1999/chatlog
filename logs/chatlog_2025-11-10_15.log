[2025-11-10 15:01:14.723] [SUCCESS_DETAILED] [AiComparisonService] ✅ Xử lý thành công yêu cầu song song OpenAI và OpenRouter (tiết kiệm 19982ms)
════════════════════════════ SUCCESS DETAILS ════════════════════════════
▶ CONTEXT:
   - userMessage: 7 ngày qua user tanln có thêm xóa sửa gì trong hệ thống ko?
   - timeSavedMs: 19982
   - openaiEsData: {"took":42,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":9,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[HPTVIETNAM CNHN_Wire_NV address->HPTVIETNAM CNHN_Wire_NV address]dstaddr[hpt-files-srv hpt-dfs-srv->hpt-files-srv hpt-dfs-srv]service[SMB SAMBA->SMB SAMBA ALL_ICMP]","cfgobj":"13","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[all->CNHN_Wire_NV address HPTVIETNAM]","cfgobj":"25","action":"Edit","cfgpath":"firewall.polic... (truncated)
   - aiSummary: {openrouter_esSuccess=true, openai_esSuccess=true, openrouter_totalMs=24037, openai_totalMs=21921, openrouter_searchMs=21, openai_searchMs=61}
   - openrouterEsData: {"took":11,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":9,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[HPTVIETNAM CNHN_Wire_NV address->HPTVIETNAM CNHN_Wire_NV address]dstaddr[hpt-files-srv hpt-dfs-srv->hpt-files-srv hpt-dfs-srv]service[SMB SAMBA->SMB SAMBA ALL_ICMP]","cfgobj":"13","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[all->CNHN_Wire_NV address HPTVIETNAM]","cfgobj":"25","action":"Edit","cfgpath":"firewall.polic... (truncated)
   - sessionId: 250
   - totalProcessingTimeMs: 25976

▶ ES DATA PREVIEW:
   OpenAI ES: {"took":42,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":9,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[HPTVIETNAM CNHN_Wire_NV address->HPTVIETNAM CNHN_Wire_NV address]dstaddr[hpt-files-srv hpt-d... | OpenRouter ES: {"took":11,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":9,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[HPTVIETNAM CNHN_Wire_NV address->HPTVIETNAM CNHN_Wire_NV add... (preview truncated)

▶ ES DATA (FULL, truncated):
   OpenAI Data: {"took":42,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":9,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[HPTVIETNAM CNHN_Wire_NV address->HPTVIETNAM CNHN_Wire_NV address]dstaddr[hpt-files-srv hpt-dfs-srv->hpt-files-srv hpt-dfs-srv]service[SMB SAMBA->SMB SAMBA ALL_ICMP]","cfgobj":"13","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[all->CNHN_Wire_NV address HPTVIETNAM]","cfgobj":"25","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:20:38.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[HPTVIETNAM->HPTVIETNAM CNHN_Wire_NV address]dstaddr[HPT_CORE_SERVERs ERP mail.hpt.vn faceidweb->HPT_CORE_SERVERs ERP mail.hpt.vn faceidweb]","cfgobj":"11","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482038000... (truncated)
   OpenRouter Data: {"took":11,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":9,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[HPTVIETNAM CNHN_Wire_NV address->HPTVIETNAM CNHN_Wire_NV address]dstaddr[hpt-files-srv hpt-dfs-srv->hpt-files-srv hpt-dfs-srv]service[SMB SAMBA->SMB SAMBA ALL_ICMP]","cfgobj":"13","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[all->CNHN_Wire_NV address HPTVIETNAM]","cfgobj":"25","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:20:38.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[HPTVIETNAM->HPTVIETNAM CNHN_Wire_NV address]dstaddr[HPT_CORE_SERVERs ERP mail.hpt.vn faceidweb->HPT_CORE_SERVERs ERP mail.hpt.vn faceidweb]","cfgobj":"11","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482038000... (truncated)

▶ AI RESULTS SUMMARY:
   - openrouter_esSuccess: true
   - openai_esSuccess: true
   - openrouter_totalMs: 24037
   - openai_totalMs: 21921
   - openrouter_searchMs: 21
   - openai_searchMs: 61

▶ TIMESTAMP: 2025-11-10T15:01:14.7239566
════════════════════════════ END SUCCESS DETAILS ════════════════════════════

[2025-11-10 15:02:09.243] [SUCCESS_DETAILED] [AiComparisonService] ✅ Xử lý thành công yêu cầu song song OpenAI và OpenRouter (tiết kiệm 22210ms)
════════════════════════════ SUCCESS DETAILS ════════════════════════════
▶ CONTEXT:
   - userMessage: bạn hãy nói chi tiết đã thêm xóa sửa gì
   - timeSavedMs: 22210
   - openaiEsData: {"took":28,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":15,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"kMzJbJoBwPewX2N5EmEW","_score":null,"_source":{"source":{"user":{"name":"NhuongNT"}},"@timestamp":"2025-11-10T15:01:46.000+07:00","fortinet":{"firewall":{"action":"close"}}},"sort":[1762761706000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"kczJbJoBwPewX2N5EmEW","_score":null,"_source":{"@timestamp":"2025-11-10T15:01:46.000+07:00","fortinet":{"firewall":{"action":"client-rst"}}},"sort":[1762761706000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"kszJbJoBwPewX2N5EmEW","_score":null,"_source":{"source":{"user":{"name":"GiangNH"}},"@timestamp":"2025-11-10T15:01:46.000+07:00","fortinet":{"firewall":{"action":"deny"}}},"sort":[1762761706000]},{"_index":".ds-logs-fortinet_fortigate.log-d... (truncated)
   - aiSummary: {openrouter_esSuccess=true, openai_esSuccess=true, openrouter_totalMs=23307, openai_totalMs=27404, openrouter_searchMs=108, openai_searchMs=47}
   - openrouterEsData: {"took":98,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":9,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgobj":"13","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"cfgobj":"25","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:20:38.000+07:00","fortinet... (truncated)
   - sessionId: 250
   - totalProcessingTimeMs: 28501

▶ ES DATA PREVIEW:
   OpenAI ES: {"took":28,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":15,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"kMzJbJoBwPewX2N5EmEW","_score":null,"_source":{"source":{"user":{"name":"NhuongNT"}},"@timestamp":"2025-11-10T15:01:46.000+07:00","fortinet":{"firewall":{"action":"close"}}},"sort":[1762761706000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.... | OpenRouter ES: {"took":98,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":9,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgobj":"13","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546... (preview truncated)

▶ ES DATA (FULL, truncated):
   OpenAI Data: {"took":28,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":15,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"kMzJbJoBwPewX2N5EmEW","_score":null,"_source":{"source":{"user":{"name":"NhuongNT"}},"@timestamp":"2025-11-10T15:01:46.000+07:00","fortinet":{"firewall":{"action":"close"}}},"sort":[1762761706000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"kczJbJoBwPewX2N5EmEW","_score":null,"_source":{"@timestamp":"2025-11-10T15:01:46.000+07:00","fortinet":{"firewall":{"action":"client-rst"}}},"sort":[1762761706000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"kszJbJoBwPewX2N5EmEW","_score":null,"_source":{"source":{"user":{"name":"GiangNH"}},"@timestamp":"2025-11-10T15:01:46.000+07:00","fortinet":{"firewall":{"action":"deny"}}},"sort":[1762761706000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"k8zJbJoBwPewX2N5EmEW","_score":null,"_source":{"@timestamp":"2025-11-10T15:01:46.000+07:00","fortinet":{"firewall":{"action":"accept"}}},"sort":[1762761706000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"lMzJbJoBwPewX2N5EmEW","_score":null,"_source":{"@timestamp":"2025-11-10T15:01:46.000+07:00","fortinet":{"firewall":{"action":"close"}}},"sort":[1762761706000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003"... (truncated)
   OpenRouter Data: {"took":98,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":9,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgobj":"13","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"cfgobj":"25","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:20:38.000+07:00","fortinet":{"firewall":{"cfgobj":"11","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482038000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"vFgcXJoBwPewX2N5UQz6","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:19:06.000+07:00","fortinet":{"firewall":{"cfgobj":"11","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762481946000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"eRMlU5oBwP... (truncated)

▶ AI RESULTS SUMMARY:
   - openrouter_esSuccess: true
   - openai_esSuccess: true
   - openrouter_totalMs: 23307
   - openai_totalMs: 27404
   - openrouter_searchMs: 108
   - openai_searchMs: 47

▶ TIMESTAMP: 2025-11-10T15:02:09.243009
════════════════════════════ END SUCCESS DETAILS ════════════════════════════

[2025-11-10 15:03:03.818] [SUCCESS_DETAILED] [AiComparisonService] ✅ Xử lý thành công yêu cầu song song OpenAI và OpenRouter (tiết kiệm 18473ms)
════════════════════════════ SUCCESS DETAILS ════════════════════════════
▶ CONTEXT:
   - userMessage: đã chỉnh sửa những gì
   - timeSavedMs: 18473
   - openaiEsData: {"took":86,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgobj":"13","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"cfgobj":"25","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:20:38.000+07:00","fortinet":{"firewall":{"cfgobj":"11","cf... (truncated)
   - aiSummary: {openrouter_esSuccess=true, openai_esSuccess=true, openrouter_totalMs=20324, openai_totalMs=23354, openrouter_searchMs=37, openai_searchMs=97}
   - openrouterEsData: {"took":6,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgobj":"13","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"cfgobj":"25","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:20:38.000+07:00","fortinet":{"firewall":{"cfgobj":"11","cfg... (truncated)
   - sessionId: 250
   - totalProcessingTimeMs: 25205

▶ ES DATA PREVIEW:
   OpenAI ES: {"took":86,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgobj":"13","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log... | OpenRouter ES: {"took":6,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgobj":"13","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":"... (preview truncated)

▶ ES DATA (FULL, truncated):
   OpenAI Data: {"took":86,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgobj":"13","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"cfgobj":"25","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:20:38.000+07:00","fortinet":{"firewall":{"cfgobj":"11","cfgpath":"firewall.policy"}}},"sort":[1762482038000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"vFgcXJoBwPewX2N5UQz6","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:19:06.000+07:00","fortinet":{"firewall":{"cfgobj":"11","cfgpath":"firewall.policy"}}},"sort":[1762481946000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"eRMlU5oBwPewX2N5UqTz","_score":null,"_source":{"source":{"user":{"name":"t... (truncated)
   OpenRouter Data: {"took":6,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgobj":"13","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"cfgobj":"25","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:20:38.000+07:00","fortinet":{"firewall":{"cfgobj":"11","cfgpath":"firewall.policy"}}},"sort":[1762482038000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"vFgcXJoBwPewX2N5UQz6","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:19:06.000+07:00","fortinet":{"firewall":{"cfgobj":"11","cfgpath":"firewall.policy"}}},"sort":[1762481946000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"eRMlU5oBwPewX2N5UqTz","_score":null,"_source":{"source":{"user":{"name":"ta... (truncated)

▶ AI RESULTS SUMMARY:
   - openrouter_esSuccess: true
   - openai_esSuccess: true
   - openrouter_totalMs: 20324
   - openai_totalMs: 23354
   - openrouter_searchMs: 37
   - openai_searchMs: 97

▶ TIMESTAMP: 2025-11-10T15:03:03.8182969
════════════════════════════ END SUCCESS DETAILS ════════════════════════════

[2025-11-10 15:07:19.544] [SUCCESS_DETAILED] [AiComparisonService] ✅ Xử lý thành công yêu cầu song song OpenAI và OpenRouter (tiết kiệm 14238ms)
════════════════════════════ SUCCESS DETAILS ════════════════════════════
▶ CONTEXT:
   - userMessage: ip10.4.100.110 truy cập những website nào trong 1 giờ qua
   - timeSavedMs: 14238
   - openaiEsData: {"took":121,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":589,"relation":"eq"},"max_score":null,"hits":[]},"aggregations":{"top_websites":{"doc_count_error_upper_bound":2,"sum_other_doc_count":58,"buckets":[{"key":"www.facebook.com","doc_count":43},{"key":"hptvn.sharepoint.com","doc_count":27},{"key":"ssl.gstatic.com","doc_count":12},{"key":"browser.events.data.microsoft.com","doc_count":8},{"key":"config.extension.grammarly.com","doc_count":7},{"key":"wpa.chat.zalo.me","doc_count":7},{"key":"www.google.com","doc_count":6},{"key":"mobile.events.data.microsoft.com","doc_count":5},{"key":"teams.events.data.microsoft.com","doc_count":5},{"key":"accounts.google.com","doc_count":4}]}}}
   - aiSummary: {openrouter_esSuccess=true, openai_esSuccess=true, openrouter_totalMs=16913, openai_totalMs=16727, openrouter_searchMs=332, openai_searchMs=176}
   - openrouterEsData: {"took":211,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":589,"relation":"eq"},"max_score":null,"hits":[]},"aggregations":{"top_websites":{"doc_count_error_upper_bound":2,"sum_other_doc_count":58,"buckets":[{"key":"www.facebook.com","doc_count":43},{"key":"hptvn.sharepoint.com","doc_count":27},{"key":"ssl.gstatic.com","doc_count":12},{"key":"browser.events.data.microsoft.com","doc_count":8},{"key":"config.extension.grammarly.com","doc_count":7},{"key":"wpa.chat.zalo.me","doc_count":7},{"key":"www.google.com","doc_count":6},{"key":"mobile.events.data.microsoft.com","doc_count":5},{"key":"teams.events.data.microsoft.com","doc_count":5},{"key":"accounts.google.com","doc_count":4}]}}}
   - sessionId: 251
   - totalProcessingTimeMs: 19402

▶ ES DATA PREVIEW:
   OpenAI ES: {"took":121,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":589,"relation":"eq"},"max_score":null,"hits":[]},"aggregations":{"top_websites":{"doc_count_error_upper_bound":2,"sum_other_doc_count":58,"buckets":[{"key":"www.facebook.com","doc_count":43},{"key":"hptvn.sharepoint.com","doc_count":27},{"key":"ssl.gstatic.com","doc_count":12},{"key":"browser.events.data.microsoft.com","doc_count":8},{"key":"config.extension.grammarly.com","doc_co... | OpenRouter ES: {"took":211,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":589,"relation":"eq"},"max_score":null,"hits":[]},"aggregations":{"top_websites":{"doc_count_error_upper_bound":2,"sum_other_doc_count":58,"buckets":[{"key":"www.facebook.com","doc_count":43},{"key":"hptvn.sharepoint.com","doc_count":27},{"key":"ssl.gstatic.com","doc_count":12},{"key":"browser.events.data.microsoft.com","doc_count":8},{"key":"config.... (preview truncated)

▶ ES DATA (FULL, truncated):
   OpenAI Data: {"took":121,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":589,"relation":"eq"},"max_score":null,"hits":[]},"aggregations":{"top_websites":{"doc_count_error_upper_bound":2,"sum_other_doc_count":58,"buckets":[{"key":"www.facebook.com","doc_count":43},{"key":"hptvn.sharepoint.com","doc_count":27},{"key":"ssl.gstatic.com","doc_count":12},{"key":"browser.events.data.microsoft.com","doc_count":8},{"key":"config.extension.grammarly.com","doc_count":7},{"key":"wpa.chat.zalo.me","doc_count":7},{"key":"www.google.com","doc_count":6},{"key":"mobile.events.data.microsoft.com","doc_count":5},{"key":"teams.events.data.microsoft.com","doc_count":5},{"key":"accounts.google.com","doc_count":4}]}}}
   OpenRouter Data: {"took":211,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":589,"relation":"eq"},"max_score":null,"hits":[]},"aggregations":{"top_websites":{"doc_count_error_upper_bound":2,"sum_other_doc_count":58,"buckets":[{"key":"www.facebook.com","doc_count":43},{"key":"hptvn.sharepoint.com","doc_count":27},{"key":"ssl.gstatic.com","doc_count":12},{"key":"browser.events.data.microsoft.com","doc_count":8},{"key":"config.extension.grammarly.com","doc_count":7},{"key":"wpa.chat.zalo.me","doc_count":7},{"key":"www.google.com","doc_count":6},{"key":"mobile.events.data.microsoft.com","doc_count":5},{"key":"teams.events.data.microsoft.com","doc_count":5},{"key":"accounts.google.com","doc_count":4}]}}}

▶ AI RESULTS SUMMARY:
   - openrouter_esSuccess: true
   - openai_esSuccess: true
   - openrouter_totalMs: 16913
   - openai_totalMs: 16727
   - openrouter_searchMs: 332
   - openai_searchMs: 176

▶ TIMESTAMP: 2025-11-10T15:07:19.5446532
════════════════════════════ END SUCCESS DETAILS ════════════════════════════

[2025-11-10 15:08:33.955] [SUCCESS_DETAILED] [AiComparisonService] ✅ Xử lý thành công yêu cầu song song OpenAI và OpenRouter (tiết kiệm -6303ms)
════════════════════════════ SUCCESS DETAILS ════════════════════════════
▶ CONTEXT:
   - userMessage: Dữ liệu của người dùng tanln đã được xóa theo yêu cầu chưa
   - timeSavedMs: -6303
   - openaiEsData: {"took":117,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":null,"hits":[]},"aggregations":{"deletion_verification":{"buckets":[{"key_as_string":"2025-10-21T00:00:00.000Z","key":1761004800000,"doc_count":1,"data_access":{"value":1}}]}}}
   - aiSummary: {openrouter_esSuccess=true, openai_esSuccess=true, openrouter_totalMs=37398, openai_totalMs=14058, openrouter_searchMs=33, openai_searchMs=159}
   - openrouterEsData: {"took":20,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":277,"relation":"eq"},"max_score":null,"hits":[]},"aggregations":{"deletion_verification":{"buckets":[{"key_as_string":"2025-09-03T00:00:00.000Z","key":1756857600000,"doc_count":4,"data_access":{"value":4}},{"key_as_string":"2025-09-04T00:00:00.000Z","key":1756944000000,"doc_count":27,"data_access":{"value":27}},{"key_as_string":"2025-09-05T00:00:00.000Z","key":1757030400000,"doc_count":18,"data_access":{"value":18}},{"key_as_string":"2025-09-08T00:00:00.000Z","key":1757289600000,"doc_count":27,"data_access":{"value":27}},{"key_as_string":"2025-09-10T00:00:00.000Z","key":1757462400000,"doc_count":3,"data_access":{"value":3}},{"key_as_string":"2025-09-11T00:00:00.000Z","key":1757548800000,"doc_count":17,"data_access":{"value":17}},{"key_as_string":"2025-09-15T00:00:00.000Z","key":1757894400000,"doc_count":2,"data_access":{"value":2}},{"key_as_string":"2025-09-16T00:00:00.00... (truncated)
   - sessionId: 251
   - totalProcessingTimeMs: 57759

▶ ES DATA PREVIEW:
   OpenAI ES: {"took":117,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":null,"hits":[]},"aggregations":{"deletion_verification":{"buckets":[{"key_as_string":"2025-10-21T00:00:00.000Z","key":1761004800000,"doc_count":1,"data_access":{"value":1}}]}}} | OpenRouter ES: {"took":20,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":277,"relation":"eq"},"max_score":null,"hits":[]},"aggregations":{"deletion_verification":{"buckets":[{"key_as_string":"2025-09-03T00:00:00.000Z","key":1756857600000,"doc_count":4,"data_access":{"value":4}},{"key_as_string":"2025-09-04T00:00:00.000Z","key":1756944000000,"doc_count":27,"data_access":{"value":27}},{"key_as_string":"2025-09-05T00:00:00.000Z","key":1757030400000,"doc_co...

▶ ES DATA (FULL, truncated):
   OpenAI Data: {"took":117,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":null,"hits":[]},"aggregations":{"deletion_verification":{"buckets":[{"key_as_string":"2025-10-21T00:00:00.000Z","key":1761004800000,"doc_count":1,"data_access":{"value":1}}]}}}
   OpenRouter Data: {"took":20,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":277,"relation":"eq"},"max_score":null,"hits":[]},"aggregations":{"deletion_verification":{"buckets":[{"key_as_string":"2025-09-03T00:00:00.000Z","key":1756857600000,"doc_count":4,"data_access":{"value":4}},{"key_as_string":"2025-09-04T00:00:00.000Z","key":1756944000000,"doc_count":27,"data_access":{"value":27}},{"key_as_string":"2025-09-05T00:00:00.000Z","key":1757030400000,"doc_count":18,"data_access":{"value":18}},{"key_as_string":"2025-09-08T00:00:00.000Z","key":1757289600000,"doc_count":27,"data_access":{"value":27}},{"key_as_string":"2025-09-10T00:00:00.000Z","key":1757462400000,"doc_count":3,"data_access":{"value":3}},{"key_as_string":"2025-09-11T00:00:00.000Z","key":1757548800000,"doc_count":17,"data_access":{"value":17}},{"key_as_string":"2025-09-15T00:00:00.000Z","key":1757894400000,"doc_count":2,"data_access":{"value":2}},{"key_as_string":"2025-09-16T00:00:00.000Z","key":1757980800000,"doc_count":19,"data_access":{"value":19}},{"key_as_string":"2025-09-17T00:00:00.000Z","key":1758067200000,"doc_count":21,"data_access":{"value":21}},{"key_as_string":"2025-09-18T00:00:00.000Z","key":1758153600000,"doc_count":7,"data_access":{"value":7}},{"key_as_string":"2025-09-19T00:00:00.000Z","key":1758240000000,"doc_count":27,"data_access":{"value":27}},{"key_as_string":"2025-09-23T00:00:00.000Z","key":1758585600000,"doc_count":2,"data_access":{"value":2}},{"key_as_... (truncated)

▶ AI RESULTS SUMMARY:
   - openrouter_esSuccess: true
   - openai_esSuccess: true
   - openrouter_totalMs: 37398
   - openai_totalMs: 14058
   - openrouter_searchMs: 33
   - openai_searchMs: 159

▶ TIMESTAMP: 2025-11-10T15:08:33.9550627
════════════════════════════ END SUCCESS DETAILS ════════════════════════════

[2025-11-10 15:09:36.100] [SUCCESS_DETAILED] [AiComparisonService] ✅ Xử lý thành công yêu cầu song song OpenAI và OpenRouter (tiết kiệm 11296ms)
════════════════════════════ SUCCESS DETAILS ════════════════════════════
▶ CONTEXT:
   - userMessage: có ai chỉnh sửa  trong hệ thống trong 7 ngày qua không
   - timeSavedMs: 11296
   - openaiEsData: {"took":7,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:20:38.000+07:00","fortinet":{"firewall":{"action":"Edit... (truncated)
   - aiSummary: {openrouter_esSuccess=true, openai_esSuccess=true, openrouter_totalMs=13039, openai_totalMs=22493, openrouter_searchMs=17, openai_searchMs=23}
   - openrouterEsData: {"took":8,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:20:38.000+07:00","fortinet":{"firewall":{"action":"Edit... (truncated)
   - sessionId: 251
   - totalProcessingTimeMs: 24236

▶ ES DATA PREVIEW:
   OpenAI ES: {"took":7,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.lo... | OpenRouter ES: {"took":8,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index"... (preview truncated)

▶ ES DATA (FULL, truncated):
   OpenAI Data: {"took":7,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:20:38.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482038000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"vFgcXJoBwPewX2N5UQz6","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:19:06.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762481946000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"eRMlU5oBwPewX2N5UqTz","_score":null,"_source":{"source":{"user":{"n... (truncated)
   OpenRouter Data: {"took":8,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:20:38.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482038000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"vFgcXJoBwPewX2N5UQz6","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:19:06.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762481946000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"eRMlU5oBwPewX2N5UqTz","_score":null,"_source":{"source":{"user":{"n... (truncated)

▶ AI RESULTS SUMMARY:
   - openrouter_esSuccess: true
   - openai_esSuccess: true
   - openrouter_totalMs: 13039
   - openai_totalMs: 22493
   - openrouter_searchMs: 17
   - openai_searchMs: 23

▶ TIMESTAMP: 2025-11-10T15:09:36.1000593
════════════════════════════ END SUCCESS DETAILS ════════════════════════════

[2025-11-10 15:28:08.578] [SUCCESS_DETAILED] [AiComparisonService] ✅ Xử lý thành công yêu cầu song song OpenAI và OpenRouter (tiết kiệm 8142ms)
════════════════════════════ SUCCESS DETAILS ════════════════════════════
▶ CONTEXT:
   - userMessage: hãy lấy 1 log mới nhất và phân tích log đó
   - timeSavedMs: 8142
   - openaiEsData: {"took":8,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"MM7hbJoBwPewX2N5A973","_score":null,"_source":{"destination":{"ip":"20.190.148.164"},"rule":{"name":"TO_INTERNET_SDWAN"},"source":{"ip":"10.4.100.74","user":{"name":"LeTTC"}},"@timestamp":"2025-11-10T15:27:56.000+07:00","fortinet":{"firewall":{"srcintfrole":"lan","sessionid":"221316600","action":"ip-conn","dstintfrole":"wan"}},"event":{"action":"ip-conn"}},"sort":[1762763276000]}]}}
   - aiSummary: {openrouter_esSuccess=true, openai_esSuccess=true, openrouter_totalMs=13106, openai_totalMs=16060, openrouter_searchMs=260, openai_searchMs=26}
   - openrouterEsData: {"took":132,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[{"_index":".ds-logs-elastic_agent.metricbeat-default-2025.11.01-000003","_id":"b87gbJoBwPewX2N59tpL","_score":null,"_source":{"agent":{"name":"hpt-logsv-srv","id":"f4af12e8-c55b-4073-8acd-2fada355eb70","type":"filebeat","ephemeral_id":"884dbcfc-65bc-489e-9ab8-80b3b4c53252","version":"8.19.3"},"service.name":"metricbeat","log":{"file":{"inode":"4194308","path":"/opt/Elastic/Agent/data/elastic-agent-8.19.3-c339c5/logs/elastic-agent-20251110-1.ndjson","device_id":"64768"},"offset":5614785,"source":"system/metrics-default"},"elastic_agent":{"id":"f4af12e8-c55b-4073-8acd-2fada355eb70","version":"8.19.3","snapshot":false},"message":"'ca_trusted_fingerprint' set, looking for matching fingerprints","log.logger":"elasticsearch.esclientleg.tls","log.origin":{"file.line":182,"function":"github.com/elastic/elastic-agent-libs/transport... (truncated)
   - sessionId: 251
   - totalProcessingTimeMs: 21024

▶ ES DATA PREVIEW:
   OpenAI ES: {"took":8,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"MM7hbJoBwPewX2N5A973","_score":null,"_source":{"destination":{"ip":"20.190.148.164"},"rule":{"name":"TO_INTERNET_SDWAN"},"source":{"ip":"10.4.100.74","user":{"name":"LeTTC"}},"@timestamp":"2025-11-10T15:27:56.000+07:00","fortinet":{"firewall":{"srcintfrole":"... | OpenRouter ES: {"took":132,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[{"_index":".ds-logs-elastic_agent.metricbeat-default-2025.11.01-000003","_id":"b87gbJoBwPewX2N59tpL","_score":null,"_source":{"agent":{"name":"hpt-logsv-srv","id":"f4af12e8-c55b-4073-8acd-2fada355eb70","type":"filebeat","ephemeral_id":"884dbcfc-65bc-489e-9ab8-80b3b4c53252","version":"8.19.3"},"service... (preview truncated)

▶ ES DATA (FULL, truncated):
   OpenAI Data: {"took":8,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"MM7hbJoBwPewX2N5A973","_score":null,"_source":{"destination":{"ip":"20.190.148.164"},"rule":{"name":"TO_INTERNET_SDWAN"},"source":{"ip":"10.4.100.74","user":{"name":"LeTTC"}},"@timestamp":"2025-11-10T15:27:56.000+07:00","fortinet":{"firewall":{"srcintfrole":"lan","sessionid":"221316600","action":"ip-conn","dstintfrole":"wan"}},"event":{"action":"ip-conn"}},"sort":[1762763276000]}]}}
   OpenRouter Data: {"took":132,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":0,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[{"_index":".ds-logs-elastic_agent.metricbeat-default-2025.11.01-000003","_id":"b87gbJoBwPewX2N59tpL","_score":null,"_source":{"agent":{"name":"hpt-logsv-srv","id":"f4af12e8-c55b-4073-8acd-2fada355eb70","type":"filebeat","ephemeral_id":"884dbcfc-65bc-489e-9ab8-80b3b4c53252","version":"8.19.3"},"service.name":"metricbeat","log":{"file":{"inode":"4194308","path":"/opt/Elastic/Agent/data/elastic-agent-8.19.3-c339c5/logs/elastic-agent-20251110-1.ndjson","device_id":"64768"},"offset":5614785,"source":"system/metrics-default"},"elastic_agent":{"id":"f4af12e8-c55b-4073-8acd-2fada355eb70","version":"8.19.3","snapshot":false},"message":"'ca_trusted_fingerprint' set, looking for matching fingerprints","log.logger":"elasticsearch.esclientleg.tls","log.origin":{"file.line":182,"function":"github.com/elastic/elastic-agent-libs/transport/tlscommon.trustRootCA","file.name":"tlscommon/tls_config.go"},"input":{"type":"filestream"},"component":{"binary":"metricbeat","id":"system/metrics-default","type":"system/metrics","dataset":"elastic_agent.metricbeat"},"@timestamp":"2025-11-10T08:27:50.255Z","ecs":{"version":"8.0.0"},"data_stream":{"namespace":"default","type":"logs","dataset":"elastic_agent.metricbeat"},"host":{"hostname":"hpt-logsv-srv","os":{"kernel":"5.15.0-156-generic","codename":"jammy","name":"Ubuntu","type":"linux","fam... (truncated)

▶ AI RESULTS SUMMARY:
   - openrouter_esSuccess: true
   - openai_esSuccess: true
   - openrouter_totalMs: 13106
   - openai_totalMs: 16060
   - openrouter_searchMs: 260
   - openai_searchMs: 26

▶ TIMESTAMP: 2025-11-10T15:28:08.5784586
════════════════════════════ END SUCCESS DETAILS ════════════════════════════

[2025-11-10 15:29:34.092] [SUCCESS_DETAILED] [AiComparisonService] ✅ Xử lý thành công yêu cầu song song OpenAI và OpenRouter (tiết kiệm 22766ms)
════════════════════════════ SUCCESS DETAILS ════════════════════════════
▶ CONTEXT:
   - userMessage: có ai chỉnh sửa  trong hệ thống trong 7 ngày qua không
   - timeSavedMs: 22766
   - openaiEsData: {"took":117,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:20:38.000+07:00","fortinet":{"firewall":{"action":"Ed... (truncated)
   - aiSummary: {openrouter_esSuccess=true, openai_esSuccess=true, openrouter_totalMs=27162, openai_totalMs=28799, openrouter_searchMs=120, openai_searchMs=131}
   - openrouterEsData: {"took":86,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":n... (truncated)
   - sessionId: 251
   - totalProcessingTimeMs: 33195

▶ ES DATA PREVIEW:
   OpenAI ES: {"took":117,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.... | OpenRouter ES: {"took":86,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"action":"Edi... (preview truncated)

▶ ES DATA (FULL, truncated):
   OpenAI Data: {"took":117,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:20:38.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482038000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"vFgcXJoBwPewX2N5UQz6","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"@timestamp":"2025-11-07T09:19:06.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762481946000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"eRMlU5oBwPewX2N5UqTz","_score":null,"_source":{"source":{"user":{... (truncated)
   OpenRouter Data: {"took":86,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T09:20:38.000+07:00","fortinet":{"firewall":{"action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482038000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"vFgcXJoBwPewX2N5UQz6","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-... (truncated)

▶ AI RESULTS SUMMARY:
   - openrouter_esSuccess: true
   - openai_esSuccess: true
   - openrouter_totalMs: 27162
   - openai_totalMs: 28799
   - openrouter_searchMs: 120
   - openai_searchMs: 131

▶ TIMESTAMP: 2025-11-10T15:29:34.0921528
════════════════════════════ END SUCCESS DETAILS ════════════════════════════

[2025-11-10 15:50:30.093] [SUCCESS_DETAILED] [AiComparisonService] ✅ Xử lý thành công yêu cầu song song OpenAI và OpenRouter (tiết kiệm 15375ms)
════════════════════════════ SUCCESS DETAILS ════════════════════════════
▶ CONTEXT:
   - userMessage: có ai chỉnh sửa  trong hệ thống trong 7 ngày qua không
   - timeSavedMs: 15375
   - aiSummary: {openrouter_esSuccess=true, openai_esSuccess=true, openrouter_totalMs=24583, openai_totalMs=26425, openrouter_searchMs=614, openai_searchMs=622}
   - sessionId: 252
   - totalProcessingTimeMs: 35633

▶ ES DATA PREVIEW:
   OpenAI ES: {"took":218,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"message":"Edit firewall.policy 13","observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgattr... | OpenRouter ES: {"took":218,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"message":"Edit firewall.policy 13","observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T14:29:06.000+07:00",... (preview truncated)

▶ ES DATA (FULL, truncated):
   OpenAI Data: {"took":218,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"message":"Edit firewall.policy 13","observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[HPTVIETNAM CNHN_Wire_NV address->HPTVIETNAM CNHN_Wire_NV address]dstaddr[hpt-files-srv hpt-dfs-srv->hpt-files-srv hpt-dfs-srv]service[SMB SAMBA->SMB SAMBA ALL_ICMP]","cfgobj":"13","ui":"GUI(10.6.99.78)","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"message":"Edit firewall.policy 25","observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[all->CNHN_Wire_NV address HPTVIETNAM]","cfgobj":"25","ui":"GUI(10.6.99.78)","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"message":"Edit firewall.policy 11","observer":{"name":"FTG-... (truncated)
   OpenRouter Data: {"took":218,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"message":"Edit firewall.policy 13","observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[HPTVIETNAM CNHN_Wire_NV address->HPTVIETNAM CNHN_Wire_NV address]dstaddr[hpt-files-srv hpt-dfs-srv->hpt-files-srv hpt-dfs-srv]service[SMB SAMBA->SMB SAMBA ALL_ICMP]","cfgobj":"13","ui":"GUI(10.6.99.78)","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"message":"Edit firewall.policy 25","observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[all->CNHN_Wire_NV address HPTVIETNAM]","cfgobj":"25","ui":"GUI(10.6.99.78)","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"message":"Edit firewall.policy 11","observer":{"name":"FTG-... (truncated)

▶ AI RESULTS SUMMARY:
   - openrouter_esSuccess: true
   - openai_esSuccess: true
   - openrouter_totalMs: 24583
   - openai_totalMs: 26425
   - openrouter_searchMs: 614
   - openai_searchMs: 622

▶ DYNAMIC EXAMPLES (Vector Search):
RELEVANT EXAMPLES FROM KNOWLEDGE BASE
   Mode: VECTOR
   
   Example 1:
   Question: Ai đã chỉnh sửa cấu hình firewall trong 7 ngày qua?
   Content: Ai đã chỉnh sửa cấu hình firewall trong 7 ngày qua?
   Query: {"size":100,"sort":[{"@timestamp":"desc"}],"_source":["@timestamp","source.user.name","message","observer.name","observer.serial_number","fortinet.firewall.action","fortinet.firewall.cfgattr","fortinet.firewall.cfgobj","fortinet.firewall.cfgpath","fortinet.firewall.ui"],"query":{"bool":{"filter":[{"term":{"fortinet.firewall.action":"Edit"}},{"range":{"@timestamp":{"gte":"now-7d"}}}]}}}
   
   Example 2:
   Question: Ai đã thêm sửa xóa cấu hình gì trên thiết bị nào trong 30 ngày qua?
   Content: Ai đã thêm sửa xóa cấu hình gì trên thiết bị nào trong 30 ngày qua?
   Query: {"size":100,"sort":[{"@timestamp":"desc"}],"_source":["@timestamp","source.user.name","message","observer.name","observer.serial_number","fortinet.firewall.action","fortinet.firewall.cfgattr","fortinet.firewall.cfgobj","fortinet.firewall.cfgpath","fortinet.firewall.ui"],"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-30d"}}},{"terms":{"fortinet.firewall.action":["Edit","Add","Delete"]}}]}}}
   
   Example 3:
   Question: Các lần chuyển đổi transport tự động trong 7 ngày qua
   Content: Các lần chuyển đổi transport tự động trong 7 ngày qua
   Query: {"size":50,"sort":[{"@timestamp":"desc"}],"query":{"bool":{"filter":[{"term":{"fortinet.firewall.action":"auto_transport_switch"}},{"range":{"@timestamp":{"gte":"now-7d"}}}]}}}
   
   Example 4:
   Question: Ai đã chỉnh sửa firewall policy trong 30 ngày qua?
   Content: Ai đã chỉnh sửa firewall policy trong 30 ngày qua?
   Query: {"size":100,"sort":[{"@timestamp":"desc"}],"_source":["@timestamp","message","fortinet.firewall.action","fortinet.firewall.cfgpath","fortinet.firewall.cfgobj","fortinet.firewall.cfgattr","source.user.name","observer.name","observer.serial_number","fortinet.firewall.ui"],"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-30d"}}}],"must":[{"match_phrase":{"fortinet.firewall.cfgpath":"firewall.policy"}},{"match_phrase":{"fortinet.firewall.action":"Edit"}}]}}}
   
   Example 5:
   Question: Lịch sử đăng xuất trong 7 ngày qua
   Content: Lịch sử đăng xuất trong 7 ngày qua
   Query: {"size":100,"sort":[{"@timestamp":"desc"}],"_source":["@timestamp","source.user.name","fortinet.firewall.ui"],"query":{"bool":{"filter":[{"term":{"fortinet.firewall.action":"logout"}},{"range":{"@timestamp":{"gte":"now-7d"}}}]}}}
   
   Example 6:
   Question: Thống kê ai thêm/sửa/xóa cấu hình nhiều nhất trong 30 ngày qua?
   Content: Thống kê ai thêm/sửa/xóa cấu hình nhiều nhất trong 30 ngày qua?
   Query: {"size":0,"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-30d"}}},{"terms":{"fortinet.firewall.action":["Edit","Add","Delete"]}}]}},"aggs":{"by_user":{"terms":{"field":"source.user.name","size":20},"aggs":{"by_action":{"terms":{"field":"fortinet.firewall.action","size":3}},"recent_changes":{"top_hits":{"size":5,"sort":[{"@timestamp":"desc"}],"_source":["@timestamp","message","fort...
   (truncated - see full output in console)

▶ TIMESTAMP: 2025-11-10T15:50:30.0934315
════════════════════════════ END SUCCESS DETAILS ════════════════════════════

[2025-11-10 15:51:59.297] [SUCCESS_DETAILED] [AiComparisonService] ✅ Xử lý thành công yêu cầu song song OpenAI và OpenRouter (tiết kiệm 28369ms)
════════════════════════════ SUCCESS DETAILS ════════════════════════════
▶ CONTEXT:
   - userMessage: hãy nói chi tiết về chỉnh sửa
   - timeSavedMs: 28369
   - aiSummary: {openrouter_esSuccess=true, openai_esSuccess=true, openrouter_totalMs=39009, openai_totalMs=32630, openrouter_searchMs=20, openai_searchMs=19}
   - sessionId: 252
   - totalProcessingTimeMs: 43270

▶ ES DATA PREVIEW:
   OpenAI ES: {"took":6,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"message":"Edit firewall.policy 13","observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgattr":... | OpenRouter ES: {"took":6,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"message":"Edit firewall.policy 13","observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T14:29:06.000+07:00","f... (preview truncated)

▶ ES DATA (FULL, truncated):
   OpenAI Data: {"took":6,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"message":"Edit firewall.policy 13","observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[HPTVIETNAM CNHN_Wire_NV address->HPTVIETNAM CNHN_Wire_NV address]dstaddr[hpt-files-srv hpt-dfs-srv->hpt-files-srv hpt-dfs-srv]service[SMB SAMBA->SMB SAMBA ALL_ICMP]","cfgobj":"13","ui":"GUI(10.6.99.78)","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"message":"Edit firewall.policy 25","observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[all->CNHN_Wire_NV address HPTVIETNAM]","cfgobj":"25","ui":"GUI(10.6.99.78)","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"message":"Edit firewall.policy 11","observer":{"name":"FTG-CN... (truncated)
   OpenRouter Data: {"took":6,"timed_out":false,"_shards":{"total":21,"successful":21,"skipped":20,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":null,"hits":[{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"iXQ4XZoBwPewX2N5OS2p","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"message":"Edit firewall.policy 13","observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T14:29:06.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[HPTVIETNAM CNHN_Wire_NV address->HPTVIETNAM CNHN_Wire_NV address]dstaddr[hpt-files-srv hpt-dfs-srv->hpt-files-srv hpt-dfs-srv]service[SMB SAMBA->SMB SAMBA ALL_ICMP]","cfgobj":"13","ui":"GUI(10.6.99.78)","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762500546000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"61gfXJoBwPewX2N5FHHp","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"message":"Edit firewall.policy 25","observer":{"name":"FTG-CNHN","serial_number":"FG121GTK25006437"},"@timestamp":"2025-11-07T09:22:03.000+07:00","fortinet":{"firewall":{"cfgattr":"srcaddr[all->CNHN_Wire_NV address HPTVIETNAM]","cfgobj":"25","ui":"GUI(10.6.99.78)","action":"Edit","cfgpath":"firewall.policy"}}},"sort":[1762482123000]},{"_index":".ds-logs-fortinet_fortigate.log-default-2025.11.01-000003","_id":"jVgdXJoBwPewX2N5tUAm","_score":null,"_source":{"source":{"user":{"name":"tanln"}},"message":"Edit firewall.policy 11","observer":{"name":"FTG-CN... (truncated)

▶ AI RESULTS SUMMARY:
   - openrouter_esSuccess: true
   - openai_esSuccess: true
   - openrouter_totalMs: 39009
   - openai_totalMs: 32630
   - openrouter_searchMs: 20
   - openai_searchMs: 19

▶ DYNAMIC EXAMPLES (Vector Search):
RELEVANT EXAMPLES FROM KNOWLEDGE BASE
   Mode: VECTOR
   
   Example 1:
   Question: Tìm xem user nào chỉnh sửa trong CNHN_ZONE
   Content: Tìm xem user nào chỉnh sửa trong CNHN_ZONE
   Query: {"size":200,"sort":[{"@timestamp":"asc"}],"_source":["@timestamp","source.user.name","source.ip","message","fortinet.firewall.cfgattr"],"query":{"bool":{"filter":[{"exists":{"field":"fortinet.firewall.cfgattr"}},{"match":{"message":"CNHN_ZONE"}}]}}}
   
   Example 2:
   Question: Ai đã chỉnh sửa cấu hình firewall trong 7 ngày qua?
   Content: Ai đã chỉnh sửa cấu hình firewall trong 7 ngày qua?
   Query: {"size":100,"sort":[{"@timestamp":"desc"}],"_source":["@timestamp","source.user.name","message","observer.name","observer.serial_number","fortinet.firewall.action","fortinet.firewall.cfgattr","fortinet.firewall.cfgobj","fortinet.firewall.cfgpath","fortinet.firewall.ui"],"query":{"bool":{"filter":[{"term":{"fortinet.firewall.action":"Edit"}},{"range":{"@timestamp":{"gte":"now-7d"}}}]}}}
   
   Example 3:
   Question: Ai đã chỉnh sửa firewall policy trong 30 ngày qua?
   Content: Ai đã chỉnh sửa firewall policy trong 30 ngày qua?
   Query: {"size":100,"sort":[{"@timestamp":"desc"}],"_source":["@timestamp","message","fortinet.firewall.action","fortinet.firewall.cfgpath","fortinet.firewall.cfgobj","fortinet.firewall.cfgattr","source.user.name","observer.name","observer.serial_number","fortinet.firewall.ui"],"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-30d"}}}],"must":[{"match_phrase":{"fortinet.firewall.cfgpath":"firewall.policy"}},{"match_phrase":{"fortinet.firewall.action":"Edit"}}]}}}
   
   Example 4:
   Question: User tanln đã thêm/sửa/xóa gì trong 30 ngày qua?
   Content: User tanln đã thêm/sửa/xóa gì trong 30 ngày qua?
   Query: {"size":100,"sort":[{"@timestamp":"desc"}],"_source":["@timestamp","source.user.name","message","observer.name","observer.serial_number","fortinet.firewall.action","fortinet.firewall.cfgattr","fortinet.firewall.cfgobj","fortinet.firewall.cfgpath","fortinet.firewall.ui"],"query":{"bool":{"must":[{"match_phrase":{"source.user.name":"tanln"}}],"filter":[{"range":{"@timestamp":{"gte":"now-30d"}}},{"terms":{"fortinet.firewall.action":["Edit","Add","Delete"]}}]}}}
   
   Example 5:
   Question: Ai đã thêm sửa xóa cấu hình gì trên thiết bị nào trong 30 ngày qua?
   Content: Ai đã thêm sửa xóa cấu hình gì trên thiết bị nào trong 30 ngày qua?
   Query: {"size":100,"sort":[{"@timestamp":"desc"}],"_source":["@timestamp","source.user.name","message","observer.name","observer.serial_number","fortinet.firewall.action","fortinet.firewall.cfgattr","fortinet.firewall.cfgobj","fortinet.firewall.cfgpath","fortinet.firewall.ui"],"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-30d"}}},{"terms":{"fortinet.firewall.action":["Edit","Add","Delete"]}}]}}}
   
   Example 6:
   Question: Thay đổi trạng thái interface trong tháng này
   Content: Thay đổi trạng thái interface trong tháng này
   Query: {"size":50,"sort":[{"@timestamp":"desc"}],"query":{"bool":{"filter":[{"term":{"fortinet.firewall.action":"interface-stat-...
   (truncated - see full output in console)

▶ TIMESTAMP: 2025-11-10T15:51:59.2979655
════════════════════════════ END SUCCESS DETAILS ════════════════════════════

