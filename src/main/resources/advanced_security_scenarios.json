[
  {
    "question": "Những IP nào kết nối đều đặn vào lúc ngoài giờ làm việc (18h-8h) trong 30 ngày qua?",
    "keywords": [
      "apt detection",
      "advanced persistent threat",
      "phát hiện mối đe dọa",
      "beacon tín hiệu",
      "c2 command control",
      "command and control",
      "ngoài giờ làm việc",
      "after hours",
      "kết nối liên tục",
      "persistent connection",
      "đều đặn",
      "regular pattern",
      "IP addresses",
      "địa chỉ IP",
      "30 ngày",
      "mô hình dài hạn",
      "long term pattern"
    ],
    "scenario": "PHÁT HIỆN MỐI ĐE DỌA BỀN VỮNG NÂNG CAO (APT DETECTION)",
    "phase": "Giai đoạn 1: Phân tích mô hình dài hạn",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-1d" } } },
            {
              "script": {
                "script": "doc['@timestamp'].value.getHour() < 8 || doc['@timestamp'].value.getHour() > 18"
              }
            }
          ]
        }
      },
      "aggs": {
        "after_hours_ips": {
          "terms": { "field": "destination.ip", "size": 100 },
          "aggs": {
            "daily_pattern": {
              "date_histogram": {
                "field": "@timestamp",
                "calendar_interval": "1d"
              }
            },
            "total_connections": {
              "value_count": { "field": "@timestamp" }
            },
            "unique_days": {
              "cardinality": {
                "script": "doc['@timestamp'].value.dayOfYear"
              }
            },
            "consistency_score": {
              "bucket_script": {
                "buckets_path": {
                  "total": "total_connections",
                  "days": "unique_days"
                },
                "script": "params.days > 20 && params.total > 100 ? 1 : 0"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Phát hiện đường hầm DNS (DNS tunneling): các truy vấn có tên miền dài bất thường?",
    "keywords": [
      "dns tunneling",
      "đường hầm dns",
      "tên miền dài",
      "đánh cắp dữ liệu",
      "c2 communication",
      "command and control",
      "domain length",
      "chiều dài tên miền",
      "unusual domains",
      "tên miền bất thường",
      "data exfiltration",
      "covert channel",
      "kênh bí mật",
      "dns queries",
      "truy vấn dns"
    ],
    "scenario": "PHÁT HIỆN MỐI ĐE DỌA BỀN VỮNG NÂNG CAO (APT DETECTION)",
    "phase": "Giai đoạn 1: Phân tích mô hình dài hạn",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-7d" } } },
            { "term": { "network.protocol": "dns" } },
            {
              "script": {
                "script": "doc['url.domain'].size() > 0 && doc['url.domain'].value.length() > 50"
              }
            }
          ]
        }
      },
      "aggs": {
        "suspicious_domains": {
          "terms": { "field": "url.domain", "size": 50 },
          "aggs": {
            "query_frequency": { "value_count": { "field": "@timestamp" } },
            "unique_sources": { "cardinality": { "field": "source.ip" } },
            "domain_length": {
              "max": {
                "script": "doc['url.domain'].size() > 0 ? doc['url.domain'].value.length() : 0"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Tận dụng công cụ hệ thống (Living off the land): Sử dụng PowerShell, WMI, hoặc công cụ hệ thống bất thường?",
    "keywords": [
      "living off the land",
      "powershell",
      "wmi",
      "fileless malware",
      "tận dụng công cụ",
      "system tools abuse",
      "lạm dụng công cụ hệ thống",
      "công cụ hệ thống",
      "system tools",
      "mã độc không tập tin",
      "certutil",
      "bitsadmin",
      "encoded command",
      "lệnh mã hóa",
      "process execution",
      "thực thi tiến trình"
    ],
    "scenario": "PHÁT HIỆN MỐI ĐE DỌA BỀN VỮNG NÂNG CAO (APT DETECTION)",
    "phase": "Giai đoạn 1: Phân tích mô hình dài hạn",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-7d" } } }],
          "should": [
            { "wildcard": { "process.name": "*powershell*" } },
            { "wildcard": { "process.name": "*wmic*" } },
            { "wildcard": { "process.name": "*certutil*" } },
            { "wildcard": { "process.name": "*bitsadmin*" } },
            { "wildcard": { "process.command_line": "*-EncodedCommand*" } },
            { "wildcard": { "process.command_line": "*DownloadString*" } }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "suspicious_processes": {
          "terms": { "field": "process.name", "size": 20 },
          "aggs": {
            "by_user": { "terms": { "field": "source.user.name" } },
            "command_patterns": { "terms": { "field": "process.command_line" } }
          }
        }
      }
    }
  },
  {
    "question": "Có tài khoản nào đột ngột truy cập nhiều máy chủ trong thời gian ngắn?",
    "keywords": [
      "lateral movement",
      "di chuyển ngang",
      "credential abuse",
      "lạm dụng đăng nhập",
      "truy cập đa máy chủ",
      "multiple servers",
      "thời gian ngắn",
      "short time",
      "đột ngột",
      "sudden access",
      "tài khoản",
      "account",
      "user activity",
      "hoạt động người dùng",
      "suspicious access",
      "truy cập đáng nghi"
    ],
    "scenario": "PHÁT HIỆN DI CHUYỂN NGANG (LATERAL MOVEMENT DETECTION)",
    "phase": "Giai đoạn 2: Phát hiện di chuyển ngang",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "term": { "network.direction": "internal" } }]
        }
      },
      "aggs": {
        "by_user": {
          "terms": { "field": "source.user.name", "size": 50 },
          "aggs": {
            "unique_destinations": {
              "cardinality": { "field": "destination.ip" }
            },
            "destination_details": {
              "terms": { "field": "destination.ip", "size": 20 },
              "aggs": {
                "first_access": { "min": { "field": "@timestamp" } },
                "services_accessed": { "terms": { "field": "destination.port" } }
              }
            },
            "suspicious_spread": {
              "bucket_selector": {
                "buckets_path": { "destinations": "unique_destinations" },
                "script": "params.destinations > 10"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Tấn công Pass-the-Hash: Xác thực từ các workstation bất thường?",
    "keywords": [
      "pass-the-hash",
      "pass the hash",
      "tấn công hash",
      "hash attack",
      "xác thực bất thường",
      "unusual authentication",
      "workstation lạ",
      "unusual workstation",
      "ntlm hash",
      "authentication",
      "xác thực",
      "đăng nhập",
      "login",
      "credential theft",
      "đánh cắp thông tin đăng nhập"
    ],
    "scenario": "PHÁT HIỆN DI CHUYỂN NGANG (LATERAL MOVEMENT DETECTION)",
    "phase": "Giai đoạn 2: Phát hiện di chuyển ngang",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "term": { "event.action": "authentication" } }]
        }
      },
      "aggs": {
        "by_user": {
          "terms": { "field": "source.user.name", "size": 50 },
          "aggs": {
            "workstation_diversity": {
              "cardinality": { "field": "source.hostname" }
            },
            "auth_methods": {
              "terms": { "field": "fortinet.firewall.authmethod" }
            },
            "unusual_workstations": {
              "bucket_selector": {
                "buckets_path": { "diversity": "workstation_diversity" },
                "script": "params.diversity > 5"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Mô hình truy cập dữ liệu thông thường của user 'nguyenvanb' trong 90 ngày qua?",
    "keywords": [
      "insider threat",
      "mối đe dọa nội bộ",
      "mô hình truy cập",
      "access pattern",
      "baseline behavior",
      "hành vi bình thường",
      "normal behavior",
      "user pattern",
      "nguyenvanb",
      "user activity",
      "hoạt động người dùng",
      "data access",
      "truy cập dữ liệu",
      "90 ngày",
      "90 days",
      "thông thường",
      "typical"
    ],
    "scenario": "ĐIỀU TRA INSIDER THREAT - MỐI ĐE DỌA NỘI BỘ",
    "phase": "Giai đoạn 1: Phân tích baseline hành vi",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "term": { "source.user.name": "nguyenvanb" } }, { "range": { "@timestamp": { "gte": "now-90d" } } }]
        }
      },
      "aggs": {
        "access_patterns": {
          "date_histogram": {
            "field": "@timestamp",
            "calendar_interval": "1w"
          },
          "aggs": {
            "resources_accessed": { "terms": { "field": "destination.ip" } },
            "data_volume": { "sum": { "field": "network.bytes" } },
            "access_times": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "1h"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Hoạt động gần đây (30 ngày qua) có bất thường so với mức cơ bản không?",
    "keywords": [
      "deviation analysis",
      "phân tích độ lệch",
      "hoạt động gần đây",
      "recent activity",
      "baseline comparison",
      "so sánh mức cơ bản",
      "bất thường",
      "anomaly",
      "unusual",
      "hành vi thay đổi",
      "behavior change",
      "anomaly detection",
      "phát hiện bất thường",
      "30 ngày",
      "30 days",
      "mức cơ bản",
      "baseline"
    ],
    "scenario": "ĐIỀU TRA INSIDER THREAT - PHÂN TÍCH DEVIATION",
    "phase": "Giai đoạn 2: Phát hiện anomaly",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "term": { "source.user.name": "nguyenvanb" } }, { "range": { "@timestamp": { "gte": "now-30d" } } }]
        }
      },
      "aggs": {
        "recent_vs_baseline": {
          "filters": {
            "filters": {
              "recent": { "range": { "@timestamp": { "gte": "now-30d" } } },
              "baseline": { "range": { "@timestamp": { "gte": "now-120d", "lt": "now-30d" } } }
            }
          },
          "aggs": {
            "avg_daily_activity": {
              "date_histogram": {
                "field": "@timestamp",
                "calendar_interval": "1d"
              }
            },
            "unique_resources": { "cardinality": { "field": "destination.ip" } },
            "data_transfer": { "sum": { "field": "network.bytes" } }
          }
        }
      }
    }
  },
  {
    "question": "Tải xuống hàng loạt (Mass download): Có tải xuống nhiều files trong thời gian ngắn?",
    "keywords": [
      "data exfiltration",
      "đánh cắp dữ liệu",
      "tải xuống hàng loạt",
      "mass download",
      "bulk download",
      "bulk transfer",
      "dữ liệu nhạy cảm",
      "sensitive data",
      "suspicious download",
      "tải xuống đáng nghi",
      "nhiều files",
      "multiple files",
      "thời gian ngắn",
      "short time",
      "download pattern",
      "mô hình tải xuống"
    ],
    "scenario": "ĐIỀU TRA INSIDER THREAT - DATA EXFILTRATION",
    "phase": "Giai đoạn 3: Phân tích exfiltration",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "term": { "source.user.name": "nguyenvanb" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } },
            { "term": { "network.direction": "outbound" } }
          ]
        }
      },
      "aggs": {
        "download_analysis": {
          "date_histogram": {
            "field": "@timestamp",
            "fixed_interval": "1h"
          },
          "aggs": {
            "file_count": { "value_count": { "field": "url.original" } },
            "total_bytes": { "sum": { "field": "source.bytes" } },
            "suspicious_volume": {
              "bucket_selector": {
                "buckets_path": {
                  "files": "file_count",
                  "bytes": "total_bytes"
                },
                "script": "params.files > 100 || params.bytes > 1073741824"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Sử dụng tài khoản đặc quyền: Tài khoản quản trị có được sử dụng đúng mục đích?",
    "keywords": [
      "compliance audit",
      "kiểm toán tuân thủ",
      "tài khoản đặc quyền",
      "privileged account",
      "admin account",
      "administrator",
      "admin usage",
      "sử dụng quản trị",
      "quyền quản trị",
      "admin rights",
      "compliance check",
      "kiểm tra tuân thủ",
      "đúng mục đích",
      "proper usage",
      "gdpr",
      "data protection"
    ],
    "scenario": "COMPLIANCE AUDIT - GDPR & DATA PROTECTION",
    "phase": "Giai đoạn 1: Audit truy cập dữ liệu",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-30d" } } }, { "terms": { "source.user.roles": ["admin", "Administrator", "root"] } }]
        }
      },
      "aggs": {
        "admin_usage": {
          "terms": { "field": "source.user.name", "size": 20 },
          "aggs": {
            "actions_performed": { "terms": { "field": "event.action" } },
            "resources_accessed": { "terms": { "field": "destination.ip" } },
            "time_pattern": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "1h"
              }
            },
            "total_actions": {
              "value_count": { "field": "event.action" }
            },
            "compliance_check": {
              "bucket_script": {
                "buckets_path": { "actions": "total_actions" },
                "script": "params.actions > 0 ? 1 : 0"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Quyền được quên (Right to be forgotten): Dữ liệu của người dùng đã được xóa theo yêu cầu chưa?",
    "keywords": [
      "gdpr compliance",
      "tuân thủ gdpr",
      "quyền được quên",
      "right to be forgotten",
      "data deletion",
      "xóa dữ liệu",
      "delete data",
      "privacy compliance",
      "tuân thủ quyền riêng tư",
      "data removal",
      "loại bỏ dữ liệu",
      "user data",
      "dữ liệu người dùng",
      "deletion verification",
      "xác minh xóa",
      "deleted_user"
    ],
    "scenario": "COMPLIANCE AUDIT - RIGHT TO BE FORGOTTEN",
    "phase": "Giai đoạn 2: Data deletion verification",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-90d" } } }, { "term": { "source.user.name": "deleted_user_123" } }]
        }
      },
      "aggs": {
        "deletion_verification": {
          "date_histogram": {
            "field": "@timestamp",
            "calendar_interval": "1d"
          },
          "aggs": {
            "data_access": { "value_count": { "field": "@timestamp" } },
            "systems_accessed": { "terms": { "field": "destination.ip" } },
            "data_presence": {
              "bucket_selector": {
                "buckets_path": { "access": "data_access" },
                "script": "params.access > 0"
              }
            }
          }
        }
      }
    }
  },

  {
    "question": "Machine nào đầu tiên có signs của file encryption?",
    "keywords": [
      "ransomware detection",
      "phát hiện ransomware",
      "file encryption",
      "mã hóa tập tin",
      "patient zero",
      "bệnh nhân số 0",
      "encryption signs",
      "dấu hiệu mã hóa",
      "ransomware outbreak",
      "bùng phát ransomware",
      "initial infection",
      "nhiễm bệnh ban đầu",
      "đầu tiên",
      "first",
      "machine",
      "máy tính",
      "signs",
      "dấu hiệu",
      "encrypted",
      "mã hóa"
    ],
    "scenario": "RANSOMWARE INCIDENT RESPONSE",
    "phase": "Giai đoạn 1: Patient zero identification",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-48h" } } }, { "terms": { "file.extension": ["encrypted", "locked", "crypt"] } }]
        }
      },
      "aggs": {
        "infection_timeline": {
          "terms": { "field": "host.name", "size": 100 },
          "aggs": {
            "first_encryption": { "min": { "field": "@timestamp" } },
            "encrypted_files": { "value_count": { "field": "file.name" } },
            "file_types": { "terms": { "field": "file.extension" } }
          }
        }
      }
    }
  },

  {
    "question": "SQL Injection attempts: Pattern và success rate?",
    "keywords": [
      "sql injection",
      "tấn công sql injection",
      "web application attack",
      "tấn công ứng dụng web",
      "injection patterns",
      "mô hình injection",
      "success rate",
      "tỷ lệ thành công",
      "database security",
      "bảo mật cơ sở dữ liệu",
      "web security",
      "bảo mật web",
      "sql",
      "injection",
      "database",
      "cơ sở dữ liệu",
      "pattern",
      "mô hình",
      "attempts",
      "nỗ lực",
      "tấn công",
      "attack"
    ],
    "scenario": "WEB APPLICATION SECURITY MONITORING",
    "phase": "Giai đoạn 1: Attack pattern analysis",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "url.query" } }],
          "should": [
            { "wildcard": { "url.query": "*union*select*" } },
            { "wildcard": { "url.query": "*or*1=1*" } },
            { "wildcard": { "url.query": "*drop*table*" } },
            { "wildcard": { "url.query": "*insert*into*" } },
            { "wildcard": { "url.query": "*'*or*'*" } }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "injection_analysis": {
          "terms": { "field": "source.ip", "size": 100 },
          "aggs": {
            "attack_patterns": { "terms": { "field": "url.query" } },
            "response_codes": { "terms": { "field": "http.response.status_code" } },
            "successful_attempts": {
              "filter": { "term": { "http.response.status_code": 200 } }
            },
            "success_rate": {
              "bucket_script": {
                "buckets_path": {
                  "total": "_count",
                  "success": "successful_attempts>_count"
                },
                "script": "params.total > 0 ? (params.success / params.total) * 100 : 0"
              }
            }
          }
        }
      }
    }
  }
]
