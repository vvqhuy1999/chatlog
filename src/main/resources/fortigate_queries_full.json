[
  {
    "question": "Trong 24 giờ qua, những IP nguồn nào bị chặn (deny) nhiều nhất?",
    "keywords": ["IP nguồn", "source ip", "chặn", "block", "deny", "nhiều nhất", "top", "24 giờ qua", "last 24 hours"],
    "query": {
      "size": 0,
      "query": { "bool": { "filter": [{ "term": { "fortinet.firewall.action": "deny" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } },
      "aggs": { "top_blocked_sources": { "terms": { "field": "source.ip", "size": 50 } } }
    }
  },
  {
    "question": "Từ IP nguồn 192.0.2.10, đích nào nhận nhiều bytes nhất trong 24 giờ qua?",
    "keywords": ["IP nguồn", "source ip", "đích", "destination", "bytes", "lưu lượng", "traffic", "nhiều nhất", "top"],
    "query": {
      "size": 0,
      "query": { "bool": { "filter": [{ "term": { "source.ip": "192.0.2.10" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } },
      "aggs": {
        "by_dst": {
          "terms": { "field": "destination.ip", "size": 50, "order": { "bytes_sum": "desc" } },
          "aggs": { "bytes_sum": { "sum": { "field": "network.bytes" } } }
        }
      }
    }
  },
  {
    "question": "Liệt kê các phiên có mức rủi ro IPS cao (crlevel = high/critical) trong 1 ngày qua.",
    "keywords": ["phiên", "session", "rủi ro", "risk", "IPS", "cao", "high", "critical", "crlevel"],
    "query": {
      "size": 50,
      "sort": [{ "@timestamp": "desc" }],
      "_source": [
        "@timestamp",
        "source.ip",
        "destination.ip",
        "fortinet.firewall.attack",
        "fortinet.firewall.crlevel",
        "fortinet.firewall.crscore",
        "rule.name"
      ],
      "query": {
        "bool": {
          "filter": [{ "terms": { "fortinet.firewall.crlevel": ["high", "critical"] } }, { "range": { "@timestamp": { "gte": "now-24h" } } }]
        }
      }
    }
  },
  {
    "question": "Trong 7 ngày qua, các kết nối outbound từ Việt Nam ra nước ngoài là gì?",
    "keywords": ["kết nối", "connection", "outbound", "đi ra", "Việt Nam", "nước ngoài", "foreign"],
    "query": {
      "size": 50,
      "_source": ["@timestamp", "source.ip", "destination.ip", "destination.geo.country_name", "network.bytes", "rule.name"],
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "filter": [{ "term": { "source.geo.country_name": "Vietnam" } }, { "range": { "@timestamp": { "gte": "now-7d" } } }],
          "must_not": [{ "term": { "destination.geo.country_name": "Vietnam" } }]
        }
      }
    }
  },
  {
    "question": "Có những lần đăng nhập thất bại của người dùng 'alice' trong 48 giờ qua không?",
    "keywords": ["đăng nhập", "login", "thất bại", "failure", "người dùng", "user", "alice"],
    "query": {
      "size": 50,
      "sort": [{ "@timestamp": "desc" }],
      "_source": ["@timestamp", "source.user.name", "source.ip", "event.action", "event.outcome", "fortinet.firewall.authmsg"],
      "query": {
        "bool": {
          "filter": [
            { "term": { "source.user.name": "alice" } },
            { "term": { "event.action": "login" } },
            { "term": { "event.outcome": "failure" } },
            { "range": { "@timestamp": { "gte": "now-48h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Những rule nào chặn nhiều nhất trong 24 giờ qua?",
    "keywords": ["rule", "policy", "chặn", "block", "deny", "nhiều nhất", "top"],
    "query": {
      "size": 0,
      "query": { "bool": { "filter": [{ "term": { "fortinet.firewall.action": "deny" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } },
      "aggs": { "rules": { "terms": { "field": "rule.name", "size": 50 } } }
    }
  },
  {
    "question": "Trong 1 giờ qua, có lưu lượng RDP (port 3389) đi vào từ WAN không?",
    "keywords": ["RDP", "port 3389", "WAN", "đi vào", "inbound", "lưu lượng", "traffic"],
    "query": {
      "size": 50,
      "sort": [{ "@timestamp": "desc" }],
      "_source": ["@timestamp", "source.ip", "destination.ip", "destination.port", "fortinet.firewall.srcintfrole", "rule.name"],
      "query": {
        "bool": {
          "filter": [
            { "term": { "destination.port": 3389 } },
            { "term": { "fortinet.firewall.srcintfrole": "wan" } },
            { "range": { "@timestamp": { "gte": "now-1h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Các phiên DNAT tới server nội bộ 10.0.0.10 trong 24 giờ gần đây là gì?",
    "keywords": ["phiên", "session", "DNAT", "server", "máy chủ", "nội bộ", "internal"],
    "query": {
      "size": 50,
      "sort": [{ "@timestamp": "desc" }],
      "_source": ["@timestamp", "source.ip", "destination.ip", "fortinet.firewall.transip", "destination.port", "rule.name"],
      "query": {
        "bool": {
          "filter": [
            { "term": { "fortinet.firewall.trandisp": "dnat" } },
            { "term": { "fortinet.firewall.transip": "10.0.0.10" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Trong 1 giờ qua, IP nguồn nào gửi nhiều gói ICMP bất thường (> 10.000 packets)?",
    "keywords": [
      "IP nguồn",
      "source ip",
      "ICMP",
      "bất thường",
      "anomaly",
      "packets",
      "gói tin",
      "nhiều",
      "> 10000",
      "10000",
      "bucket_selector",
      "1 giờ qua"
    ],
    "query": {
      "size": 0,
      "query": { "bool": { "filter": [{ "term": { "network.protocol": "icmp" } }, { "range": { "@timestamp": { "gte": "now-1h" } } }] } },
      "aggs": {
        "by_source": {
          "terms": { "field": "source.ip", "size": 50 },
          "aggs": {
            "pkt_sum": { "sum": { "field": "network.packets" } },
            "heavy_senders": { "bucket_selector": { "buckets_path": { "p": "pkt_sum" }, "script": "params.p > 10000" } }
          }
        }
      }
    }
  },
  {
    "question": "Policy '10Mbps' đang deny rất nhiều traffic (15,425 lần trong 20 ngày) - những IP nguồn nào vi phạm bandwidth limit này nhiều nhất và có xu hướng tăng trong 24h qua không?",
    "keywords": ["10Mbps policy", "bandwidth violation", "top violators", "deny trend", "traffic abuse", "FTG-CNHN", "bandwidth limit exceeded"],
    "query": {
      "size": 100,
      "sort": [{ "@timestamp": "desc" }],
      "_source": [
        "@timestamp",
        "source.ip",
        "destination.ip",
        "source.port",
        "destination.port",
        "observer.name",
        "fortinet.firewall.shapingpolicyname",
        "fortinet.firewall.action",
        "network.bytes",
        "network.protocol"
      ],
      "query": {
        "bool": {
          "filter": [
            { "term": { "observer.name": "FTG-CNHN" } },
            { "term": { "fortinet.firewall.shapingpolicyname": "10Mbps" } },
            { "term": { "fortinet.firewall.action": "deny" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      },
      "aggs": {
        "top_violating_sources": {
          "terms": {
            "field": "source.ip",
            "size": 10,
            "order": { "total_denied_bytes": "desc" }
          },
          "aggs": {
            "total_denied_bytes": { "sum": { "field": "network.bytes" } },
            "deny_count": { "value_count": { "field": "@timestamp" } },
            "hourly_pattern": {
              "date_histogram": {
                "field": "@timestamp",
                "calendar_interval": "1h"
              }
            }
          }
        },
        "deny_timeline_10mbps": {
          "date_histogram": {
            "field": "@timestamp",
            "calendar_interval": "1h"
          },
          "aggs": {
            "denied_bytes": { "sum": { "field": "network.bytes" } }
          }
        }
      }
    }
  },
  {
    "question": "Ai đã đăng nhập vào thiết bị Fortigate bằng tài khoản admin trong 24 giờ qua?",
    "keywords": ["đăng nhập", "login", "Fortigate", "thiết bị", "tài khoản", "user", "admin", "quản trị"],
    "query": {
      "size": 50,
      "sort": [{ "@timestamp": "desc" }],
      "_source": ["@timestamp", "source.user.name", "source.ip", "event.action", "event.outcome"],
      "query": {
        "bool": {
          "filter": [
            { "term": { "source.user.roles": "Administrator" } },
            { "term": { "event.action": "login" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Có phiên đăng nhập quản trị thất bại (admin login failed) nào trong 1 giờ qua không?",
    "keywords": ["đăng nhập", "login", "quản trị", "admin", "thất bại", "failure", "1 giờ qua"],
    "query": {
      "size": 50,
      "sort": [{ "@timestamp": "desc" }],
      "_source": ["@timestamp", "source.user.name", "source.ip", "event.action", "event.outcome", "fortinet.firewall.authmsg"],
      "query": {
        "bool": {
          "filter": [
            { "term": { "event.action": "login" } },
            { "term": { "event.outcome": "failure" } },
            { "term": { "source.user.roles": "Administrator" } },
            { "range": { "@timestamp": { "gte": "now-1h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "So sánh hiệu quả kiểm soát băng thông giữa 3 shaping policies: '10Mbps' (deny 15,425), '30Mbps' (deny 4,566) và 'Unlimited' (deny 51) - policy nào cần điều chỉnh và tại sao có sự chênh lệch lớn về số lượng deny?",
    "keywords": [
      "policy comparison",
      "bandwidth control effectiveness",
      "QoS analysis",
      "policy optimization",
      "traffic distribution",
      "deny rate analysis"
    ],
    "query": {
      "size": 50,
      "sort": [{ "@timestamp": "desc" }],
      "_source": [
        "@timestamp",
        "source.ip",
        "destination.ip",
        "observer.name",
        "fortinet.firewall.shapingpolicyname",
        "fortinet.firewall.action",
        "network.bytes",
        "network.protocol"
      ],
      "query": {
        "bool": {
          "filter": [
            { "term": { "observer.name": "FTG-CNHN" } },
            { "terms": { "fortinet.firewall.shapingpolicyname": ["10Mbps", "30Mbps", "Unlimited"] } },
            { "term": { "fortinet.firewall.action": "deny" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      },
      "aggs": {
        "policy_effectiveness": {
          "terms": {
            "field": "fortinet.firewall.shapingpolicyname",
            "size": 5
          },
          "aggs": {
            "deny_count": { "value_count": { "field": "@timestamp" } },
            "total_denied_bytes": { "sum": { "field": "network.bytes" } },
            "unique_violators": { "cardinality": { "field": "source.ip" } },
            "avg_bytes_per_deny": {
              "avg": { "field": "network.bytes" }
            },
            "top_violators_per_policy": {
              "terms": {
                "field": "source.ip",
                "size": 3
              },
              "aggs": {
                "violation_bytes": { "sum": { "field": "network.bytes" } }
              }
            }
          }
        },
        "cross_policy_violators": {
          "terms": {
            "field": "source.ip",
            "size": 10
          },
          "aggs": {
            "policies_violated": {
              "terms": { "field": "fortinet.firewall.shapingpolicyname" }
            },
            "total_violations": { "sum": { "field": "network.bytes" } }
          }
        }
      }
    }
  },
  {
    "question": "Trong 7 ngày qua có thay đổi nào về rule firewall không?",
    "keywords": ["thay đổi", "change", "cấu hình", "configuration", "rule", "firewall", "7 ngày qua"],
    "query": {
      "size": 50,
      "sort": [{ "@timestamp": "desc" }],
      "_source": ["@timestamp", "source.user.name", "source.ip", "event.action", "rule.name", "rule.ruleset", "fortinet.firewall.cfgattr"],
      "query": {
        "bool": {
          "filter": [
            { "term": { "event.type": "configuration" } },
            { "term": { "rule.ruleset": "firewall" } },
            { "range": { "@timestamp": { "gte": "now-7d" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Ai đã thay đổi cấu hình hệ thống trong 24 giờ qua?",
    "keywords": ["ai", "user", "thay đổi", "change", "cấu hình", "configuration", "hệ thống", "24 giờ qua"],
    "query": {
      "size": 0,
      "query": { "bool": { "filter": [{ "term": { "event.type": "configuration" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } },
      "aggs": { "by_user": { "terms": { "field": "source.user.name", "size": 50 } } }
    }
  },
  {
    "question": "Có đăng nhập quản trị nào từ quốc gia khác Việt Nam trong 48 giờ qua?",
    "keywords": ["đăng nhập", "login", "quản trị", "admin", "quốc gia", "country", "khác Việt Nam", "nước ngoài", "foreign"],
    "query": {
      "size": 50,
      "_source": ["@timestamp", "source.user.name", "source.ip", "source.geo.country_name", "event.action"],
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "filter": [{ "term": { "event.action": "login" } }, { "range": { "@timestamp": { "gte": "now-48h" } } }],
          "must_not": [{ "term": { "source.geo.country_name": "Vietnam" } }]
        }
      }
    }
  },
  {
    "question": "Trong 24 giờ qua có ai bật/tắt tính năng IPS hoặc AV không?",
    "keywords": ["bật", "tắt", "enable", "disable", "tính năng", "feature", "IPS", "AV", "Antivirus"],
    "query": {
      "size": 50,
      "_source": ["@timestamp", "source.user.name", "source.ip", "event.action", "rule.category", "fortinet.firewall.cfgattr"],
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "filter": [
            { "term": { "event.type": "configuration" } },
            { "terms": { "rule.category": ["IPS", "Antivirus"] } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Có dấu hiệu brute-force login (quá nhiều login failure từ 1 IP) trong 1 giờ qua không?",
    "keywords": [
      "brute-force",
      "tấn công",
      "đăng nhập",
      "login",
      "thất bại",
      "failure",
      "nhiều",
      "IP",
      "1 giờ qua",
      "> 10",
      "threshold",
      "bucket_selector"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "term": { "event.action": "login" } },
            { "term": { "event.outcome": "failure" } },
            { "range": { "@timestamp": { "gte": "now-1h" } } }
          ]
        }
      },
      "aggs": {
        "by_ip": {
          "terms": { "field": "source.ip", "size": 20 },
          "aggs": {
            "fail_count": { "value_count": { "field": "event.outcome" } },
            "brute_force": { "bucket_selector": { "buckets_path": { "c": "fail_count" }, "script": "params.c > 10" } }
          }
        }
      }
    }
  },
  {
    "question": "Có IP nào thực hiện quá nhiều kết nối đến port quản trị (443, 22) trong 15 phút gần đây không?",
    "keywords": ["IP", "nhiều kết nối", "port quản trị", "admin port", "443", "22", "15 phút", "> 50", "threshold", "bucket_selector"],
    "query": {
      "size": 0,
      "query": { "bool": { "filter": [{ "terms": { "destination.port": [22, 443] } }, { "range": { "@timestamp": { "gte": "now-15m" } } }] } },
      "aggs": {
        "by_src": {
          "terms": { "field": "source.ip", "size": 20 },
          "aggs": {
            "conn_count": { "value_count": { "field": "destination.port" } },
            "suspicious": { "bucket_selector": { "buckets_path": { "c": "conn_count" }, "script": "params.c > 50" } }
          }
        }
      }
    }
  },
  {
    "question": "Ai đã thay đổi policy shaping trong 7 ngày qua?",
    "keywords": ["ai", "user", "thay đổi", "change", "policy shaping", "7 ngày qua"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "term": { "event.type": "configuration" } },
            { "exists": { "field": "fortinet.firewall.shapingpolicyname" } },
            { "range": { "@timestamp": { "gte": "now-7d" } } }
          ]
        }
      },
      "aggs": { "by_user": { "terms": { "field": "source.user.name", "size": 50 } } }
    }
  },
  {
    "question": "Có thay đổi nào trong cấu hình interface WAN trong 24 giờ qua không?",
    "keywords": ["thay đổi", "change", "cấu hình", "configuration", "interface", "WAN", "24 giờ qua"],
    "query": {
      "size": 50,
      "_source": [
        "@timestamp",
        "source.user.name",
        "source.ip",
        "observer.ingress.interface.name",
        "observer.egress.interface.name",
        "fortinet.firewall.cfgattr"
      ],
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "filter": [{ "term": { "event.type": "configuration" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }],
          "should": [{ "wildcard": { "observer.ingress.interface.name": "*wan*" } }, { "wildcard": { "observer.egress.interface.name": "*wan*" } }],
          "minimum_should_match": 1
        }
      }
    }
  },
  {
    "question": "Trong 24 giờ qua, những user nào bị chặn khi cố gắng kết nối SSH?",
    "keywords": ["user", "người dùng", "chặn", "block", "deny", "kết nối", "connection", "SSH", "port 22"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "term": { "destination.port": 22 } },
            { "term": { "fortinet.firewall.action": "deny" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      },
      "aggs": { "blocked_users": { "terms": { "field": "source.user.name", "size": 50 } } }
    }
  },
  {
    "question": "Có user nào bị chặn khi truy cập RDP (3389) từ LAN ra ngoài internet không?",
    "keywords": ["user", "người dùng", "chặn", "block", "deny", "truy cập", "RDP", "port 3389", "LAN"],
    "query": {
      "size": 50,
      "_source": ["@timestamp", "source.user.name", "source.ip", "destination.ip", "destination.port", "rule.name"],
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "filter": [
            { "term": { "destination.port": 3389 } },
            { "term": { "fortinet.firewall.action": "deny" } },
            { "term": { "fortinet.firewall.srcintfrole": "lan" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Trong 1 giờ qua có user nào gửi nhiều gói ICMP bị chặn?",
    "keywords": ["user", "người dùng", "ICMP", "chặn", "block", "deny", "1 giờ qua"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "term": { "network.protocol": "icmp" } },
            { "term": { "fortinet.firewall.action": "deny" } },
            { "range": { "@timestamp": { "gte": "now-1h" } } }
          ]
        }
      },
      "aggs": {
        "blocked_icmp": { "terms": { "field": "source.user.name", "size": 50 }, "aggs": { "pkt_sum": { "sum": { "field": "network.packets" } } } }
      }
    }
  },
  {
    "question": "Những user nào cố gắng quét port (nhiều destination.port khác nhau) trong 15 phút gần đây?",
    "keywords": [
      "user",
      "người dùng",
      "quét port",
      "port scan",
      "destination port",
      "15 phút",
      "nhiều",
      "> 10",
      "cardinality",
      "unique ports",
      "bucket_selector"
    ],
    "query": {
      "size": 0,
      "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-15m" } } }] } },
      "aggs": {
        "by_user": {
          "terms": { "field": "source.user.name", "size": 20 },
          "aggs": {
            "unique_ports": { "cardinality": { "field": "destination.port" } },
            "port_scan": { "bucket_selector": { "buckets_path": { "p": "unique_ports" }, "script": "params.p > 10" } }
          }
        }
      }
    }
  },
  {
    "question": "Có user nào bị chặn khi tải file qua FTP (port 21) không?",
    "keywords": ["user", "người dùng", "chặn", "block", "deny", "tải file", "download", "FTP", "port 21"],
    "query": {
      "size": 50,
      "_source": ["@timestamp", "source.user.name", "source.ip", "destination.ip", "destination.port", "rule.name"],
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "filter": [
            { "term": { "destination.port": 21 } },
            { "term": { "fortinet.firewall.action": "deny" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Trong 7 ngày qua, user nào bị chặn nhiều nhất vì truy cập web không hợp lệ?",
    "keywords": ["user", "người dùng", "chặn", "block", "deny", "nhiều nhất", "top", "truy cập web", "web access", "webfilter"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "term": { "fortinet.firewall.subtype": "webfilter" } },
            { "term": { "fortinet.firewall.action": "deny" } },
            { "range": { "@timestamp": { "gte": "now-7d" } } }
          ]
        }
      },
      "aggs": { "top_users": { "terms": { "field": "source.user.name", "size": 50 } } }
    }
  },
  {
    "question": "Có user nào kết nối đến quốc gia bị hạn chế (ví dụ: Russia, China) trong 24 giờ qua không?",
    "keywords": ["user", "người dùng", "kết nối", "connection", "quốc gia", "country", "hạn chế", "restricted", "Russia", "China"],
    "query": {
      "size": 50,
      "_source": ["@timestamp", "source.user.name", "source.ip", "destination.ip", "destination.geo.country_name"],
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "filter": [{ "terms": { "destination.geo.country_name": ["Russia", "China"] } }, { "range": { "@timestamp": { "gte": "now-24h" } } }]
        }
      }
    }
  },
  {
    "question": "Trong 1 giờ qua có user nào upload quá nhiều dữ liệu ra ngoài (>1GB) không?",
    "keywords": [
      "user",
      "người dùng",
      "upload",
      "tải lên",
      "dữ liệu",
      "data",
      "lớn",
      "1GB",
      "1073741824",
      "bytes",
      "data exfiltration",
      "bucket_selector",
      "outbound"
    ],
    "query": {
      "size": 0,
      "query": { "bool": { "filter": [{ "term": { "network.direction": "outbound" } }, { "range": { "@timestamp": { "gte": "now-1h" } } }] } },
      "aggs": {
        "by_user": {
          "terms": { "field": "source.user.name", "size": 20 },
          "aggs": {
            "bytes_sent": { "sum": { "field": "network.bytes" } },
            "big_upload": { "bucket_selector": { "buckets_path": { "b": "bytes_sent" }, "script": "params.b > 1073741824" } }
          }
        }
      }
    }
  },
  {
    "question": "Có user nào trong LAN cố gắng truy cập dịch vụ quản trị web của Fortigate (port 443) bị chặn?",
    "keywords": ["user", "người dùng", "LAN", "truy cập", "dịch vụ quản trị", "admin service", "Fortigate", "port 443", "chặn", "block", "deny"],
    "query": {
      "size": 50,
      "_source": ["@timestamp", "source.user.name", "source.ip", "destination.ip", "destination.port", "rule.name"],
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "filter": [
            { "term": { "destination.port": 443 } },
            { "term": { "fortinet.firewall.action": "deny" } },
            { "term": { "fortinet.firewall.srcintfrole": "lan" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Trong 24 giờ qua, có user nào bị chặn khi dùng ứng dụng P2P (torrent) không?",
    "keywords": ["user", "người dùng", "chặn", "block", "deny", "ứng dụng", "application", "P2P", "torrent"],
    "query": {
      "size": 50,
      "_source": ["@timestamp", "source.user.name", "source.ip", "destination.ip", "rule.category", "rule.name"],
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "filter": [
            { "term": { "rule.category": "p2p" } },
            { "term": { "fortinet.firewall.action": "deny" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Hiển thị log của user QuynhTX từ 8h sáng đến 5h chiều hôm nay",
    "keywords": ["log", "user", "QuynhTX", "8h sáng", "5h chiều", "hôm nay", "thời gian cụ thể", "user activity", "17h", "time range"],
    "query": {
      "query": {
        "bool": {
          "filter": [{ "term": { "source.user.name": "QuynhTX" } }, { "range": { "@timestamp": { "gte": "now/d+8h", "lte": "now/d+17h" } } }]
        }
      },
      "_source": ["@timestamp", "source.user.name", "source.ip", "destination.ip", "event.action", "rule.name"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Traffic trong khung giờ 22h-6h sáng (ngoài giờ làm việc) trong 3 ngày qua",
    "keywords": ["traffic", "lưu lượng", "ngoài giờ làm việc", "after hours", "22h", "6h", "3 ngày", "script", "hour check", "getHour"],
    "query": {
      "query": {
        "bool": {
          "must": { "script": { "script": { "source": "doc['@timestamp'].value.getHour() >= 22 || doc['@timestamp'].value.getHour() < 6" } } },
          "filter": [{ "range": { "@timestamp": { "gte": "now-3d" } } }]
        }
      },
      "_source": ["@timestamp", "source.ip", "destination.ip", "network.bytes", "source.user.name"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "So sánh số lượng connections giữa hôm nay và hôm qua",
    "keywords": [
      "so sánh",
      "compare",
      "số lượng",
      "count",
      "connections",
      "kết nối",
      "hôm nay",
      "hôm qua",
      "date_histogram",
      "by day",
      "yesterday",
      "today"
    ],
    "query": {
      "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-2d/d" } } }] } },
      "aggs": {
        "by_day": {
          "date_histogram": { "field": "@timestamp", "calendar_interval": "day" },
          "aggs": { "connection_count": { "value_count": { "field": "@timestamp" } } }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Tìm các kết nối xuất hiện trong 5 phút đầu tiên của mỗi giờ trong 24h qua",
    "keywords": ["kết nối", "connections", "5 phút đầu", "mỗi giờ", "hourly", "24h qua", "script", "getMinute", "< 5"],
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }],
          "must": { "script": { "script": { "source": "doc['@timestamp'].value.getMinute() < 5" } } }
        }
      },
      "_source": ["@timestamp", "source.ip", "destination.ip", "source.user.name"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Log nào được tạo ra vào cuối tuần (thứ 7, chủ nhật) trong tháng này?",
    "keywords": [
      "log",
      "cuối tuần",
      "weekend",
      "thứ 7",
      "chủ nhật",
      "tháng này",
      "this month",
      "script",
      "getDayOfWeek",
      ">= 6",
      "saturday",
      "sunday"
    ],
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now/M" } } }],
          "must": { "script": { "script": { "source": "doc['@timestamp'].value.getDayOfWeek() >= 6" } } }
        }
      },
      "_source": ["@timestamp", "source.ip", "source.user.name", "event.action"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Traffic cao điểm nhất trong ngày là lúc nào? (group by hour)",
    "keywords": [
      "traffic",
      "lưu lượng",
      "cao điểm",
      "peak hours",
      "group by hour",
      "phân tích theo giờ",
      "date_histogram",
      "hourly",
      "calendar_interval"
    ],
    "query": {
      "query": { "range": { "@timestamp": { "gte": "now-24h" } } },
      "aggs": {
        "by_hour": {
          "date_histogram": { "field": "@timestamp", "calendar_interval": "hour" },
          "aggs": { "total_bytes": { "sum": { "field": "network.bytes" } } }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Có log nào được tạo ra giữa 15-09-2025 10:00 và 15-09-2025 15:30 không?",
    "keywords": ["log", "giữa", "between", "thời gian cụ thể", "specific time", "15-09-2025"],
    "query": {
      "query": { "range": { "@timestamp": { "gte": "2025-09-15T10:00:00.000+07:00", "lte": "2025-09-15T15:30:00.000+07:00" } } },
      "_source": ["@timestamp", "source.ip", "destination.ip", "source.user.name", "event.action"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Khoảng thời gian nào có nhiều kết nối bị chặn nhất trong 7 ngày qua?",
    "keywords": [
      "khoảng thời gian",
      "time range",
      "kết nối bị chặn",
      "denied connections",
      "nhiều nhất",
      "top",
      "7 ngày qua",
      "date_histogram",
      "hour",
      "order by"
    ],
    "query": {
      "query": { "bool": { "filter": [{ "term": { "fortinet.firewall.action": "deny" } }, { "range": { "@timestamp": { "gte": "now-7d" } } }] } },
      "aggs": {
        "by_hour": {
          "date_histogram": { "field": "@timestamp", "calendar_interval": "hour", "order": { "denied_count": "desc" } },
          "aggs": { "denied_count": { "value_count": { "field": "@timestamp" } } }
        }
      },
      "size": 0
    }
  },
  {
    "question": "User nào làm việc ngoài giờ (sau 18h hoặc trước 8h) nhiều nhất?",
    "keywords": [
      "user",
      "người dùng",
      "làm việc ngoài giờ",
      "after hours",
      "sau 18h",
      "trước 8h",
      "nhiều nhất",
      "top",
      "script",
      "getHour",
      ">= 18",
      "< 8"
    ],
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-7d" } } }],
          "must": { "script": { "script": { "source": "doc['@timestamp'].value.getHour() >= 18 || doc['@timestamp'].value.getHour() < 8" } } }
        }
      },
      "aggs": { "by_user": { "terms": { "field": "source.user.name", "size": 10 } } },
      "size": 0
    }
  },
  {
    "question": "Tìm các phiên kết nối kéo dài quá 1 giờ",
    "keywords": ["phiên kết nối", "session", "kéo dài", "long duration", "quá 1 giờ", "event.duration", "3600000000000", "nanoseconds", "> 1 hour"],
    "query": {
      "query": {
        "bool": { "filter": [{ "range": { "event.duration": { "gt": 3600000000000 } } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] }
      },
      "_source": ["@timestamp", "source.ip", "destination.ip", "source.user.name", "event.duration", "rule.name"],
      "sort": [{ "event.duration": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Top 10 applications được sử dụng nhiều nhất theo network.protocol",
    "keywords": ["top 10", "applications", "ứng dụng", "sử dụng nhiều nhất", "network.protocol", "protocol", "exists", "terms aggregation"],
    "query": {
      "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "network.protocol" } }] } },
      "aggs": { "top_apps": { "terms": { "field": "network.protocol", "size": 10 } } },
      "size": 0
    }
  },
  {
    "question": "Tìm tất cả DNS queries đến domain có chứa 'google' trong 6h qua",
    "keywords": ["dns queries", "truy vấn dns", "domain", "google", "6h qua", "wildcard", "dns.question.name", "contains", "chứa"],
    "query": {
      "query": { "bool": { "filter": [{ "wildcard": { "dns.question.name": "*google*" } }, { "range": { "@timestamp": { "gte": "now-6h" } } }] } },
      "_source": ["@timestamp", "source.ip", "dns.question.name", "dns.question.type", "dns.resolved_ip"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Có bao nhiêu HTTPS sessions (port 443) với TLS version 1.2?",
    "keywords": ["bao nhiêu", "count", "https sessions", "port 443", "tls version 1.2", "tls.version", "value_count", "aggregation"],
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "term": { "destination.port": 443 } },
            { "term": { "tls.version": "1.2" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      },
      "aggs": { "session_count": { "value_count": { "field": "@timestamp" } } },
      "size": 0
    }
  },
  {
    "question": "Liệt kê các HTTP requests với method POST trong 3h qua",
    "keywords": ["http requests", "method post", "3h qua", "http.request.method", "POST", "liệt kê", "list"],
    "query": {
      "query": { "bool": { "filter": [{ "term": { "http.request.method": "POST" } }, { "range": { "@timestamp": { "gte": "now-3h" } } }] } },
      "_source": ["@timestamp", "source.ip", "source.user.name", "destination.ip", "destination.as.organization.name", "http.request.method"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Traffic ICMP chiếm bao nhiêu phần trăm tổng traffic?",
    "keywords": [
      "traffic icmp",
      "lưu lượng icmp",
      "phần trăm",
      "percentage",
      "tổng traffic",
      "total traffic",
      "filter aggregation",
      "sum",
      "calculation"
    ],
    "query": {
      "query": { "range": { "@timestamp": { "gte": "now-24h" } } },
      "aggs": {
        "total_traffic": { "sum": { "field": "network.bytes" } },
        "icmp_traffic": { "filter": { "term": { "network.protocol": "icmp" } }, "aggs": { "bytes": { "sum": { "field": "network.bytes" } } } }
      },
      "size": 0
    }
  },
  {
    "question": "User nào truy cập nhiều domains khác nhau nhất?",
    "keywords": ["user", "người dùng", "truy cập", "access", "nhiều domains", "unique domains", "nhiều nhất", "top", "cardinality"],
    "keywords": ["user", "người dùng", "truy cập", "access", "nhiều domains", "unique domains", "nhiều nhất", "top", "cardinality"],
    "query": {
      "query": {
        "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "destination.as.organization.name" } }] }
      },
      "aggs": {
        "by_user": {
          "terms": { "field": "source.user.name", "size": 10, "order": { "unique_domains": "desc" } },
          "aggs": { "unique_domains": { "cardinality": { "field": "destination.as.organization.name" } } }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Có kết nối nào sử dụng protocol không phổ biến?",
    "keywords": [
      "kết nối",
      "connection",
      "protocol",
      "giao thức",
      "không phổ biến",
      "uncommon",
      "rare",
      "must_not",
      "exclude",
      "tcp",
      "udp",
      "icmp",
      "dns",
      "http",
      "https"
    ],
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }],
          "must_not": [{ "terms": { "network.transport": ["tcp", "udp"] } }, { "terms": { "network.protocol": ["icmp", "dns", "http", "https"] } }]
        }
      },
      "_source": ["@timestamp", "source.ip", "destination.ip", "network.protocol", "network.transport"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Top 5 TLS cipher suites được sử dụng nhiều nhất",
    "keywords": ["top 5", "tls cipher suites", "mã hóa", "encryption", "sử dụng nhiều nhất", "tls.cipher", "exists", "terms aggregation"],
    "query": {
      "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "tls.cipher" } }] } },
      "aggs": { "top_ciphers": { "terms": { "field": "tls.cipher", "size": 5 } } },
      "size": 0
    }
  },
  {
    "question": "Tìm các DNS queries không thành công trong 24h qua",
    "keywords": [
      "dns queries",
      "truy vấn dns",
      "không thành công",
      "failed",
      "24h qua",
      "must_not",
      "exists",
      "dns.resolved_ip",
      "dns.question.name"
    ],
    "query": {
      "query": {
        "bool": {
          "filter": [{ "exists": { "field": "dns.question.name" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }],
          "must_not": [{ "exists": { "field": "dns.resolved_ip" } }]
        }
      },
      "_source": ["@timestamp", "source.ip", "dns.question.name", "dns.question.type"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Kết nối nào có URL path chứa '/admin' hoặc '/login'?",
    "keywords": [
      "kết nối",
      "connection",
      "url path",
      "chứa",
      "contains",
      "/admin",
      "/login",
      "wildcard",
      "should",
      "minimum_should_match",
      "destination.as.organization.name"
    ],
    "query": {
      "query": {
        "bool": {
          "should": [
            { "wildcard": { "destination.as.organization.name": "*/admin*" } },
            { "wildcard": { "destination.as.organization.name": "*/login*" } }
          ],
          "minimum_should_match": 1,
          "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }]
        }
      },
      "_source": ["@timestamp", "source.ip", "source.user.name", "destination.as.organization.name", "destination.as.organization.name"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Traffic đi qua interface WiFi-HPTVIETNAM nhiều hơn hay port3?",
    "keywords": [
      "traffic",
      "lưu lượng",
      "interface",
      "cổng",
      "WiFi-HPTVIETNAM",
      "port3",
      "so sánh",
      "compare",
      "should",
      "observer.ingress.interface.name"
    ],
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }],
          "should": [
            { "term": { "observer.ingress.interface.name": "WiFi-HPTVIETNAM" } },
            { "term": { "observer.ingress.interface.name": "port3" } }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "by_interface": {
          "terms": { "field": "observer.ingress.interface.name", "size": 10 },
          "aggs": { "total_bytes": { "sum": { "field": "network.bytes" } } }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Tìm các kết nối internal (source và destination đều trong mạng nội bộ)",
    "keywords": ["kết nối", "connections", "internal", "nội bộ", "network.direction", "internal network"],
    "query": {
      "query": { "bool": { "filter": [{ "term": { "network.direction": "internal" } }, { "range": { "@timestamp": { "gte": "now-6h" } } }] } },
      "_source": ["@timestamp", "source.ip", "destination.ip", "network.bytes", "rule.name"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Top 10 destination ports được truy cập nhiều nhất từ LAN",
    "keywords": [
      "top 10",
      "destination ports",
      "cổng đích",
      "truy cập nhiều nhất",
      "LAN",
      "srcintfrole",
      "fortinet.firewall.srcintfrole",
      "terms aggregation"
    ],
    "query": {
      "query": {
        "bool": { "filter": [{ "term": { "fortinet.firewall.srcintfrole": "lan" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] }
      },
      "aggs": { "top_ports": { "terms": { "field": "destination.port", "size": 10 } } },
      "size": 0
    }
  },
  {
    "question": "Có traffic nào đi từ DMZ ra WAN không?",
    "keywords": ["traffic", "lưu lượng", "từ DMZ", "ra WAN", "srcintfrole", "dstintfrole"],
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "term": { "fortinet.firewall.srcintfrole": "dmz" } },
            { "term": { "fortinet.firewall.dstintfrole": "wan" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      },
      "_source": ["@timestamp", "source.ip", "destination.ip", "network.bytes", "rule.name"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Phân tích traffic theo interface role (lan/wan/dmz) trong 24h qua",
    "keywords": [
      "phân tích",
      "analysis",
      "traffic",
      "lưu lượng",
      "interface role",
      "lan",
      "wan",
      "dmz",
      "fortinet.firewall.srcintfrole",
      "exists",
      "terms aggregation"
    ],
    "query": {
      "query": {
        "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "fortinet.firewall.srcintfrole" } }] }
      },
      "aggs": {
        "by_interface_role": {
          "terms": { "field": "fortinet.firewall.srcintfrole", "size": 10 },
          "aggs": { "total_bytes": { "sum": { "field": "network.bytes" } } }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Source MAC address nào có nhiều connections nhất?",
    "keywords": ["source mac address", "địa chỉ mac nguồn", "nhiều connections nhất", "top connections", "source.mac", "exists", "terms aggregation"],
    "query": {
      "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "source.mac" } }] } },
      "aggs": { "top_macs": { "terms": { "field": "source.mac", "size": 10 } } },
      "size": 0
    }
  },
  {
    "question": "Tìm các kết nối có source port > 50000 (ephemeral ports)",
    "keywords": ["kết nối", "connections", "source port", "cổng nguồn", "> 50000", "ephemeral ports", "range", "gt", "greater than"],
    "query": {
      "query": { "bool": { "filter": [{ "range": { "source.port": { "gt": 50000 } } }, { "range": { "@timestamp": { "gte": "now-6h" } } }] } },
      "_source": ["@timestamp", "source.ip", "source.port", "destination.ip", "destination.port"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Traffic inbound và outbound chiếm tỷ lệ bao nhiêu?",
    "keywords": ["traffic", "lưu lượng", "inbound", "outbound", "vào", "ra", "tỷ lệ", "ratio", "network.direction", "exists", "terms aggregation"],
    "query": {
      "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "network.direction" } }] } },
      "aggs": {
        "by_direction": { "terms": { "field": "network.direction", "size": 10 }, "aggs": { "total_bytes": { "sum": { "field": "network.bytes" } } } }
      },
      "size": 0
    }
  },
  {
    "question": "Liệt kê các egress interfaces được sử dụng nhiều nhất",
    "keywords": ["egress interfaces", "cổng ra", "sử dụng nhiều nhất", "top usage", "observer.egress.interface.name", "exists", "terms aggregation"],
    "query": {
      "query": {
        "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "observer.egress.interface.name" } }] }
      },
      "aggs": { "top_egress": { "terms": { "field": "observer.egress.interface.name", "size": 10 } } },
      "size": 0
    }
  },
  {
    "question": "Top 10 sessions có network.bytes lớn nhất trong 12h qua",
    "keywords": ["top 10", "sessions", "phiên", "network.bytes", "lưu lượng", "lớn nhất", "sort", "descending", "desc"],
    "query": {
      "query": { "range": { "@timestamp": { "gte": "now-12h" } } },
      "_source": ["@timestamp", "source.ip", "destination.ip", "network.bytes", "source.user.name", "rule.name"],
      "sort": [{ "network.bytes": "desc" }],
      "size": 10
    }
  },
  {
    "question": "User nào có tổng packets gửi đi (source.packets) nhiều nhất?",
    "keywords": ["user", "người dùng", "tổng packets", "gửi đi", "source.packets", "nhiều nhất", "top", "sum", "aggregation", "order", "desc"],
    "query": {
      "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "source.user.name" } }] } },
      "aggs": {
        "top_users": {
          "terms": { "field": "source.user.name", "size": 10, "order": { "total_packets": "desc" } },
          "aggs": { "total_packets": { "sum": { "field": "source.packets" } } }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Tìm các sessions có packet loss > 10%",
    "keywords": ["sessions", "phiên", "packet loss", "mất gói", "> 10%", "10", "fortinet.firewall.packetloss", "range", "gt", "greater than"],
    "query": {
      "query": {
        "bool": { "filter": [{ "range": { "fortinet.firewall.packetloss": { "gt": 10 } } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] }
      },
      "_source": ["@timestamp", "source.ip", "destination.ip", "fortinet.firewall.packetloss"],
      "sort": [{ "fortinet.firewall.packetloss": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Average bytes per session trong 24h qua là bao nhiêu?",
    "keywords": ["average", "trung bình", "bytes per session", "24h qua", "avg", "aggregation", "network.bytes"],
    "query": {
      "query": { "range": { "@timestamp": { "gte": "now-24h" } } },
      "aggs": { "avg_bytes": { "avg": { "field": "network.bytes" } } },
      "size": 0
    }
  },
  {
    "question": "Kết nối nào có destination.bytes lớn hơn source.bytes (download > upload)?",
    "keywords": ["kết nối", "connection", "destination.bytes", "source.bytes", "download", "upload", "so sánh", "compare", "script", ">"],
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-6h" } } }],
          "must": { "script": { "script": { "source": "doc['destination.bytes'].value > doc['source.bytes'].value" } } }
        }
      },
      "_source": ["@timestamp", "source.ip", "destination.ip", "source.bytes", "destination.bytes"],
      "sort": [{ "destination.bytes": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Tổng bandwidth sử dụng trong 1 giờ qua là bao nhiêu?",
    "keywords": ["tổng", "total", "bandwidth", "băng thông", "1 giờ qua", "sum", "aggregation", "network.bytes"],
    "query": {
      "query": { "range": { "@timestamp": { "gte": "now-1h" } } },
      "aggs": { "total_bandwidth": { "sum": { "field": "network.bytes" } } },
      "size": 0
    }
  },
  {
    "question": "Top 10 connections có ratio bytes/packets cao nhất (large packets)",
    "keywords": [
      "top 10",
      "connections",
      "kết nối",
      "ratio",
      "tỷ lệ",
      "bytes/packets",
      "large packets",
      "bucket_script",
      "calculation",
      "bytes per packet"
    ],
    "query": {
      "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "range": { "network.packets": { "gt": 0 } } }] } },
      "aggs": {
        "top_connections": {
          "terms": { "field": "source.ip", "size": 10, "order": { "bytes_per_packet": "desc" } },
          "aggs": {
            "total_bytes": { "sum": { "field": "network.bytes" } },
            "total_packets": { "sum": { "field": "network.packets" } },
            "bytes_per_packet": {
              "bucket_script": {
                "buckets_path": { "bytes": "total_bytes", "packets": "total_packets" },
                "script": "params.bytes > 0 ? params.bytes / params.packets : 0"
              }
            }
          }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Có session nào có duration < 1 giây nhưng bytes > 1MB? (suspicious)",
    "keywords": [
      "session",
      "phiên",
      "duration",
      "thời lượng",
      "bytes",
      "lưu lượng",
      "suspicious",
      "đáng ngờ",
      "< 1 giây",
      "> 1MB",
      "1000000000",
      "1048576",
      "nanoseconds",
      "range"
    ],
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "range": { "event.duration": { "lt": 1000000000 } } },
            { "range": { "network.bytes": { "gt": 1048576 } } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      },
      "_source": ["@timestamp", "source.ip", "destination.ip", "event.duration", "network.bytes", "rule.name"],
      "sort": [{ "network.bytes": "desc" }],
      "size": 50
    }
  },
  {
    "question": "User nào có average session duration dài nhất?",
    "keywords": [
      "user",
      "người dùng",
      "average session duration",
      "thời lượng trung bình",
      "dài nhất",
      "avg",
      "aggregation",
      "event.duration",
      "order",
      "desc"
    ],
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-24h" } } },
            { "exists": { "field": "source.user.name" } },
            { "exists": { "field": "event.duration" } }
          ]
        }
      },
      "aggs": {
        "by_user": {
          "terms": { "field": "source.user.name", "size": 10, "order": { "avg_duration": "desc" } },
          "aggs": { "avg_duration": { "avg": { "field": "event.duration" } } }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Phân tích distribution của network.bytes (histogram)",
    "keywords": ["phân tích", "analysis", "distribution", "phân phối", "network.bytes", "histogram", "interval", "aggregation", "1048576"],
    "query": {
      "query": { "range": { "@timestamp": { "gte": "now-24h" } } },
      "aggs": { "bytes_distribution": { "histogram": { "field": "network.bytes", "interval": 1048576 } } },
      "size": 0
    }
  },
  {
    "question": "Có bao nhiêu MacBooks đang kết nối trong mạng?",
    "keywords": [
      "bao nhiêu",
      "count",
      "MacBooks",
      "thiết bị apple",
      "kết nối",
      "srchwversion",
      "wildcard",
      "cardinality",
      "unique",
      "fortinet.firewall.srchwversion"
    ],
    "query": {
      "query": {
        "bool": { "filter": [{ "wildcard": { "fortinet.firewall.srchwversion": "*MacBook*" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] }
      },
      "aggs": { "unique_macbooks": { "cardinality": { "field": "source.ip" } } },
      "size": 0
    }
  },
  {
    "question": "Liệt kê tất cả các OS versions đang được sử dụng",
    "keywords": [
      "liệt kê",
      "list",
      "os versions",
      "phiên bản hệ điều hành",
      "srcswversion",
      "fortinet.firewall.srcswversion",
      "exists",
      "terms aggregation"
    ],
    "query": {
      "query": {
        "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "fortinet.firewall.srcswversion" } }] }
      },
      "aggs": { "os_versions": { "terms": { "field": "fortinet.firewall.srcswversion", "size": 20 } } },
      "size": 0
    }
  },
  {
    "question": "Device nào có nhiều source MAC addresses khác nhau? (MAC spoofing?)",
    "keywords": [
      "device",
      "thiết bị",
      "source mac addresses",
      "địa chỉ mac",
      "khác nhau",
      "mac spoofing",
      "cardinality",
      "unique",
      "host.name",
      "source.mac",
      "order"
    ],
    "query": {
      "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "host.name" } }] } },
      "aggs": {
        "by_device": {
          "terms": { "field": "host.name", "size": 20, "order": { "unique_macs": "desc" } },
          "aggs": { "unique_macs": { "cardinality": { "field": "source.mac" } } }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Tìm các Windows devices với OS version cũ (< Windows 10)",
    "keywords": [
      "windows devices",
      "os version cũ",
      "hệ điều hành cũ",
      "windows 7",
      "windows 8",
      "must_not",
      "wildcard",
      "fortinet.firewall.osname",
      "fortinet.firewall.srcswversion",
      "< Windows 10"
    ],
    "query": {
      "query": {
        "bool": {
          "filter": [{ "term": { "fortinet.firewall.osname": "Windows" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }],
          "must_not": [{ "wildcard": { "fortinet.firewall.srcswversion": "*10*" } }, { "wildcard": { "fortinet.firewall.srcswversion": "*11*" } }]
        }
      },
      "_source": ["@timestamp", "source.ip", "fortinet.firewall.osname", "fortinet.firewall.srcswversion", "host.name"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Top 10 device types (Laptop/Desktop/Mobile) có traffic nhiều nhất",
    "keywords": [
      "top 10",
      "device types",
      "loại thiết bị",
      "laptop",
      "desktop",
      "mobile",
      "traffic nhiều nhất",
      "fortinet.firewall.devtype",
      "exists",
      "sum",
      "order"
    ],
    "query": {
      "query": {
        "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "fortinet.firewall.devtype" } }] }
      },
      "aggs": {
        "top_device_types": {
          "terms": { "field": "fortinet.firewall.devtype", "size": 10, "order": { "total_bytes": "desc" } },
          "aggs": { "total_bytes": { "sum": { "field": "network.bytes" } } }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Có device nào đổi IP address trong 6h qua không?",
    "keywords": ["device", "thiết bị", "đổi IP", "ip change", "6h qua", "host.name", "cardinality", "source.ip", "bucket_selector", "> 1"],
    "query": {
      "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-6h" } } }, { "exists": { "field": "host.name" } }] } },
      "aggs": {
        "by_hostname": {
          "terms": { "field": "host.name", "size": 50 },
          "aggs": {
            "unique_ips": { "cardinality": { "field": "source.ip" } },
            "ip_change": { "bucket_selector": { "buckets_path": { "ips": "unique_ips" }, "script": "params.ips > 1" } }
          }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Devices từ vendor Apple chiếm bao nhiêu phần trăm?",
    "keywords": [
      "devices",
      "thiết bị",
      "vendor",
      "hãng",
      "Apple",
      "phần trăm",
      "percentage",
      "fortinet.firewall.srchwvendor",
      "filter aggregation",
      "cardinality",
      "calculation"
    ],
    "query": {
      "query": {
        "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "fortinet.firewall.srchwvendor" } }] }
      },
      "aggs": {
        "apple_devices": {
          "filter": { "term": { "fortinet.firewall.srchwvendor": "Apple" } },
          "aggs": { "count": { "cardinality": { "field": "source.ip" } } }
        },
        "total_devices": { "cardinality": { "field": "source.ip" } }
      },
      "size": 0
    }
  },
  {
    "question": "Tìm các unidentified devices (không có devtype)",
    "keywords": [
      "unidentified devices",
      "thiết bị không xác định",
      "không có devtype",
      "unknown device",
      "must_not",
      "exists",
      "fortinet.firewall.devtype"
    ],
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }],
          "must_not": [{ "exists": { "field": "fortinet.firewall.devtype" } }]
        }
      },
      "_source": ["@timestamp", "source.ip", "source.mac", "host.name"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Host nào có nhiều failed connections nhất?",
    "keywords": [
      "host",
      "máy chủ",
      "kết nối thất bại",
      "failed connections",
      "nhiều nhất",
      "top",
      "event.outcome",
      "failure",
      "host.name",
      "terms aggregation"
    ],
    "query": {
      "query": { "bool": { "filter": [{ "term": { "event.outcome": "failure" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } },
      "aggs": { "top_failed_hosts": { "terms": { "field": "host.name", "size": 10 } } },
      "size": 0
    }
  },
  {
    "question": "Liệt kê các container hoặc cloud instances",
    "keywords": [
      "liệt kê",
      "list",
      "container",
      "cloud instances",
      "máy ảo",
      "should",
      "minimum_should_match",
      "exists",
      "container.id",
      "cloud.instance.id"
    ],
    "query": {
      "query": {
        "bool": {
          "should": [{ "exists": { "field": "container.id" } }, { "exists": { "field": "cloud.instance.id" } }],
          "minimum_should_match": 1,
          "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }]
        }
      },
      "_source": ["@timestamp", "container.id", "container.name", "cloud.instance.id", "cloud.provider", "source.ip"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Có IP nào bị đánh dấu là botnet không?",
    "keywords": [
      "ip",
      "botnet",
      "đánh dấu",
      "flagged",
      "malicious",
      "độc hại",
      "exists",
      "fortinet.firewall.botnetip",
      "fortinet.firewall.botnetdomain"
    ],
    "query": {
      "query": {
        "bool": { "filter": [{ "exists": { "field": "fortinet.firewall.botnetip" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] }
      },
      "_source": ["@timestamp", "source.ip", "fortinet.firewall.botnetip", "fortinet.firewall.botnetdomain", "rule.name"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Tổng số log trong 24 giờ qua là bao nhiêu?",
    "keywords": ["tổng số log", "đếm log", "count logs", "24 giờ qua", "last 24 hours", "value_count", "@timestamp", "aggregation"],
    "query": {
      "query": { "range": { "@timestamp": { "gte": "now-24h" } } },
      "aggs": { "total_count": { "value_count": { "field": "@timestamp" } } },
      "size": 0
    }
  },
  {
    "question": "Đếm số lượng kết nối bị chặn hôm nay",
    "keywords": [
      "đếm",
      "count",
      "kết nối bị chặn",
      "denied connections",
      "hôm nay",
      "today",
      "value_count",
      "now/d",
      "fortinet.firewall.action",
      "deny"
    ],
    "query": {
      "query": { "bool": { "filter": [{ "term": { "fortinet.firewall.action": "deny" } }, { "range": { "@timestamp": { "gte": "now/d" } } }] } },
      "aggs": { "total_denied": { "value_count": { "field": "@timestamp" } } },
      "size": 0
    }
  },
  {
    "question": "Có bao nhiêu user đăng nhập thất bại trong 1 giờ qua?",
    "keywords": [
      "bao nhiêu user",
      "count users",
      "đăng nhập thất bại",
      "failed logins",
      "1 giờ qua",
      "cardinality",
      "source.user.name",
      "event.action",
      "event.outcome"
    ],
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "term": { "event.action": "login" } },
            { "term": { "event.outcome": "failure" } },
            { "range": { "@timestamp": { "gte": "now-1h" } } }
          ]
        }
      },
      "aggs": { "failed_logins": { "cardinality": { "field": "source.user.name" } } },
      "size": 0
    }
  },
  {
    "question": "IP 10.6.99.78 được gắn với user nào?",
    "keywords": ["ip", "user", "người dùng", "gắn với", "associated with", "10.6.99.78", "source.ip", "terms", "aggregation", "source.user.name"],
    "query": {
      "query": { "bool": { "filter": [{ "term": { "source.ip": "10.6.99.78" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } },
      "aggs": { "user_names": { "terms": { "field": "source.user.name", "size": 10 } } },
      "size": 0
    }
  },
  {
    "question": "User nào hoạt động nhiều nhất trong 6 giờ qua?",
    "keywords": [
      "user",
      "người dùng",
      "hoạt động nhiều nhất",
      "most active",
      "top user",
      "6 giờ qua",
      "exists",
      "source.user.name",
      "terms aggregation"
    ],
    "query": {
      "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-6h" } } }, { "exists": { "field": "source.user.name" } }] } },
      "aggs": { "top_users": { "terms": { "field": "source.user.name", "size": 15 } } },
      "size": 0
    }
  },
  {
    "question": "Tổng số log của user QuynhTX ngày 19-09-2025",
    "keywords": [
      "tổng số log",
      "count logs",
      "user",
      "QuynhTX",
      "ngày cụ thể",
      "specific date",
      "19-09-2025",
      "range",
      "timezone",
      "+07:00",
      "value_count"
    ],
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "term": { "source.user.name": "QuynhTX" } },
            { "range": { "@timestamp": { "gte": "2025-09-19T00:00:00.000+07:00", "lte": "2025-09-19T23:59:59.999+07:00" } } }
          ]
        }
      },
      "aggs": { "total_count": { "value_count": { "field": "@timestamp" } } },
      "size": 0
    }
  },
  {
    "question": "Ai đăng nhập với quyền Administrator trong 24 giờ qua?",
    "keywords": ["ai", "user", "đăng nhập", "login", "quyền", "role", "Administrator", "quản trị", "source.user.roles", "24 giờ qua"],
    "query": {
      "query": { "bool": { "filter": [{ "term": { "source.user.roles": "Administrator" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } },
      "_source": ["@timestamp", "source.user.name", "source.ip", "event.action", "fortinet.firewall.subtype"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Top 10 quốc gia được truy cập nhiều nhất trong 24 giờ qua",
    "keywords": [
      "top 10",
      "quốc gia",
      "country",
      "truy cập nhiều nhất",
      "top destination",
      "destination.geo.country_name",
      "exists",
      "terms aggregation"
    ],
    "query": {
      "query": {
        "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "destination.geo.country_name" } }] }
      },
      "aggs": { "top_countries": { "terms": { "field": "destination.geo.country_name", "size": 10 } } },
      "size": 0
    }
  },
  {
    "question": "Có kết nối nào từ nước ngoài vào Việt Nam không?",
    "keywords": [
      "kết nối",
      "connection",
      "nước ngoài",
      "foreign",
      "vào Việt Nam",
      "inbound",
      "incoming",
      "destination.geo.country_name",
      "source.geo.country_name",
      "must_not",
      "Vietnam"
    ],
    "query": {
      "query": {
        "bool": {
          "filter": [{ "term": { "destination.geo.country_name": "Vietnam" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }],
          "must_not": [{ "term": { "source.geo.country_name": "Vietnam" } }]
        }
      },
      "_source": ["@timestamp", "source.ip", "source.geo.country_name", "destination.ip", "rule.name"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Nhân viên truy cập website nước ngoài nào trong thời gian gần đây?",
    "keywords": [
      "nhân viên",
      "user",
      "truy cập website",
      "web access",
      "nước ngoài",
      "foreign website",
      "international",
      "http",
      "https",
      "destination.geo.country_name",
      "must_not",
      "Vietnam"
    ],
    "query": {
      "query": {
        "bool": {
          "filter": [{ "terms": { "network.protocol": ["http", "https"] } }, { "range": { "@timestamp": { "gte": "now-30d" } } }],
          "must_not": [{ "term": { "destination.geo.country_name": "Vietnam" } }]
        }
      },
      "_source": ["@timestamp", "source.user.name", "source.ip", "destination.ip", "destination.geo.country_name", "rule.name"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Top 10 IP bị chặn nhiều nhất hôm nay",
    "keywords": ["top 10", "ip", "bị chặn", "denied", "hôm nay", "today", "now/d", "fortinet.firewall.action", "deny", "terms aggregation"],
    "query": {
      "query": { "bool": { "filter": [{ "term": { "fortinet.firewall.action": "deny" } }, { "range": { "@timestamp": { "gte": "now/d" } } }] } },
      "aggs": { "top_blocked": { "terms": { "field": "source.ip", "size": 10 } } },
      "size": 0
    }
  },
  {
    "question": "Tìm các kết nối SSH bị chặn trong 2 giờ qua",
    "keywords": ["kết nối ssh", "ssh connection", "bị chặn", "denied", "2 giờ qua", "2h", "destination.port", "22", "fortinet.firewall.action"],
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "term": { "destination.port": 22 } },
            { "term": { "fortinet.firewall.action": "deny" } },
            { "range": { "@timestamp": { "gte": "now-2h" } } }
          ]
        }
      },
      "_source": ["@timestamp", "source.ip", "destination.ip", "rule.name", "fortinet.firewall.action"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Rule nào cho phép traffic nhiều nhất trong 12 giờ qua?",
    "keywords": [
      "rule",
      "policy",
      "cho phép",
      "allow",
      "traffic",
      "lưu lượng",
      "nhiều nhất",
      "top",
      "12 giờ qua",
      "sum",
      "order",
      "desc",
      "network.bytes"
    ],
    "query": {
      "query": { "bool": { "filter": [{ "term": { "fortinet.firewall.action": "allow" } }, { "range": { "@timestamp": { "gte": "now-12h" } } }] } },
      "aggs": {
        "top_allow_rules": {
          "terms": { "field": "rule.name", "size": 15, "order": { "total_bytes": "desc" } },
          "aggs": { "total_bytes": { "sum": { "field": "network.bytes" } } }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Tìm các IPS alert với mức critical trong 24 giờ qua",
    "keywords": [
      "ips alert",
      "cảnh báo ips",
      "mức",
      "level",
      "critical",
      "nghiêm trọng",
      "fortinet.firewall.crlevel",
      "fortinet.firewall.attack",
      "fortinet.firewall.crscore"
    ],
    "query": {
      "query": {
        "bool": { "filter": [{ "term": { "fortinet.firewall.crlevel": "critical" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] }
      },
      "_source": ["@timestamp", "source.ip", "destination.ip", "fortinet.firewall.attack", "fortinet.firewall.crscore", "rule.name"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Liệt kê các virus/malware được phát hiện trong 6 giờ qua",
    "keywords": [
      "liệt kê",
      "list",
      "virus",
      "malware",
      "mã độc",
      "phát hiện",
      "detected",
      "exists",
      "fortinet.firewall.virus",
      "fortinet.firewall.virusid",
      "6 giờ qua"
    ],
    "query": {
      "query": { "bool": { "filter": [{ "exists": { "field": "fortinet.firewall.virus" } }, { "range": { "@timestamp": { "gte": "now-6h" } } }] } },
      "_source": ["@timestamp", "source.ip", "destination.ip", "fortinet.firewall.virus", "fortinet.firewall.virusid", "rule.name"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Tìm các SNAT sessions trong 1 giờ qua",
    "keywords": ["snat", "source nat", "sessions", "phiên", "1 giờ qua", "fortinet.firewall.trandisp", "source.nat.ip", "source.ip"],
    "query": {
      "query": { "bool": { "filter": [{ "term": { "fortinet.firewall.trandisp": "snat" } }, { "range": { "@timestamp": { "gte": "now-1h" } } }] } },
      "_source": ["@timestamp", "source.ip", "source.nat.ip", "destination.ip", "network.bytes", "rule.name"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Đếm số lượng NAT sessions theo loại (snat/dnat)",
    "keywords": ["đếm", "count", "nat sessions", "loại", "type", "snat", "dnat", "fortinet.firewall.trandisp", "terms aggregation"],
    "query": {
      "query": { "range": { "@timestamp": { "gte": "now-24h" } } },
      "aggs": { "nat_types": { "terms": { "field": "fortinet.firewall.trandisp", "size": 10 } } },
      "size": 0
    }
  },
  {
    "question": "Tìm traffic đi qua policy ID 5 trong 4h qua",
    "keywords": ["traffic", "lưu lượng", "policy id", "rule id", "5", "4h qua", "fortinet.firewall.policyid", "4 giờ qua"],
    "query": {
      "query": { "bool": { "filter": [{ "term": { "fortinet.firewall.policyid": "5" } }, { "range": { "@timestamp": { "gte": "now-4h" } } }] } },
      "_source": ["@timestamp", "source.ip", "destination.ip", "rule.name", "fortinet.firewall.action", "network.bytes"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Top 15 rules được sử dụng nhiều nhất theo traffic volume",
    "keywords": [
      "top 15",
      "rules",
      "policy",
      "sử dụng nhiều nhất",
      "traffic volume",
      "lưu lượng",
      "sum",
      "network.bytes",
      "value_count",
      "fortinet.firewall.sessionid",
      "order"
    ],
    "query": {
      "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }] } },
      "aggs": {
        "top_rules": {
          "terms": { "field": "rule.name", "size": 15, "order": { "total_bytes": "desc" } },
          "aggs": {
            "total_bytes": { "sum": { "field": "network.bytes" } },
            "total_sessions": { "value_count": { "field": "fortinet.firewall.sessionid" } }
          }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Tìm xem user nào chỉnh sửa trong CNHN_ZONE",
    "keywords": [
      "user",
      "người dùng",
      "chỉnh sửa",
      "edit",
      "modify",
      "cấu hình",
      "CNHN_ZONE",
      "cfgattr",
      "fortinet.firewall.cfgattr",
      "exists",
      "match",
      "message"
    ],
    "query": {
      "size": 200,
      "sort": [{ "@timestamp": "asc" }],
      "_source": ["@timestamp", "source.user.name", "source.ip", "message", "fortinet.firewall.cfgattr"],
      "query": { "bool": { "filter": [{ "exists": { "field": "fortinet.firewall.cfgattr" } }, { "match": { "message": "CNHN_ZONE" } }] } }
    }
  },
  {
    "question": "Có kết nối nào từ observer.name = 'FTG-CNHN' đến observer khác không?",
    "keywords": ["observer.name", "FTG-CNHN", "kết nối", "observer khác", "thiết bị", "firewall", "observer", "term"],
    "query": {
      "query": { "bool": { "filter": [{ "term": { "observer.name": "FTG-CNHN" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } },
      "_source": ["@timestamp", "observer.name", "source.ip", "destination.ip", "rule.name"],
      "sort": [{ "@timestamp": "desc" }],
      "size": 50
    }
  },
  {
    "question": "Đếm tổng số log trong ngày hôm nay",
    "keywords": ["đếm", "tổng số", "log", "hôm nay", "count", "now/d", "value_count", "@timestamp", "today"],
    "query": {
      "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now/d" } } }] } },
      "aggs": { "total_count": { "value_count": { "field": "@timestamp" } } },
      "size": 0
    }
  },
  {
    "question": "Có tổng cộng bao nhiêu log của user 'tanln' trong 24 giờ qua?",
    "keywords": ["tổng cộng", "bao nhiêu", "log", "user", "tanln", "24 giờ qua", "count", "value_count", "source.user.name", "aggregation"],
    "query": {
      "query": { "bool": { "filter": [{ "term": { "source.user.name": "tanln" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } },
      "aggs": { "total_count": { "value_count": { "field": "@timestamp" } } },
      "size": 0
    }
  },
  {
    "question": "Thống kê tổng số log từ địa chỉ IP 192.168.1.100 trong tuần này",
    "keywords": ["thống kê", "tổng số", "log", "địa chỉ ip", "192.168.1.100", "tuần này", "count", "now/w", "value_count", "source.ip", "this week"],
    "query": {
      "query": { "bool": { "filter": [{ "term": { "source.ip": "192.168.1.100" } }, { "range": { "@timestamp": { "gte": "now/w" } } }] } },
      "aggs": { "total_count": { "value_count": { "field": "@timestamp" } } },
      "size": 0
    }
  },
  {
    "question": "Tìm 50 log mới nhất trong khoảng thời gian từ 18:00 đến 20:00 ngày 07/10/2025",
    "keywords": ["log", "khoảng thời gian", "18:00", "20:00", "sắp xếp", "mới nhất", "desc"],
    "query": {
      "query": {
        "range": {
          "@timestamp": {
            "gte": "2025-10-07T18:00:00.000+07:00",
            "lt": "2025-10-07T20:00:00.000+07:00"
          }
        }
      },
      "size": 50,
      "sort": [
        {
          "@timestamp": "desc"
        }
      ]
    }
  },
  {
    "question": "Lấy 100 log mới nhất trong khoảng từ 8h đến 9h sáng ngày 08/10/2025",
    "keywords": ["log", "100", "mới nhất", "8h", "9h", "sáng"],
    "query": {
      "query": {
        "range": {
          "@timestamp": {
            "gte": "2025-10-08T08:00:00.000+07:00",
            "lt": "2025-10-08T09:00:00.000+07:00"
          }
        }
      },
      "size": 100,
      "sort": [
        {
          "@timestamp": "desc"
        }
      ]
    }
  },
  {
    "question": "Hiển thị các hoạt động từ 22h đêm ngày 05/10/2025 đến 1h sáng ngày 06/10/2025",
    "keywords": ["hoạt động", "log", "22h", "đêm", "1h", "sáng"],
    "query": {
      "query": {
        "range": {
          "@timestamp": {
            "gte": "2025-10-05T22:00:00.000+07:00",
            "lt": "2025-10-06T01:00:00.000+07:00"
          }
        }
      },
      "size": 50,
      "sort": [
        {
          "@timestamp": "desc"
        }
      ]
    }
  },
  {
    "question": "Tìm tất cả log của ngày 01/10/2025, hiển thị mới nhất trước",
    "keywords": ["log", "toàn bộ ngày", "cả ngày"],
    "query": {
      "query": {
        "range": {
          "@timestamp": {
            "gte": "2025-10-01T00:00:00.000+07:00",
            "lte": "2025-10-01T23:59:59.999+07:00"
          }
        }
      },
      "size": 50,
      "sort": [
        {
          "@timestamp": "desc"
        }
      ]
    }
  },
  {
    "question": "Lấy các log trong 2 giờ, từ 10:00 đến 12:00 ngày 06/10/2025, sắp xếp cũ nhất trước",
    "keywords": ["log", "10:00", "12:00", "cũ nhất", "asc"],
    "query": {
      "query": {
        "range": {
          "@timestamp": {
            "gte": "2025-10-06T10:00:00.000+07:00",
            "lt": "2025-10-06T12:00:00.000+07:00"
          }
        }
      },
      "size": 50,
      "sort": [
        {
          "@timestamp": "asc"
        }
      ]
    }
  },
  {
    "question": "Hiển thị 20 log trong khoảng 15:00 đến 15:15 ngày 08/10/2025",
    "keywords": ["log", "20", "15:00", "15:15", "ngày"],
    "query": {
      "query": {
        "range": {
          "@timestamp": {
            "gte": "2025-10-08T15:00:00.000+07:00",
            "lt": "2025-10-08T15:15:00.000+07:00"
          }
        }
      },
      "size": 20,
      "sort": [
        {
          "@timestamp": "desc"
        }
      ]
    }
  },
  {
    "question": "Tìm các log trong giờ làm việc (8h-17h) của ngày 03/10/2025",
    "keywords": ["log", "giờ làm việc", "8h", "17h", "ngày"],
    "query": {
      "query": {
        "range": {
          "@timestamp": {
            "gte": "2025-10-03T08:00:00.000+07:00",
            "lt": "2025-10-03T17:00:00.000+07:00"
          }
        }
      },
      "size": 50,
      "sort": [
        {
          "@timestamp": "desc"
        }
      ]
    }
  },
  {
    "question": "Lấy 10 log mới nhất từ 00:00 đến 01:00 sáng ngày 02/10/2025",
    "keywords": ["log", "10", "mới nhất", "00:00", "01:00", "sáng", "ngày"],
    "query": {
      "query": {
        "range": {
          "@timestamp": {
            "gte": "2025-10-02T00:00:00.000+07:00",
            "lt": "2025-10-02T01:00:00.000+07:00"
          }
        }
      },
      "size": 10,
      "sort": [
        {
          "@timestamp": "desc"
        }
      ]
    }
  },
  {
    "question": "Phân tích log trong 30 phút, từ 11:00 đến 11:30 ngày 04/10/2025",
    "keywords": ["log", "30 phút", "11:00", "11:30", "ngày"],
    "query": {
      "query": {
        "range": {
          "@timestamp": {
            "gte": "2025-10-04T11:00:00.000+07:00",
            "lt": "2025-10-04T11:30:00.000+07:00"
          }
        }
      },
      "size": 50,
      "sort": [
        {
          "@timestamp": "desc"
        }
      ]
    }
  },
  {
    "question": "Hiển thị các log trong giờ ăn trưa (12h-13h) của ngày 09/10/2025",
    "keywords": ["log", "giờ ăn trưa", "12h", "13h", "ngày"],
    "query": {
      "query": {
        "range": {
          "@timestamp": {
            "gte": "2025-10-09T12:00:00.000+07:00",
            "lt": "2025-10-09T13:00:00.000+07:00"
          }
        }
      },
      "size": 50,
      "sort": [
        {
          "@timestamp": "desc"
        }
      ]
    }
  },
  {
    "question": "Ai đang truy cập internet từ mạng nội bộ qua các cổng ra ngoài trong 7 ngày qua?",
    "keywords": [
      "web",
      "user",
      "người dùng",
      "truy cập internet",
      "internet access",
      "mạng nội bộ",
      "internal network",
      "đi ra ngoài",
      "ra internet",
      "outbound internet",
      "port1",
      "port2",
      "cổng ra",
      "egress",
      "7 ngày qua",
      "observer.egress.interface.name",
      "network.protocol",
      "http",
      "https",
      "tổ chức đích",
      "destination.as.organization.name",
      "network.direction",
      "outbound",
      "external",
      "fortinet.firewall.transip"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "terms": { "network.protocol": ["http", "https"] } },
            { "range": { "@timestamp": { "gte": "now-7d" } } },
            {
              "bool": {
                "should": [
                  {
                    "bool": {
                      "filter": [
                        { "terms": { "fortinet.firewall.transip": ["118.70.81.176", "101.99.13.33"] } },
                        { "terms": { "network.direction": ["outbound", "external"] } }
                      ]
                    }
                  },
                  {
                    "bool": {
                      "filter": [
                        { "terms": { "source.ip": ["118.70.81.176", "101.99.13.33"] } },
                        { "terms": { "network.direction": ["outbound", "external"] } },
                        { "bool": { "must_not": { "exists": { "field": "fortinet.firewall.transip" } } } }
                      ]
                    }
                  }
                ],
                "minimum_should_match": 1
              }
            }
          ]
        }
      },
      "aggs": {
        "by_user": {
          "terms": { "field": "source.user.name", "size": 50 },
          "aggs": {
            "top_organizations": {
              "terms": { "field": "destination.as.organization.name", "size": 10 },
              "aggs": {
                "org_bytes": { "sum": { "field": "network.bytes" } }
              }
            }
          }
        },
        "top_organizations_global": {
          "terms": { "field": "destination.as.organization.name", "size": 20 },
          "aggs": {
            "total_bytes": { "sum": { "field": "network.bytes" } },
            "unique_users": { "cardinality": { "field": "source.user.name" } }
          }
        }
      }
    }
  },
  {
    "question": "User nào sử dụng băng thông ra internet nhiều nhất trong ngày 7/10?",
    "keywords": [
      "web",
      "user",
      "người dùng",
      "băng thông",
      "bandwidth",
      "lưu lượng ra internet",
      "internet traffic",
      "outbound traffic",
      "nhiều nhất",
      "top user",
      "ngày 7/10",
      "specific date",
      "port1",
      "port2",
      "cổng ra ngoài",
      "internet gateway",
      "observer.egress.interface.name",
      "network.bytes",
      "tổ chức đích",
      "destination.as.organization.name",
      "network.direction",
      "outbound",
      "external",
      "fortinet.firewall.transip"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "2025-10-07T00:00:00.000+07:00", "lte": "2025-10-07T23:59:59.999+07:00" } } },
            {
              "bool": {
                "should": [
                  {
                    "bool": {
                      "filter": [
                        { "terms": { "fortinet.firewall.transip": ["118.70.81.176", "101.99.13.33"] } },
                        { "terms": { "network.direction": ["outbound", "external"] } }
                      ]
                    }
                  },
                  {
                    "bool": {
                      "filter": [
                        { "terms": { "source.ip": ["118.70.81.176", "101.99.13.33"] } },
                        { "terms": { "network.direction": ["outbound", "external"] } },
                        { "bool": { "must_not": { "exists": { "field": "fortinet.firewall.transip" } } } }
                      ]
                    }
                  }
                ],
                "minimum_should_match": 1
              }
            }
          ]
        }
      },
      "aggs": {
        "top_users": {
          "terms": { "field": "source.user.name", "size": 20, "order": { "total_bytes": "desc" } },
          "aggs": {
            "total_bytes": { "sum": { "field": "network.bytes" } },
            "total_sessions": { "value_count": { "field": "@timestamp" } },
            "by_interface": {
              "terms": { "field": "observer.egress.interface.name", "size": 5 },
              "aggs": {
                "interface_bytes": { "sum": { "field": "network.bytes" } }
              }
            },
            "top_organizations": {
              "terms": { "field": "destination.as.organization.name", "size": 10, "order": { "org_bytes": "desc" } },
              "aggs": {
                "org_bytes": { "sum": { "field": "network.bytes" } }
              }
            }
          }
        },
        "organization_stats": {
          "terms": { "field": "destination.as.organization.name", "size": 15, "order": { "total_bytes": "desc" } },
          "aggs": {
            "total_bytes": { "sum": { "field": "network.bytes" } },
            "unique_users": { "cardinality": { "field": "source.user.name" } }
          }
        }
      }
    }
  },
  {
    "question": "So sánh lưu lượng ra internet giữa các đường truyền (port1 vs port2)",
    "keywords": [
      "web",
      "so sánh",
      "compare",
      "lưu lượng ra internet",
      "internet traffic",
      "outbound traffic",
      "đường truyền",
      "internet connection",
      "interface",
      "port1",
      "port2",
      "cổng internet",
      "internet gateway",
      "24h qua",
      "observer.egress.interface.name",
      "network.bytes",
      "bandwidth comparison",
      "tổ chức đích",
      "destination.as.organization.name",
      "network.direction",
      "outbound",
      "external",
      "fortinet.firewall.transip"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-24h" } } },
            {
              "bool": {
                "should": [
                  {
                    "bool": {
                      "filter": [
                        { "terms": { "fortinet.firewall.transip": ["118.70.81.176", "101.99.13.33"] } },
                        { "terms": { "network.direction": ["outbound", "external"] } }
                      ]
                    }
                  },
                  {
                    "bool": {
                      "filter": [
                        { "terms": { "source.ip": ["118.70.81.176", "101.99.13.33"] } },
                        { "terms": { "network.direction": ["outbound", "external"] } },
                        { "bool": { "must_not": { "exists": { "field": "fortinet.firewall.transip" } } } }
                      ]
                    }
                  }
                ],
                "minimum_should_match": 1
              }
            }
          ]
        }
      },
      "aggs": {
        "by_interface": {
          "terms": { "field": "observer.egress.interface.name", "size": 10 },
          "aggs": {
            "total_bytes": { "sum": { "field": "network.bytes" } },
            "total_sessions": { "value_count": { "field": "@timestamp" } },
            "top_users": {
              "terms": { "field": "source.user.name", "size": 10, "order": { "user_bytes": "desc" } },
              "aggs": {
                "user_bytes": { "sum": { "field": "network.bytes" } }
              }
            },
            "top_organizations": {
              "terms": { "field": "destination.as.organization.name", "size": 15, "order": { "org_bytes": "desc" } },
              "aggs": {
                "org_bytes": { "sum": { "field": "network.bytes" } },
                "unique_users": { "cardinality": { "field": "source.user.name" } }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Lưu lượng từ internet vào mạng nội bộ qua các cổng kết nối",
    "keywords": [
      "lưu lượng từ internet",
      "internet inbound traffic",
      "từ ngoài vào",
      "inbound",
      "vào mạng nội bộ",
      "vào công ty",
      "incoming traffic",
      "port1",
      "port2",
      "cổng vào",
      "internet gateway",
      "đường truyền internet",
      "24h qua",
      "observer.ingress.interface.name",
      "external to internal",
      "network.direction",
      "destination.ip"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-24h" } } },
            { "terms": { "destination.ip": ["118.70.81.176", "101.99.13.33"] } },
            { "term": { "network.direction": "inbound" } }
          ]
        }
      },
      "aggs": {
        "by_interface": {
          "terms": { "field": "observer.ingress.interface.name", "size": 10 },
          "aggs": {
            "total_bytes": { "sum": { "field": "network.bytes" } },
            "by_destination": {
              "terms": { "field": "destination.ip", "size": 10, "order": { "dest_bytes": "desc" } },
              "aggs": {
                "dest_bytes": { "sum": { "field": "network.bytes" } }
              }
            },
            "by_source_country": {
              "terms": { "field": "source.geo.country_name", "size": 10 },
              "aggs": {
                "country_bytes": { "sum": { "field": "network.bytes" } }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Phân tích chi tiết user sử dụng internet nhiều nhất theo từng đường truyền",
    "keywords": [
      "web",
      "user",
      "người dùng",
      "sử dụng internet",
      "internet usage",
      "web browsing",
      "truy cập web",
      "nhiều nhất",
      "top user",
      "phân tích chi tiết",
      "breakdown analysis",
      "theo đường truyền",
      "by interface",
      "port1",
      "port2",
      "internet connection",
      "observer.egress.interface.name",
      "network.protocol",
      "http",
      "https",
      "7 ngày qua",
      "tổ chức đích",
      "destination.as.organization.name",
      "network.direction",
      "outbound",
      "external",
      "fortinet.firewall.transip"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "terms": { "network.protocol": ["http", "https"] } },
            { "range": { "@timestamp": { "gte": "now-7d" } } },
            {
              "bool": {
                "should": [
                  {
                    "bool": {
                      "filter": [
                        { "terms": { "fortinet.firewall.transip": ["118.70.81.176", "101.99.13.33"] } },
                        { "terms": { "network.direction": ["outbound", "external"] } }
                      ]
                    }
                  },
                  {
                    "bool": {
                      "filter": [
                        { "terms": { "source.ip": ["118.70.81.176", "101.99.13.33"] } },
                        { "terms": { "network.direction": ["outbound", "external"] } },
                        { "bool": { "must_not": { "exists": { "field": "fortinet.firewall.transip" } } } }
                      ]
                    }
                  }
                ],
                "minimum_should_match": 1
              }
            }
          ]
        }
      },
      "aggs": {
        "top_users": {
          "terms": { "field": "source.user.name", "size": 20, "order": { "total_bytes": "desc" } },
          "aggs": {
            "total_bytes": { "sum": { "field": "network.bytes" } },
            "by_interface": {
              "terms": { "field": "observer.egress.interface.name" },
              "aggs": {
                "interface_bytes": { "sum": { "field": "network.bytes" } },
                "top_organizations": {
                  "terms": { "field": "destination.as.organization.name", "size": 10, "order": { "org_bytes": "desc" } },
                  "aggs": {
                    "org_bytes": { "sum": { "field": "network.bytes" } }
                  }
                }
              }
            },
            "user_organizations": {
              "terms": { "field": "destination.as.organization.name", "size": 15, "order": { "org_bytes": "desc" } },
              "aggs": {
                "org_bytes": { "sum": { "field": "network.bytes" } }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Lịch sử truy cập internet của nhân viên - những website nào được truy cập trong 7 ngày qua?",
    "keywords": [
      "web",
      "lịch sử truy cập internet",
      "internet history",
      "nhân viên",
      "user",
      "người dùng",
      "website được truy cập",
      "trang web",
      "web browsing history",
      "internet activity",
      "hoạt động internet",
      "7 ngày qua",
      "http",
      "https",
      "network.protocol",
      "tổ chức đích",
      "destination.as.organization.name",
      "network.direction",
      "outbound",
      "external",
      "fortinet.firewall.transip"
    ],
    "query": {
      "query": {
        "bool": {
          "filter": [
            {
              "terms": {
                "network.protocol": ["http", "https"]
              }
            },
            {
              "range": {
                "@timestamp": {
                  "gte": "now-7d"
                }
              }
            },
            {
              "bool": {
                "should": [
                  {
                    "bool": {
                      "filter": [
                        { "terms": { "fortinet.firewall.transip": ["118.70.81.176", "101.99.13.33"] } },
                        { "terms": { "network.direction": ["outbound", "external"] } }
                      ]
                    }
                  },
                  {
                    "bool": {
                      "filter": [
                        { "terms": { "source.ip": ["118.70.81.176", "101.99.13.33"] } },
                        { "terms": { "network.direction": ["outbound", "external"] } },
                        { "bool": { "must_not": { "exists": { "field": "fortinet.firewall.transip" } } } }
                      ]
                    }
                  }
                ],
                "minimum_should_match": 1
              }
            }
          ]
        }
      },
      "aggs": {
        "by_user": {
          "terms": {
            "field": "source.user.name",
            "size": 10
          },
          "aggs": {
            "user_organizations": {
              "terms": { "field": "destination.as.organization.name", "size": 15 },
              "aggs": {
                "org_bytes": { "sum": { "field": "network.bytes" } }
              }
            }
          }
        },
        "top_organizations": {
          "terms": { "field": "destination.as.organization.name", "size": 20 },
          "aggs": {
            "total_bytes": { "sum": { "field": "network.bytes" } },
            "unique_users": { "cardinality": { "field": "source.user.name" } }
          }
        }
      },
      "_source": ["@timestamp", "source.user.name", "source.ip", "url.original", "network.protocol", "destination.as.organization.name"],
      "sort": [
        {
          "@timestamp": "desc"
        }
      ],
      "size": 100
    }
  },
  {
    "question": "Thống kê top các tổ chức/nhà cung cấp dịch vụ được nhân viên truy cập nhiều nhất",
    "keywords": [
      "web",
      "thống kê",
      "statistics",
      "top tổ chức",
      "top organization",
      "nhà cung cấp dịch vụ",
      "service provider",
      "nhân viên truy cập",
      "employee access",
      "truy cập nhiều nhất",
      "most accessed",
      "destination.as.organization.name",
      "tổ chức đích",
      "internet usage",
      "web traffic",
      "outbound traffic",
      "network.direction",
      "outbound",
      "external",
      "fortinet.firewall.transip"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "terms": { "network.protocol": ["http", "https"] } },
            { "range": { "@timestamp": { "gte": "now-7d" } } },
            { "exists": { "field": "destination.as.organization.name" } },
            {
              "bool": {
                "should": [
                  {
                    "bool": {
                      "filter": [
                        { "terms": { "fortinet.firewall.transip": ["118.70.81.176", "101.99.13.33"] } },
                        { "terms": { "network.direction": ["outbound", "external"] } }
                      ]
                    }
                  },
                  {
                    "bool": {
                      "filter": [
                        { "terms": { "source.ip": ["118.70.81.176", "101.99.13.33"] } },
                        { "terms": { "network.direction": ["outbound", "external"] } },
                        { "bool": { "must_not": { "exists": { "field": "fortinet.firewall.transip" } } } }
                      ]
                    }
                  }
                ],
                "minimum_should_match": 1
              }
            }
          ]
        }
      },
      "aggs": {
        "top_organizations": {
          "terms": { "field": "destination.as.organization.name", "size": 25, "order": { "total_bytes": "desc" } },
          "aggs": {
            "total_bytes": { "sum": { "field": "network.bytes" } },
            "unique_users": { "cardinality": { "field": "source.user.name" } },
            "total_sessions": { "value_count": { "field": "@timestamp" } },
            "top_users": {
              "terms": { "field": "source.user.name", "size": 5, "order": { "user_bytes": "desc" } },
              "aggs": {
                "user_bytes": { "sum": { "field": "network.bytes" } }
              }
            },
            "by_country": {
              "terms": { "field": "destination.geo.country_name", "size": 5 },
              "aggs": {
                "country_bytes": { "sum": { "field": "network.bytes" } }
              }
            }
          }
        },
        "organization_summary": {
          "stats": { "field": "network.bytes" }
        }
      }
    }
  },
  {
    "question": "User truy cập web ra ngoài qua public IP trong 7 ngày qua",
    "keywords": [
      "user",
      "người dùng",
      "truy cập web",
      "web access",
      "public IP",
      "IP công cộng",
      "source.nat.ip",
      "7 ngày qua",
      "network.protocol",
      "http",
      "https",
      "destination.as.organization.name"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "terms": {
                "network.protocol": ["http", "https"]
              }
            },
            {
              "range": {
                "@timestamp": {
                  "gte": "now-7d"
                }
              }
            },
            {
              "exists": {
                "field": "destination.as.organization.name"
              }
            }
          ],
          "should": [
            {
              "term": {
                "observer.egress.interface.name": "port1"
              }
            },
            {
              "term": {
                "observer.egress.interface.name": "port2"
              }
            },
            {
              "terms": {
                "source.nat.ip": ["118.70.81.176", "101.99.13.33"]
              }
            }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "by_user": {
          "terms": {
            "field": "source.user.name",
            "size": 50
          },
          "aggs": {
            "total_bytes": {
              "sum": {
                "field": "network.bytes"
              }
            },
            "websites": {
              "terms": {
                "field": "destination.as.organization.name",
                "size": 100
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Ai sử dụng lưu lượng internet nhiều nhất ngày 7/10 (đi ra)",
    "keywords": [
      "ai",
      "user",
      "sử dụng",
      "lưu lượng",
      "internet",
      "nhiều nhất",
      "top",
      "ngày 7/10",
      "outbound",
      "đi ra",
      "network.direction",
      "source.nat.ip",
      "public IP"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "2025-10-07T00:00:00.000+07:00",
                  "lte": "2025-10-07T23:59:59.999+07:00"
                }
              }
            },
            {
              "term": {
                "network.direction": "outbound"
              }
            }
          ],
          "should": [
            {
              "term": {
                "observer.egress.interface.name": "port1"
              }
            },
            {
              "term": {
                "observer.egress.interface.name": "port2"
              }
            },
            {
              "terms": {
                "source.nat.ip": ["118.70.81.176", "101.99.13.33"]
              }
            }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "top_users": {
          "terms": {
            "field": "source.user.name",
            "size": 20,
            "order": {
              "total_bytes": "desc"
            }
          },
          "aggs": {
            "total_bytes": {
              "sum": {
                "field": "network.bytes"
              }
            },
            "total_sessions": {
              "value_count": {
                "field": "@timestamp"
              }
            },
            "by_interface": {
              "terms": {
                "field": "observer.egress.interface.name",
                "size": 5
              },
              "aggs": {
                "interface_bytes": {
                  "sum": {
                    "field": "network.bytes"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Traffic đi vào (inbound) đến public IP của tổ chức",
    "keywords": ["traffic", "lưu lượng", "inbound", "đi vào", "public IP", "IP công cộng", "destination.ip", "observer.ingress.interface.name"],
    "query": {
      "size": 50,
      "sort": [
        {
          "@timestamp": "desc"
        }
      ],
      "_source": [
        "@timestamp",
        "source.ip",
        "source.geo.country_name",
        "destination.ip",
        "destination.port",
        "network.bytes",
        "rule.name",
        "observer.ingress.interface.name"
      ],
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "now-24h"
                }
              }
            },
            {
              "term": {
                "network.direction": "inbound"
              }
            }
          ],
          "should": [
            {
              "term": {
                "observer.ingress.interface.name": "port1"
              }
            },
            {
              "term": {
                "observer.ingress.interface.name": "port2"
              }
            },
            {
              "terms": {
                "destination.ip": ["118.70.81.176", "101.99.13.33"]
              }
            }
          ],
          "minimum_should_match": 1
        }
      }
    }
  },
  {
    "question": "Phân tích traffic inbound theo public IP và interface",
    "keywords": [
      "phân tích",
      "analysis",
      "traffic",
      "lưu lượng",
      "inbound",
      "đi vào",
      "public IP",
      "IP công cộng",
      "interface",
      "destination.ip",
      "source.geo.country_name"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "now-24h"
                }
              }
            }
          ],
          "should": [
            {
              "term": {
                "observer.ingress.interface.name": "port1"
              }
            },
            {
              "term": {
                "observer.ingress.interface.name": "port2"
              }
            },
            {
              "terms": {
                "destination.ip": ["118.70.81.176", "101.99.13.33"]
              }
            }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "by_public_ip": {
          "terms": {
            "field": "destination.ip",
            "include": ["118.70.81.176", "101.99.13.33"],
            "size": 10
          },
          "aggs": {
            "total_bytes": {
              "sum": {
                "field": "network.bytes"
              }
            },
            "total_connections": {
              "value_count": {
                "field": "@timestamp"
              }
            },
            "top_source_countries": {
              "terms": {
                "field": "source.geo.country_name",
                "size": 10
              }
            },
            "top_ports": {
              "terms": {
                "field": "destination.port",
                "size": 10
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "So sánh traffic outbound và inbound qua public IP",
    "keywords": [
      "so sánh",
      "compare",
      "traffic",
      "lưu lượng",
      "outbound",
      "inbound",
      "đi ra",
      "đi vào",
      "public IP",
      "IP công cộng",
      "network.direction"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "now-24h"
                }
              }
            }
          ],
          "should": [
            {
              "bool": {
                "filter": [
                  {
                    "term": {
                      "network.direction": "outbound"
                    }
                  },
                  {
                    "terms": {
                      "source.nat.ip": ["118.70.81.176", "101.99.13.33"]
                    }
                  }
                ]
              }
            },
            {
              "bool": {
                "filter": [
                  {
                    "term": {
                      "network.direction": "inbound"
                    }
                  },
                  {
                    "terms": {
                      "destination.ip": ["118.70.81.176", "101.99.13.33"]
                    }
                  }
                ]
              }
            }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "by_direction": {
          "terms": {
            "field": "network.direction",
            "size": 10
          },
          "aggs": {
            "total_bytes": {
              "sum": {
                "field": "network.bytes"
              }
            },
            "total_sessions": {
              "value_count": {
                "field": "@timestamp"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "User truy cập web nhiều nhất với đầy đủ thông tin",
    "keywords": [
      "user",
      "người dùng",
      "truy cập web",
      "web access",
      "nhiều nhất",
      "top",
      "đầy đủ thông tin",
      "source.nat.ip",
      "public IP",
      "network.direction",
      "outbound"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "terms": {
                "network.protocol": ["http", "https"]
              }
            },
            {
              "range": {
                "@timestamp": {
                  "gte": "now-7d"
                }
              }
            },
            {
              "term": {
                "network.direction": "outbound"
              }
            }
          ],
          "should": [
            {
              "term": {
                "observer.egress.interface.name": "port1"
              }
            },
            {
              "term": {
                "observer.egress.interface.name": "port2"
              }
            },
            {
              "terms": {
                "source.nat.ip": ["118.70.81.176", "101.99.13.33"]
              }
            }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "top_users": {
          "terms": {
            "field": "source.user.name",
            "size": 20,
            "order": {
              "total_bytes": "desc"
            }
          },
          "aggs": {
            "total_bytes": {
              "sum": {
                "field": "network.bytes"
              }
            },
            "total_sessions": {
              "value_count": {
                "field": "@timestamp"
              }
            },
            "by_interface": {
              "terms": {
                "field": "observer.egress.interface.name"
              },
              "aggs": {
                "interface_bytes": {
                  "sum": {
                    "field": "network.bytes"
                  }
                }
              }
            },
            "by_nat_ip": {
              "terms": {
                "field": "source.nat.ip"
              },
              "aggs": {
                "nat_bytes": {
                  "sum": {
                    "field": "network.bytes"
                  }
                }
              }
            },
            "unique_websites": {
              "cardinality": {
                "field": "destination.as.organization.name"
              }
            },
            "top_websites": {
              "terms": {
                "field": "destination.as.organization.name",
                "size": 10,
                "order": {
                  "site_bytes": "desc"
                }
              },
              "aggs": {
                "site_bytes": {
                  "sum": {
                    "field": "network.bytes"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Chi tiết các kết nối đi ra qua public IP",
    "keywords": ["chi tiết", "kết nối", "connection", "đi ra", "outbound", "public IP", "IP công cộng", "source.nat.ip", "network.direction"],
    "query": {
      "size": 100,
      "sort": [
        {
          "network.bytes": "desc"
        }
      ],
      "_source": [
        "@timestamp",
        "source.ip",
        "source.user.name",
        "source.nat.ip",
        "destination.ip",
        "destination.port",
        "destination.as.organization.name",
        "network.bytes",
        "network.protocol",
        "observer.egress.interface.name",
        "rule.name"
      ],
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "now-24h"
                }
              }
            },
            {
              "term": {
                "network.direction": "outbound"
              }
            }
          ],
          "should": [
            {
              "term": {
                "observer.egress.interface.name": "port1"
              }
            },
            {
              "term": {
                "observer.egress.interface.name": "port2"
              }
            },
            {
              "terms": {
                "source.nat.ip": ["118.70.81.176", "101.99.13.33"]
              }
            }
          ],
          "minimum_should_match": 1
        }
      }
    }
  },
  {
    "question": "User kết nối tới tổ chức nào nhiều nhất trong 7 ngày qua",
    "keywords": ["user", "người dùng", "kết nối", "tổ chức", "organization", "nhiều nhất", "top", "7 ngày qua", "destination.as.organization.name"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "now-7d"
                }
              }
            },
            {
              "term": {
                "network.direction": "outbound"
              }
            },
            {
              "exists": {
                "field": "destination.as.organization.name"
              }
            }
          ],
          "should": [
            {
              "term": {
                "observer.egress.interface.name": "port1"
              }
            },
            {
              "term": {
                "observer.egress.interface.name": "port2"
              }
            },
            {
              "terms": {
                "source.nat.ip": ["118.70.81.176", "101.99.13.33"]
              }
            }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "by_user": {
          "terms": {
            "field": "source.user.name",
            "size": 50
          },
          "aggs": {
            "total_bytes": {
              "sum": {
                "field": "network.bytes"
              }
            },
            "total_connections": {
              "value_count": {
                "field": "@timestamp"
              }
            },
            "top_organizations": {
              "terms": {
                "field": "destination.as.organization.name",
                "size": 20,
                "order": {
                  "org_bytes": "desc"
                }
              },
              "aggs": {
                "org_bytes": {
                  "sum": {
                    "field": "network.bytes"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Top tổ chức được truy cập nhiều nhất",
    "keywords": ["top", "tổ chức", "organization", "truy cập nhiều nhất", "destination.as.organization.name", "network.bytes", "sum", "order"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "now-7d"
                }
              }
            },
            {
              "term": {
                "network.direction": "outbound"
              }
            },
            {
              "exists": {
                "field": "destination.as.organization.name"
              }
            }
          ],
          "should": [
            {
              "term": {
                "observer.egress.interface.name": "port1"
              }
            },
            {
              "term": {
                "observer.egress.interface.name": "port2"
              }
            },
            {
              "terms": {
                "source.nat.ip": ["118.70.81.176", "101.99.13.33"]
              }
            }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "top_organizations": {
          "terms": {
            "field": "destination.as.organization.name",
            "size": 30,
            "order": {
              "total_bytes": "desc"
            }
          },
          "aggs": {
            "total_bytes": {
              "sum": {
                "field": "network.bytes"
              }
            },
            "total_connections": {
              "value_count": {
                "field": "@timestamp"
              }
            },
            "unique_users": {
              "cardinality": {
                "field": "source.user.name"
              }
            },
            "top_users": {
              "terms": {
                "field": "source.user.name",
                "size": 10
              }
            },
            "top_protocols": {
              "terms": {
                "field": "network.protocol",
                "size": 5
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Ai sử dụng lưu lượng nhiều nhất ngày 7/10 (theo tổ chức)",
    "keywords": [
      "ai",
      "user",
      "sử dụng",
      "lưu lượng",
      "nhiều nhất",
      "top",
      "ngày 7/10",
      "specific date",
      "tổ chức",
      "organization",
      "destination.as.organization.name"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "2025-10-07T00:00:00.000+07:00",
                  "lte": "2025-10-07T23:59:59.999+07:00"
                }
              }
            },
            {
              "term": {
                "network.direction": "outbound"
              }
            }
          ],
          "should": [
            {
              "term": {
                "observer.egress.interface.name": "port1"
              }
            },
            {
              "term": {
                "observer.egress.interface.name": "port2"
              }
            },
            {
              "terms": {
                "source.nat.ip": ["118.70.81.176", "101.99.13.33"]
              }
            }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "top_users": {
          "terms": {
            "field": "source.user.name",
            "size": 20,
            "order": {
              "total_bytes": "desc"
            }
          },
          "aggs": {
            "total_bytes": {
              "sum": {
                "field": "network.bytes"
              }
            },
            "total_sessions": {
              "value_count": {
                "field": "@timestamp"
              }
            },
            "unique_organizations": {
              "cardinality": {
                "field": "destination.as.organization.name"
              }
            },
            "top_organizations": {
              "terms": {
                "field": "destination.as.organization.name",
                "size": 10,
                "order": {
                  "org_bytes": "desc"
                }
              },
              "aggs": {
                "org_bytes": {
                  "sum": {
                    "field": "network.bytes"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Chi tiết kết nối tới từng tổ chức",
    "keywords": ["chi tiết", "kết nối", "connection", "tổ chức", "organization", "destination.as.organization.name", "destination.as.number"],
    "query": {
      "size": 100,
      "sort": [
        {
          "network.bytes": "desc"
        }
      ],
      "_source": [
        "@timestamp",
        "source.ip",
        "source.user.name",
        "destination.ip",
        "destination.as.organization.name",
        "destination.as.number",
        "destination.geo.country_name",
        "destination.port",
        "network.protocol",
        "network.bytes",
        "observer.egress.interface.name",
        "rule.name"
      ],
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "now-24h"
                }
              }
            },
            {
              "term": {
                "network.direction": "outbound"
              }
            },
            {
              "exists": {
                "field": "destination.as.organization.name"
              }
            }
          ],
          "should": [
            {
              "term": {
                "observer.egress.interface.name": "port1"
              }
            },
            {
              "term": {
                "observer.egress.interface.name": "port2"
              }
            },
            {
              "terms": {
                "source.nat.ip": ["118.70.81.176", "101.99.13.33"]
              }
            }
          ],
          "minimum_should_match": 1
        }
      }
    }
  },
  {
    "question": "Phân tích theo cả URL và tổ chức (cho HTTP/HTTPS)",
    "keywords": ["phân tích", "analysis", "URL", "tổ chức", "organization", "HTTP", "HTTPS", "network.protocol", "destination.as.organization.name"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "terms": {
                "network.protocol": ["http", "https"]
              }
            },
            {
              "range": {
                "@timestamp": {
                  "gte": "now-7d"
                }
              }
            }
          ],
          "should": [
            {
              "term": {
                "observer.egress.interface.name": "port1"
              }
            },
            {
              "term": {
                "observer.egress.interface.name": "port2"
              }
            },
            {
              "terms": {
                "source.nat.ip": ["118.70.81.176", "101.99.13.33"]
              }
            }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "by_organization": {
          "terms": {
            "field": "destination.as.organization.name",
            "size": 20,
            "order": {
              "total_bytes": "desc"
            }
          },
          "aggs": {
            "total_bytes": {
              "sum": {
                "field": "network.bytes"
              }
            },
            "unique_users": {
              "cardinality": {
                "field": "source.user.name"
              }
            },
            "top_domains": {
              "terms": {
                "field": "destination.as.organization.name",
                "size": 10
              }
            },
            "top_users": {
              "terms": {
                "field": "source.user.name",
                "size": 10,
                "order": {
                  "user_bytes": "desc"
                }
              },
              "aggs": {
                "user_bytes": {
                  "sum": {
                    "field": "network.bytes"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Tìm các tổ chức đáng ngờ hoặc không phổ biến",
    "keywords": [
      "tìm",
      "tổ chức",
      "organization",
      "đáng ngờ",
      "suspicious",
      "không phổ biến",
      "rare",
      "destination.as.organization.name",
      "must_not"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "now-24h"
                }
              }
            },
            {
              "term": {
                "network.direction": "outbound"
              }
            },
            {
              "exists": {
                "field": "destination.as.organization.name"
              }
            }
          ],
          "should": [
            {
              "term": {
                "observer.egress.interface.name": "port1"
              }
            },
            {
              "term": {
                "observer.egress.interface.name": "port2"
              }
            }
          ],
          "minimum_should_match": 1,
          "must_not": [
            {
              "terms": {
                "destination.as.organization.name": ["GOOGLE", "MICROSOFT-CORP-MSN-AS-BLOCK", "FACEBOOK", "AMAZON-AES", "CLOUDFLARENET"]
              }
            }
          ]
        }
      },
      "aggs": {
        "rare_organizations": {
          "terms": {
            "field": "destination.as.organization.name",
            "size": 50,
            "order": {
              "total_connections": "asc"
            }
          },
          "aggs": {
            "total_connections": {
              "value_count": {
                "field": "@timestamp"
              }
            },
            "total_bytes": {
              "sum": {
                "field": "network.bytes"
              }
            },
            "users": {
              "terms": {
                "field": "source.user.name",
                "size": 5
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Xem các sự kiện nguy hiểm của từng tổ chức",
    "keywords": [
      "sự kiện nguy hiểm",
      "dangerous events",
      "tổ chức",
      "organization",
      "destination.as.organization.name",
      "fortinet.firewall.action",
      "deny",
      "attack",
      "virus",
      "botnet"
    ],
    "query": {
      "size": 100,
      "sort": [
        {
          "@timestamp": "desc"
        }
      ],
      "_source": [
        "@timestamp",
        "source.ip",
        "source.user.name",
        "destination.ip",
        "destination.as.organization.name",
        "destination.geo.country_name",
        "destination.port",
        "network.protocol",
        "network.bytes",
        "fortinet.firewall.action",
        "fortinet.firewall.attack",
        "fortinet.firewall.crlevel",
        "fortinet.firewall.virus",
        "fortinet.firewall.botnetip",
        "rule.name"
      ],
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "2025-10-01T00:00:00.000+07:00",
                  "lte": "2025-10-31T23:59:59.999+07:00"
                }
              }
            },
            {
              "exists": {
                "field": "destination.as.organization.name"
              }
            }
          ],
          "should": [
            {
              "term": {
                "fortinet.firewall.action": "deny"
              }
            },
            {
              "exists": {
                "field": "fortinet.firewall.attack"
              }
            },
            {
              "exists": {
                "field": "fortinet.firewall.virus"
              }
            },
            {
              "exists": {
                "field": "fortinet.firewall.botnetip"
              }
            },
            {
              "terms": {
                "fortinet.firewall.crlevel": ["high", "critical"]
              }
            },
            {
              "terms": {
                "destination.geo.country_name": ["Russia", "China", "North Korea", "Iran"]
              }
            },
            {
              "terms": {
                "destination.port": [22, 23, 3389, 445, 135, 139, 1433, 3306]
              }
            }
          ],
          "minimum_should_match": 1
        }
      }
    }
  },
  {
    "question": "Top 20 tổ chức nguy hiểm với thông tin chi tiết",
    "keywords": [
      "top 20",
      "tổ chức nguy hiểm",
      "dangerous organizations",
      "destination.as.organization.name",
      "fortinet.firewall.action",
      "deny",
      "attack",
      "virus",
      "botnet"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "2025-10-01T00:00:00.000+07:00",
                  "lte": "2025-10-31T23:59:59.999+07:00"
                }
              }
            },
            {
              "term": {
                "network.direction": "outbound"
              }
            }
          ],
          "should": [
            {
              "term": {
                "fortinet.firewall.action": "deny"
              }
            },
            {
              "exists": {
                "field": "fortinet.firewall.attack"
              }
            },
            {
              "exists": {
                "field": "fortinet.firewall.virus"
              }
            },
            {
              "exists": {
                "field": "fortinet.firewall.botnetip"
              }
            }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "top_dangerous_orgs": {
          "terms": {
            "field": "destination.as.organization.name",
            "size": 20
          },
          "aggs": {
            "total_incidents": {
              "value_count": {
                "field": "@timestamp"
              }
            },
            "unique_users_affected": {
              "cardinality": {
                "field": "source.user.name"
              }
            },
            "unique_ips": {
              "cardinality": {
                "field": "destination.ip"
              }
            },
            "threat_breakdown": {
              "filters": {
                "filters": {
                  "blocked": {
                    "term": {
                      "fortinet.firewall.action": "deny"
                    }
                  },
                  "ips_alerts": {
                    "exists": {
                      "field": "fortinet.firewall.attack"
                    }
                  },
                  "malware": {
                    "exists": {
                      "field": "fortinet.firewall.virus"
                    }
                  },
                  "botnet": {
                    "exists": {
                      "field": "fortinet.firewall.botnetip"
                    }
                  },
                  "critical_ips": {
                    "terms": {
                      "fortinet.firewall.crlevel": ["critical"]
                    }
                  }
                }
              }
            },
            "top_attacks": {
              "terms": {
                "field": "fortinet.firewall.attack",
                "size": 5
              }
            },
            "top_malware": {
              "terms": {
                "field": "fortinet.firewall.virus",
                "size": 5
              }
            },
            "affected_users": {
              "terms": {
                "field": "source.user.name",
                "size": 10
              }
            },
            "countries": {
              "terms": {
                "field": "destination.geo.country_name",
                "size": 5
              }
            },
            "timeline": {
              "date_histogram": {
                "field": "@timestamp",
                "calendar_interval": "day"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Ma trận rủi ro theo tổ chức và người dùng",
    "keywords": [
      "ma trận rủi ro",
      "risk matrix",
      "tổ chức",
      "organization",
      "người dùng",
      "user",
      "destination.as.organization.name",
      "source.user.name"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "2025-10-01T00:00:00.000+07:00",
                  "lte": "2025-10-31T23:59:59.999+07:00"
                }
              }
            }
          ],
          "should": [
            {
              "term": {
                "fortinet.firewall.action": "deny"
              }
            },
            {
              "exists": {
                "field": "fortinet.firewall.attack"
              }
            },
            {
              "exists": {
                "field": "fortinet.firewall.virus"
              }
            }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "risk_matrix": {
          "terms": {
            "field": "source.user.name",
            "size": 30
          },
          "aggs": {
            "dangerous_orgs": {
              "terms": {
                "field": "destination.as.organization.name",
                "size": 10
              },
              "aggs": {
                "threat_count": {
                  "value_count": {
                    "field": "@timestamp"
                  }
                },
                "threat_types": {
                  "filters": {
                    "filters": {
                      "blocked": {
                        "term": {
                          "fortinet.firewall.action": "deny"
                        }
                      },
                      "ips": {
                        "exists": {
                          "field": "fortinet.firewall.attack"
                        }
                      },
                      "malware": {
                        "exists": {
                          "field": "fortinet.firewall.virus"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Tổ chức đích nguy hiểm nhất trong tháng 10",
    "keywords": [
      "tổ chức đích",
      "nguy hiểm nhất",
      "most dangerous",
      "destination organization",
      "tháng 10",
      "October",
      "risk score",
      "destination.as.organization.name"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "2025-10-01T00:00:00.000+07:00",
                  "lte": "2025-10-31T23:59:59.999+07:00"
                }
              }
            },
            {
              "term": {
                "network.direction": "outbound"
              }
            },
            {
              "exists": {
                "field": "destination.as.organization.name"
              }
            }
          ],
          "should": [
            {
              "term": {
                "observer.egress.interface.name": "port1"
              }
            },
            {
              "term": {
                "observer.egress.interface.name": "port2"
              }
            },
            {
              "terms": {
                "source.nat.ip": ["118.70.81.176", "101.99.13.33"]
              }
            }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "dangerous_organizations": {
          "terms": {
            "field": "destination.as.organization.name",
            "size": 50,
            "order": {
              "total_connections": "desc"
            }
          },
          "aggs": {
            "total_bytes": {
              "sum": {
                "field": "network.bytes"
              }
            },
            "total_connections": {
              "value_count": {
                "field": "@timestamp"
              }
            },
            "unique_users": {
              "cardinality": {
                "field": "source.user.name"
              }
            },
            "blocked_count": {
              "filter": {
                "term": {
                  "fortinet.firewall.action": "deny"
                }
              }
            },
            "ips_alerts": {
              "filter": {
                "exists": {
                  "field": "fortinet.firewall.attack"
                }
              },
              "aggs": {
                "critical_count": {
                  "filter": {
                    "terms": {
                      "fortinet.firewall.crlevel": ["high", "critical"]
                    }
                  }
                },
                "attack_types": {
                  "terms": {
                    "field": "fortinet.firewall.attack",
                    "size": 10
                  }
                }
              }
            },
            "malware_detected": {
              "filter": {
                "exists": {
                  "field": "fortinet.firewall.virus"
                }
              },
              "aggs": {
                "virus_types": {
                  "terms": {
                    "field": "fortinet.firewall.virus",
                    "size": 10
                  }
                }
              }
            },
            "botnet_detected": {
              "filter": {
                "exists": {
                  "field": "fortinet.firewall.botnetip"
                }
              }
            },
            "high_risk_countries": {
              "filter": {
                "terms": {
                  "destination.geo.country_name": ["Russia", "China", "North Korea", "Iran"]
                }
              }
            },
            "webfilter_blocks": {
              "filter": {
                "bool": {
                  "filter": [
                    {
                      "term": {
                        "fortinet.firewall.subtype": "webfilter"
                      }
                    },
                    {
                      "term": {
                        "fortinet.firewall.action": "deny"
                      }
                    }
                  ]
                }
              }
            },
            "suspicious_ports": {
              "filter": {
                "terms": {
                  "destination.port": [22, 23, 3389, 445, 135, 139, 1433, 3306, 5432]
                }
              }
            },
            "after_hours_activity": {
              "filter": {
                "script": {
                  "script": {
                    "source": "doc['@timestamp'].value.getHour() >= 22 || doc['@timestamp'].value.getHour() < 6"
                  }
                }
              }
            },
            "large_data_transfer": {
              "filter": {
                "range": {
                  "network.bytes": {
                    "gt": 104857600
                  }
                }
              }
            },
            "risk_score": {
              "bucket_script": {
                "buckets_path": {
                  "blocked": "blocked_count._count",
                  "ips": "ips_alerts._count",
                  "critical": "ips_alerts>critical_count._count",
                  "malware": "malware_detected._count",
                  "botnet": "botnet_detected._count",
                  "high_risk": "high_risk_countries._count",
                  "webfilter": "webfilter_blocks._count",
                  "sus_ports": "suspicious_ports._count",
                  "after_hours": "after_hours_activity._count",
                  "large_transfer": "large_data_transfer._count"
                },
                "script": "(params.blocked * 10) + (params.ips * 8) + (params.critical * 15) + (params.malware * 20) + (params.botnet * 25) + (params.high_risk * 12) + (params.webfilter * 7) + (params.sus_ports * 5) + (params.after_hours * 3) + (params.large_transfer * 2)"
              }
            },
            "top_risky_users": {
              "terms": {
                "field": "source.user.name",
                "size": 10
              }
            },
            "risk_bucket_sort": {
              "bucket_sort": {
                "sort": [
                  {
                    "risk_score": {
                      "order": "desc"
                    }
                  }
                ],
                "size": 50
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Chỉ lấy các tổ chức có mối đe dọa thực sự",
    "keywords": [
      "tổ chức",
      "organization",
      "đe dọa thực sự",
      "real threats",
      "destination.as.organization.name",
      "fortinet.firewall.attack",
      "fortinet.firewall.virus",
      "fortinet.firewall.botnetip"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "2025-10-01T00:00:00.000+07:00",
                  "lte": "2025-10-31T23:59:59.999+07:00"
                }
              }
            },
            {
              "term": {
                "network.direction": "outbound"
              }
            },
            {
              "exists": {
                "field": "destination.as.organization.name"
              }
            }
          ],
          "should": [
            {
              "term": {
                "fortinet.firewall.action": "deny"
              }
            },
            {
              "exists": {
                "field": "fortinet.firewall.attack"
              }
            },
            {
              "exists": {
                "field": "fortinet.firewall.virus"
              }
            },
            {
              "exists": {
                "field": "fortinet.firewall.botnetip"
              }
            },
            {
              "terms": {
                "fortinet.firewall.crlevel": ["high", "critical"]
              }
            }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "dangerous_organizations": {
          "terms": {
            "field": "destination.as.organization.name",
            "size": 30
          },
          "aggs": {
            "total_threats": {
              "value_count": {
                "field": "@timestamp"
              }
            },
            "unique_users_affected": {
              "cardinality": {
                "field": "source.user.name"
              }
            },
            "threat_breakdown": {
              "filters": {
                "filters": {
                  "blocked": {
                    "term": {
                      "fortinet.firewall.action": "deny"
                    }
                  },
                  "ips_alerts": {
                    "exists": {
                      "field": "fortinet.firewall.attack"
                    }
                  },
                  "critical_ips": {
                    "term": {
                      "fortinet.firewall.crlevel": "critical"
                    }
                  },
                  "high_ips": {
                    "term": {
                      "fortinet.firewall.crlevel": "high"
                    }
                  },
                  "malware": {
                    "exists": {
                      "field": "fortinet.firewall.virus"
                    }
                  },
                  "botnet": {
                    "exists": {
                      "field": "fortinet.firewall.botnetip"
                    }
                  }
                }
              }
            },
            "top_attacks": {
              "terms": {
                "field": "fortinet.firewall.attack",
                "size": 5
              }
            },
            "top_malware": {
              "terms": {
                "field": "fortinet.firewall.virus",
                "size": 5
              }
            },
            "affected_users": {
              "terms": {
                "field": "source.user.name",
                "size": 10
              }
            },
            "countries": {
              "terms": {
                "field": "destination.geo.country_name",
                "size": 5
              }
            },
            "timeline": {
              "date_histogram": {
                "field": "@timestamp",
                "calendar_interval": "day"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Tính weighted risk score bằng sub-aggregation",
    "keywords": [
      "weighted risk score",
      "sub-aggregation",
      "destination.as.organization.name",
      "bucket_script",
      "bucket_sort",
      "fortinet.firewall.virus",
      "fortinet.firewall.botnetip",
      "fortinet.firewall.crlevel"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "2025-10-01T00:00:00.000+07:00",
                  "lte": "2025-10-31T23:59:59.999+07:00"
                }
              }
            }
          ]
        }
      },
      "aggs": {
        "all_orgs": {
          "terms": {
            "field": "destination.as.organization.name",
            "size": 1000
          },
          "aggs": {
            "malware_weight": {
              "filter": {
                "exists": {
                  "field": "fortinet.firewall.virus"
                }
              }
            },
            "botnet_weight": {
              "filter": {
                "exists": {
                  "field": "fortinet.firewall.botnetip"
                }
              }
            },
            "critical_ips_weight": {
              "filter": {
                "term": {
                  "fortinet.firewall.crlevel": "critical"
                }
              }
            },
            "blocked_weight": {
              "filter": {
                "term": {
                  "fortinet.firewall.action": "deny"
                }
              }
            },
            "weighted_score": {
              "bucket_script": {
                "buckets_path": {
                  "malware": "malware_weight._count",
                  "botnet": "botnet_weight._count",
                  "critical": "critical_ips_weight._count",
                  "blocked": "blocked_weight._count"
                },
                "script": "(params.malware * 20) + (params.botnet * 25) + (params.critical * 15) + (params.blocked * 10)"
              }
            },
            "sort_by_risk": {
              "bucket_sort": {
                "sort": [
                  {
                    "weighted_score": {
                      "order": "desc"
                    }
                  }
                ],
                "size": 30
              }
            },
            "threat_details": {
              "filters": {
                "filters": {
                  "malware": {
                    "exists": {
                      "field": "fortinet.firewall.virus"
                    }
                  },
                  "botnet": {
                    "exists": {
                      "field": "fortinet.firewall.botnetip"
                    }
                  },
                  "critical_ips": {
                    "term": {
                      "fortinet.firewall.crlevel": "critical"
                    }
                  },
                  "blocked": {
                    "term": {
                      "fortinet.firewall.action": "deny"
                    }
                  }
                }
              }
            },
            "affected_users": {
              "terms": {
                "field": "source.user.name",
                "size": 10
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Tổ chức nguy hiểm nhất trong trong tháng 10",
    "keywords": [
      "tổ chức nguy hiểm nhất",
      "most dangerous organization",
      "tháng ",
      "month",
      "destination.as.organization.name",
      "fortinet.firewall.attack",
      "fortinet.firewall.virus",
      "fortinet.firewall.botnetip",
      "fortinet.firewall.action"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "2025-10-01T00:00:00.000+07:00",
                  "lte": "2025-10-31T23:59:59.999+07:00"
                }
              }
            }
          ],
          "should": [
            {
              "term": {
                "fortinet.firewall.action": "deny"
              }
            },
            {
              "exists": {
                "field": "fortinet.firewall.attack"
              }
            },
            {
              "exists": {
                "field": "fortinet.firewall.virus"
              }
            },
            {
              "exists": {
                "field": "fortinet.firewall.botnetip"
              }
            }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "top_dangerous": {
          "terms": {
            "field": "destination.as.organization.name",
            "size": 30
          },
          "aggs": {
            "threats": {
              "filters": {
                "filters": {
                  "malware": { "exists": { "field": "fortinet.firewall.virus" } },
                  "botnet": { "exists": { "field": "fortinet.firewall.botnetip" } },
                  "critical": { "term": { "fortinet.firewall.crlevel": "critical" } },
                  "high": { "term": { "fortinet.firewall.crlevel": "high" } },
                  "blocked": { "term": { "fortinet.firewall.action": "deny" } },
                  "ips": { "exists": { "field": "fortinet.firewall.attack" } }
                }
              }
            },
            "users": { "cardinality": { "field": "source.user.name" } },
            "bytes": { "sum": { "field": "network.bytes" } },
            "top_users": { "terms": { "field": "source.user.name", "size": 5 } }
          }
        }
      }
    }
  },
  {
    "question": "Phân tích lưu lượng mạng theo người dùng trong tháng 10/2025",
    "keywords": [
      "phân tích",
      "lưu lượng mạng",
      "network traffic",
      "người dùng",
      "user",
      "tháng 10",
      "October",
      "2025",
      "network.bytes",
      "network.protocol",
      "network.transport"
    ],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "range": {
                "@timestamp": {
                  "gte": "2025-10-01T00:00:00.000+07:00",
                  "lt": "2025-10-31T23:59:59.999+07:00"
                }
              }
            },
            {
              "term": {
                "network.direction": "outbound"
              }
            }
          ]
        }
      },
      "aggs": {
        "top_users": {
          "terms": {
            "field": "source.user.name",
            "size": 20,
            "order": {
              "total_bytes": "desc"
            }
          },
          "aggs": {
            "total_bytes": {
              "sum": {
                "field": "network.bytes"
              }
            },
            "total_sessions": {
              "value_count": {
                "field": "@timestamp"
              }
            },
            "by_protocol": {
              "terms": {
                "field": "network.protocol",
                "size": 15
              },
              "aggs": {
                "protocol_bytes": {
                  "sum": {
                    "field": "network.bytes"
                  }
                }
              }
            },
            "by_transport": {
              "terms": {
                "field": "network.transport",
                "size": 5
              },
              "aggs": {
                "transport_bytes": {
                  "sum": {
                    "field": "network.bytes"
                  }
                }
              }
            },
            "top_destinations": {
              "terms": {
                "field": "destination.ip",
                "size": 5
              },
              "aggs": {
                "dest_bytes": {
                  "sum": {
                    "field": "network.bytes"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "hôm ngày 11-09 có roles admin nào vào hệ thống hay ko?",
    "keywords": ["hôm ngày 11-09", "admin", "roles", "Administrator", "vào hệ thống", "login", "đăng nhập", "role", "quyền"],
    "query": {
      "size": 50,
      "query": {
        "bool": {
          "filter": [
            {
              "term": {
                "source.user.roles": "Administrator"
              }
            },
            {
              "range": {
                "@timestamp": {
                  "gte": "2025-09-11T00:00:00.000+07:00",
                  "lte": "2025-09-11T23:59:59.999+07:00"
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "question": "Những IP nào kết nối đều đặn vào lúc ngoài giờ làm việc (18h-8h) trong 30 ngày qua?",
    "keywords": [
      "apt detection",
      "advanced persistent threat",
      "phát hiện mối đe dọa",
      "beacon tín hiệu",
      "c2 command control",
      "command and control",
      "ngoài giờ làm việc",
      "after hours",
      "kết nối liên tục",
      "persistent connection",
      "đều đặn",
      "regular pattern",
      "IP addresses",
      "địa chỉ IP",
      "30 ngày",
      "mô hình dài hạn",
      "long term pattern"
    ],
    "scenario": "PHÁT HIỆN MỐI ĐE DỌA BỀN VỮNG NÂNG CAO (APT DETECTION)",
    "phase": "Giai đoạn 1: Phân tích mô hình dài hạn",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-1d" } } },
            {
              "script": {
                "script": "doc['@timestamp'].value.getHour() < 8 || doc['@timestamp'].value.getHour() > 18"
              }
            }
          ]
        }
      },
      "aggs": {
        "after_hours_ips": {
          "terms": { "field": "destination.ip", "size": 100 },
          "aggs": {
            "daily_pattern": {
              "date_histogram": {
                "field": "@timestamp",
                "calendar_interval": "1d"
              }
            },
            "total_connections": {
              "value_count": { "field": "@timestamp" }
            },
            "unique_days": {
              "cardinality": {
                "script": "doc['@timestamp'].value.dayOfYear"
              }
            },
            "consistency_score": {
              "bucket_script": {
                "buckets_path": {
                  "total": "total_connections",
                  "days": "unique_days"
                },
                "script": "params.days > 20 && params.total > 100 ? 1 : 0"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Phát hiện đường hầm DNS (DNS tunneling): các truy vấn có tên miền dài bất thường?",
    "keywords": [
      "dns tunneling",
      "đường hầm dns",
      "tên miền dài",
      "đánh cắp dữ liệu",
      "c2 communication",
      "command and control",
      "domain length",
      "chiều dài tên miền",
      "unusual domains",
      "tên miền bất thường",
      "data exfiltration",
      "covert channel",
      "kênh bí mật",
      "dns queries",
      "truy vấn dns"
    ],
    "scenario": "PHÁT HIỆN MỐI ĐE DỌA BỀN VỮNG NÂNG CAO (APT DETECTION)",
    "phase": "Giai đoạn 1: Phân tích mô hình dài hạn",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-7d" } } },
            { "term": { "network.protocol": "dns" } },
            {
              "script": {
                "script": "doc['url.domain'].size() > 0 && doc['url.domain'].value.length() > 50"
              }
            }
          ]
        }
      },
      "aggs": {
        "suspicious_domains": {
          "terms": { "field": "url.domain", "size": 50 },
          "aggs": {
            "query_frequency": { "value_count": { "field": "@timestamp" } },
            "unique_sources": { "cardinality": { "field": "source.ip" } },
            "domain_length": {
              "max": {
                "script": "doc['url.domain'].size() > 0 ? doc['url.domain'].value.length() : 0"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Tận dụng công cụ hệ thống (Living off the land): Sử dụng PowerShell, WMI, hoặc công cụ hệ thống bất thường?",
    "keywords": [
      "living off the land",
      "powershell",
      "wmi",
      "fileless malware",
      "tận dụng công cụ",
      "system tools abuse",
      "lạm dụng công cụ hệ thống",
      "công cụ hệ thống",
      "system tools",
      "mã độc không tập tin",
      "certutil",
      "bitsadmin",
      "encoded command",
      "lệnh mã hóa",
      "process execution",
      "thực thi tiến trình"
    ],
    "scenario": "PHÁT HIỆN MỐI ĐE DỌA BỀN VỮNG NÂNG CAO (APT DETECTION)",
    "phase": "Giai đoạn 1: Phân tích mô hình dài hạn",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-7d" } } }],
          "should": [
            { "wildcard": { "process.name": "*powershell*" } },
            { "wildcard": { "process.name": "*wmic*" } },
            { "wildcard": { "process.name": "*certutil*" } },
            { "wildcard": { "process.name": "*bitsadmin*" } },
            { "wildcard": { "process.command_line": "*-EncodedCommand*" } },
            { "wildcard": { "process.command_line": "*DownloadString*" } }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "suspicious_processes": {
          "terms": { "field": "process.name", "size": 20 },
          "aggs": {
            "by_user": { "terms": { "field": "source.user.name" } },
            "command_patterns": { "terms": { "field": "process.command_line" } }
          }
        }
      }
    }
  },
  {
    "question": "Có tài khoản nào đột ngột truy cập nhiều máy chủ trong thời gian ngắn?",
    "keywords": [
      "lateral movement",
      "di chuyển ngang",
      "credential abuse",
      "lạm dụng đăng nhập",
      "truy cập đa máy chủ",
      "multiple servers",
      "thời gian ngắn",
      "short time",
      "đột ngột",
      "sudden access",
      "tài khoản",
      "account",
      "user activity",
      "hoạt động người dùng",
      "suspicious access",
      "truy cập đáng nghi"
    ],
    "scenario": "PHÁT HIỆN DI CHUYỂN NGANG (LATERAL MOVEMENT DETECTION)",
    "phase": "Giai đoạn 2: Phát hiện di chuyển ngang",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "term": { "network.direction": "internal" } }]
        }
      },
      "aggs": {
        "by_user": {
          "terms": { "field": "source.user.name", "size": 50 },
          "aggs": {
            "unique_destinations": {
              "cardinality": { "field": "destination.ip" }
            },
            "destination_details": {
              "terms": { "field": "destination.ip", "size": 20 },
              "aggs": {
                "first_access": { "min": { "field": "@timestamp" } },
                "services_accessed": { "terms": { "field": "destination.port" } }
              }
            },
            "suspicious_spread": {
              "bucket_selector": {
                "buckets_path": { "destinations": "unique_destinations" },
                "script": "params.destinations > 10"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Tấn công Pass-the-Hash: Xác thực từ các workstation bất thường?",
    "keywords": [
      "pass-the-hash",
      "pass the hash",
      "tấn công hash",
      "hash attack",
      "xác thực bất thường",
      "unusual authentication",
      "workstation lạ",
      "unusual workstation",
      "ntlm hash",
      "authentication",
      "xác thực",
      "đăng nhập",
      "login",
      "credential theft",
      "đánh cắp thông tin đăng nhập"
    ],
    "scenario": "PHÁT HIỆN DI CHUYỂN NGANG (LATERAL MOVEMENT DETECTION)",
    "phase": "Giai đoạn 2: Phát hiện di chuyển ngang",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "term": { "event.action": "authentication" } }]
        }
      },
      "aggs": {
        "by_user": {
          "terms": { "field": "source.user.name", "size": 50 },
          "aggs": {
            "workstation_diversity": {
              "cardinality": { "field": "source.hostname" }
            },
            "auth_methods": {
              "terms": { "field": "fortinet.firewall.authmethod" }
            },
            "unusual_workstations": {
              "bucket_selector": {
                "buckets_path": { "diversity": "workstation_diversity" },
                "script": "params.diversity > 5"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Mô hình truy cập dữ liệu thông thường của user 'nguyenvanb' trong 90 ngày qua?",
    "keywords": [
      "insider threat",
      "mối đe dọa nội bộ",
      "mô hình truy cập",
      "access pattern",
      "baseline behavior",
      "hành vi bình thường",
      "normal behavior",
      "user pattern",
      "nguyenvanb",
      "user activity",
      "hoạt động người dùng",
      "data access",
      "truy cập dữ liệu",
      "90 ngày",
      "90 days",
      "thông thường",
      "typical"
    ],
    "scenario": "ĐIỀU TRA INSIDER THREAT - MỐI ĐE DỌA NỘI BỘ",
    "phase": "Giai đoạn 1: Phân tích baseline hành vi",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "term": { "source.user.name": "nguyenvanb" } }, { "range": { "@timestamp": { "gte": "now-90d" } } }]
        }
      },
      "aggs": {
        "access_patterns": {
          "date_histogram": {
            "field": "@timestamp",
            "calendar_interval": "1w"
          },
          "aggs": {
            "resources_accessed": { "terms": { "field": "destination.ip" } },
            "data_volume": { "sum": { "field": "network.bytes" } },
            "access_times": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "1h"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Hoạt động gần đây (30 ngày qua) có bất thường so với mức cơ bản không?",
    "keywords": [
      "deviation analysis",
      "phân tích độ lệch",
      "hoạt động gần đây",
      "recent activity",
      "baseline comparison",
      "so sánh mức cơ bản",
      "bất thường",
      "anomaly",
      "unusual",
      "hành vi thay đổi",
      "behavior change",
      "anomaly detection",
      "phát hiện bất thường",
      "30 ngày",
      "30 days",
      "mức cơ bản",
      "baseline"
    ],
    "scenario": "ĐIỀU TRA INSIDER THREAT - PHÂN TÍCH DEVIATION",
    "phase": "Giai đoạn 2: Phát hiện anomaly",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "term": { "source.user.name": "nguyenvanb" } }, { "range": { "@timestamp": { "gte": "now-30d" } } }]
        }
      },
      "aggs": {
        "recent_vs_baseline": {
          "filters": {
            "filters": {
              "recent": { "range": { "@timestamp": { "gte": "now-30d" } } },
              "baseline": { "range": { "@timestamp": { "gte": "now-120d", "lt": "now-30d" } } }
            }
          },
          "aggs": {
            "avg_daily_activity": {
              "date_histogram": {
                "field": "@timestamp",
                "calendar_interval": "1d"
              }
            },
            "unique_resources": { "cardinality": { "field": "destination.ip" } },
            "data_transfer": { "sum": { "field": "network.bytes" } }
          }
        }
      }
    }
  },
  {
    "question": "Tải xuống hàng loạt (Mass download): Có tải xuống nhiều files trong thời gian ngắn?",
    "keywords": [
      "data exfiltration",
      "đánh cắp dữ liệu",
      "tải xuống hàng loạt",
      "mass download",
      "bulk download",
      "bulk transfer",
      "dữ liệu nhạy cảm",
      "sensitive data",
      "suspicious download",
      "tải xuống đáng nghi",
      "nhiều files",
      "multiple files",
      "thời gian ngắn",
      "short time",
      "download pattern",
      "mô hình tải xuống"
    ],
    "scenario": "ĐIỀU TRA INSIDER THREAT - DATA EXFILTRATION",
    "phase": "Giai đoạn 3: Phân tích exfiltration",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "term": { "source.user.name": "nguyenvanb" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } },
            { "term": { "network.direction": "outbound" } }
          ]
        }
      },
      "aggs": {
        "download_analysis": {
          "date_histogram": {
            "field": "@timestamp",
            "fixed_interval": "1h"
          },
          "aggs": {
            "file_count": { "value_count": { "field": "url.original" } },
            "total_bytes": { "sum": { "field": "source.bytes" } },
            "suspicious_volume": {
              "bucket_selector": {
                "buckets_path": {
                  "files": "file_count",
                  "bytes": "total_bytes"
                },
                "script": "params.files > 100 || params.bytes > 1073741824"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Sử dụng tài khoản đặc quyền: Tài khoản quản trị có được sử dụng đúng mục đích?",
    "keywords": [
      "compliance audit",
      "kiểm toán tuân thủ",
      "tài khoản đặc quyền",
      "privileged account",
      "admin account",
      "administrator",
      "admin usage",
      "sử dụng quản trị",
      "quyền quản trị",
      "admin rights",
      "compliance check",
      "kiểm tra tuân thủ",
      "đúng mục đích",
      "proper usage",
      "gdpr",
      "data protection"
    ],
    "scenario": "COMPLIANCE AUDIT - GDPR & DATA PROTECTION",
    "phase": "Giai đoạn 1: Audit truy cập dữ liệu",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-30d" } } }, { "terms": { "source.user.roles": ["admin", "Administrator", "root"] } }]
        }
      },
      "aggs": {
        "admin_usage": {
          "terms": { "field": "source.user.name", "size": 20 },
          "aggs": {
            "actions_performed": { "terms": { "field": "event.action" } },
            "resources_accessed": { "terms": { "field": "destination.ip" } },
            "time_pattern": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "1h"
              }
            },
            "total_actions": {
              "value_count": { "field": "event.action" }
            },
            "compliance_check": {
              "bucket_script": {
                "buckets_path": { "actions": "total_actions" },
                "script": "params.actions > 0 ? 1 : 0"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Quyền được quên (Right to be forgotten): Dữ liệu của người dùng đã được xóa theo yêu cầu chưa?",
    "keywords": [
      "gdpr compliance",
      "tuân thủ gdpr",
      "quyền được quên",
      "right to be forgotten",
      "data deletion",
      "xóa dữ liệu",
      "delete data",
      "privacy compliance",
      "tuân thủ quyền riêng tư",
      "data removal",
      "loại bỏ dữ liệu",
      "user data",
      "dữ liệu người dùng",
      "deletion verification",
      "xác minh xóa",
      "deleted_user"
    ],
    "scenario": "COMPLIANCE AUDIT - RIGHT TO BE FORGOTTEN",
    "phase": "Giai đoạn 2: Data deletion verification",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-90d" } } }, { "term": { "source.user.name": "deleted_user_123" } }]
        }
      },
      "aggs": {
        "deletion_verification": {
          "date_histogram": {
            "field": "@timestamp",
            "calendar_interval": "1d"
          },
          "aggs": {
            "data_access": { "value_count": { "field": "@timestamp" } },
            "systems_accessed": { "terms": { "field": "destination.ip" } },
            "data_presence": {
              "bucket_selector": {
                "buckets_path": { "access": "data_access" },
                "script": "params.access > 0"
              }
            }
          }
        }
      }
    }
  },

  {
    "question": "Machine nào đầu tiên có signs của file encryption?",
    "keywords": [
      "ransomware detection",
      "phát hiện ransomware",
      "file encryption",
      "mã hóa tập tin",
      "patient zero",
      "bệnh nhân số 0",
      "encryption signs",
      "dấu hiệu mã hóa",
      "ransomware outbreak",
      "bùng phát ransomware",
      "initial infection",
      "nhiễm bệnh ban đầu",
      "đầu tiên",
      "first",
      "machine",
      "máy tính",
      "signs",
      "dấu hiệu",
      "encrypted",
      "mã hóa"
    ],
    "scenario": "RANSOMWARE INCIDENT RESPONSE",
    "phase": "Giai đoạn 1: Patient zero identification",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-48h" } } }, { "terms": { "file.extension": ["encrypted", "locked", "crypt"] } }]
        }
      },
      "aggs": {
        "infection_timeline": {
          "terms": { "field": "host.name", "size": 100 },
          "aggs": {
            "first_encryption": { "min": { "field": "@timestamp" } },
            "encrypted_files": { "value_count": { "field": "file.name" } },
            "file_types": { "terms": { "field": "file.extension" } }
          }
        }
      }
    }
  },
  {
    "question": "SQL Injection attempts: Pattern và success rate?",
    "keywords": [
      "sql injection",
      "tấn công sql injection",
      "web application attack",
      "tấn công ứng dụng web",
      "injection patterns",
      "mô hình injection",
      "success rate",
      "tỷ lệ thành công",
      "database security",
      "bảo mật cơ sở dữ liệu",
      "web security",
      "bảo mật web",
      "sql",
      "injection",
      "database",
      "cơ sở dữ liệu",
      "pattern",
      "mô hình",
      "attempts",
      "nỗ lực",
      "tấn công",
      "attack"
    ],
    "scenario": "WEB APPLICATION SECURITY MONITORING",
    "phase": "Giai đoạn 1: Attack pattern analysis",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "url.query" } }],
          "should": [
            { "wildcard": { "url.query": "*union*select*" } },
            { "wildcard": { "url.query": "*or*1=1*" } },
            { "wildcard": { "url.query": "*drop*table*" } },
            { "wildcard": { "url.query": "*insert*into*" } },
            { "wildcard": { "url.query": "*'*or*'*" } }
          ],
          "minimum_should_match": 1
        }
      },
      "aggs": {
        "injection_analysis": {
          "terms": { "field": "source.ip", "size": 100 },
          "aggs": {
            "attack_patterns": { "terms": { "field": "url.query" } },
            "response_codes": { "terms": { "field": "http.response.status_code" } },
            "successful_attempts": {
              "filter": { "term": { "http.response.status_code": 200 } }
            },
            "success_rate": {
              "bucket_script": {
                "buckets_path": {
                  "total": "_count",
                  "success": "successful_attempts>_count"
                },
                "script": "params.total > 0 ? (params.success / params.total) * 100 : 0"
              }
            }
          }
        }
      }
    }
  },

  {
    "question": "Tối ưu hóa chi phí băng thông: Phân tích sử dụng vs dung lượng?",
    "keywords": [
      "bandwidth optimization",
      "tối ưu hóa băng thông",
      "cost analysis",
      "phân tích chi phí",
      "usage vs capacity",
      "sử dụng vs dung lượng",
      "network efficiency",
      "hiệu quả mạng",
      "resource utilization",
      "sử dụng tài nguyên",
      "chi phí",
      "cost",
      "băng thông",
      "bandwidth",
      "tối ưu hóa",
      "optimization",
      "phân tích",
      "analysis"
    ],
    "scenario": "COST OPTIMIZATION ANALYSIS",
    "phase": "Giai đoạn 2: Phân tích cơ hội tối ưu chi phí",
    "businessValue": "Giảm chi phí vận hành, tối ưu phân bổ tài nguyên",
    "query": {
      "query": {
        "range": { "@timestamp": { "gte": "now-3d" } }
      },
      "aggs": {
        "bandwidth_cost_analysis": {
          "date_histogram": {
            "field": "@timestamp",
            "calendar_interval": "1d"
          },
          "aggs": {
            "daily_usage": { "sum": { "field": "network.bytes" } },
            "peak_hour_usage": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "1h"
              },
              "aggs": {
                "hourly_usage": { "sum": { "field": "network.bytes" } }
              }
            },
            "95th_percentile_usage": {
              "percentiles_bucket": {
                "buckets_path": "peak_hour_usage>hourly_usage",
                "percents": [95]
              }
            },
            "underutilization_score": {
              "bucket_script": {
                "buckets_path": {
                  "daily": "daily_usage",
                  "peak": "95th_percentile_usage[95.0]"
                },
                "script": "params.peak > 0 ? (params.daily / (params.peak * 24)) * 100 : 0"
              }
            }
          }
        }
      }
    }
  },

  {
    "question": "Hiệu quả làm việc từ xa: Mô hình sử dụng VPN và tương quan năng suất?",
    "keywords": [
      "remote work",
      "làm việc từ xa",
      "work from home",
      "làm việc tại nhà",
      "vpn usage",
      "sử dụng vpn",
      "productivity correlation",
      "tương quan năng suất",
      "remote productivity",
      "năng suất từ xa",
      "hiệu quả",
      "effectiveness",
      "từ xa",
      "remote",
      "vpn",
      "mô hình sử dụng",
      "usage pattern",
      "tương quan",
      "correlation"
    ],
    "scenario": "REMOTE WORK EFFECTIVENESS ANALYSIS",
    "phase": "Giai đoạn 2: Phân tích remote work",
    "businessValue": "Tối ưu chính sách làm việc từ xa, lập kế hoạch dung lượng VPN",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-3d" } } },
            { "range": { "source.ip": { "gte": "192.168.0.0", "lte": "192.168.255.255" } } }
          ]
        }
      },
      "aggs": {
        "remote_work_analysis": {
          "terms": { "field": "source.user.name", "size": 100 },
          "aggs": {
            "vpn_usage_pattern": {
              "date_histogram": {
                "field": "@timestamp",
                "calendar_interval": "1d"
              },
              "aggs": {
                "daily_vpn_hours": {
                  "date_histogram": {
                    "field": "@timestamp",
                    "fixed_interval": "1h"
                  },
                  "aggs": {
                    "active_hour": {
                      "bucket_selector": {
                        "buckets_path": { "count": "_count" },
                        "script": "params.count > 10"
                      }
                    }
                  }
                }
              }
            },
            "remote_productivity": {
              "filters": {
                "filters": {
                  "business_hours": {
                    "script": {
                      "script": "doc['@timestamp'].value.getHour() >= 8 && doc['@timestamp'].value.getHour() <= 17"
                    }
                  },
                  "off_hours": {
                    "script": {
                      "script": "doc['@timestamp'].value.getHour() < 8 || doc['@timestamp'].value.getHour() > 17"
                    }
                  }
                }
              },
              "aggs": {
                "activity_count": { "value_count": { "field": "@timestamp" } },
                "data_usage": { "sum": { "field": "network.bytes" } }
              }
            }
          }
        }
      }
    }
  },

  {
    "question": "Tỉ lệ operations thủ công vs tự động?",
    "keywords": [
      "manual operations",
      "hoạt động thủ công",
      "thủ công",
      "manual",
      "automation ratio",
      "tỉ lệ tự động",
      "operational efficiency",
      "hiệu quả vận hành",
      "process automation",
      "tự động hóa quy trình",
      "digital operations",
      "vận hành số",
      "tỉ lệ",
      "ratio",
      "operations",
      "vận hành",
      "tự động",
      "automation",
      "vs",
      "so với"
    ],
    "scenario": "OPERATIONAL EXCELLENCE & AUTOMATION",
    "phase": "Giai đoạn 1: Automation Impact Assessment",
    "businessValue": "Giảm chi phí vận hành, cải thiện độ tin cậy",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-60d" } } }, { "term": { "event.type": "configuration" } }]
        }
      },
      "aggs": {
        "automation_metrics": {
          "filters": {
            "filters": {
              "manual_operations": {
                "bool": {
                  "must_not": [
                    { "wildcard": { "source.user.name": "*system*" } },
                    { "wildcard": { "source.user.name": "*service*" } },
                    { "wildcard": { "source.user.name": "*auto*" } }
                  ]
                }
              },
              "automated_operations": {
                "bool": {
                  "should": [
                    { "wildcard": { "source.user.name": "*system*" } },
                    { "wildcard": { "source.user.name": "*service*" } },
                    { "wildcard": { "source.user.name": "*auto*" } }
                  ],
                  "minimum_should_match": 1
                }
              }
            }
          },
          "aggs": {
            "operation_timeline": {
              "date_histogram": {
                "field": "@timestamp",
                "calendar_interval": "1w"
              },
              "aggs": {
                "operation_count": { "value_count": { "field": "@timestamp" } },
                "error_rate": {
                  "filter": { "term": { "event.outcome": "failure" } },
                  "aggs": {
                    "error_count": { "value_count": { "field": "@timestamp" } }
                  }
                }
              }
            },
            "total_operations": {
              "sum_bucket": {
                "buckets_path": "operation_timeline>operation_count"
              }
            },
            "automation_ratio": {
              "bucket_script": {
                "buckets_path": {
                  "automated": "_count",
                  "total": "total_operations"
                },
                "script": "params.total > 0 ? (params.automated / params.total) * 100 : 0"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Báo cáo truy cập dữ liệu nhạy cảm theo quy định GDPR: Ai đã truy cập thông tin từ EU trong 90 ngày qua?",
    "keywords": [
      "GDPR compliance",
      "tuân thủ GDPR",
      "EU access",
      "truy cập EU",
      "data protection",
      "bảo vệ dữ liệu",
      "compliance report",
      "báo cáo tuân thủ",
      "90 ngày",
      "privacy regulation",
      "quy định bảo mật",
      "user activity",
      "hoạt động người dùng"
    ],
    "scenario": "GDPR COMPLIANCE MONITORING",
    "phase": "Giai đoạn 1: Thu thập bằng chứng truy cập",
    "complianceType": "GDPR Article 30 - Records of Processing",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-30d" } } },
            { "term": { "source.geo.continent_name": "Europe" } },
            {
              "bool": {
                "should": [{ "terms": { "destination.port": [443, 80, 8080] } }, { "term": { "fortinet.firewall.action": "accept" } }]
              }
            }
          ]
        }
      },
      "aggs": {
        "gdpr_access_report": {
          "terms": { "field": "source.user.name", "size": 100 },
          "aggs": {
            "access_countries": {
              "terms": { "field": "source.geo.country_name", "size": 20 }
            },
            "access_timeline": {
              "date_histogram": {
                "field": "@timestamp",
                "calendar_interval": "1d"
              }
            },
            "data_volume": {
              "sum": { "field": "network.bytes" }
            },
            "unique_destinations": {
              "cardinality": { "field": "destination.ip" }
            },
            "session_count": {
              "value_count": { "field": "@timestamp" }
            }
          }
        },
        "eu_traffic_summary": {
          "filter": { "term": { "source.geo.continent_name": "Europe" } },
          "aggs": {
            "total_bytes": {
              "sum": { "field": "network.bytes" }
            },
            "unique_users": {
              "cardinality": { "field": "source.user.name" }
            }
          }
        }
      },
      "sort": [{ "@timestamp": "desc" }],
      "size": 1000
    }
  },
  {
    "question": "Kiểm toán quyền truy cập đặc quyền: Tài khoản admin nào có hoạt động bất thường?",
    "keywords": [
      "privileged access",
      "truy cập đặc quyền",
      "admin accounts",
      "tài khoản admin",
      "unusual activity",
      "hoạt động bất thường",
      "audit privileged access",
      "kiểm toán quyền admin",
      "insider threat",
      "mối đe dọa nội bộ",
      "administrative rights",
      "quyền quản trị"
    ],
    "scenario": "PRIVILEGED ACCESS MONITORING",
    "phase": "Giai đoạn 2: Phát hiện hoạt động đặc quyền bất thường",
    "complianceType": "SOX Section 404 - Internal Controls",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-30d" } } },
            {
              "bool": {
                "should": [
                  { "wildcard": { "source.user.name": "*admin*" } },
                  { "wildcard": { "source.user.name": "*root*" } },
                  { "term": { "source.user.roles": "Administrator" } },
                  { "term": { "source.user.group.name": "administrators" } }
                ]
              }
            }
          ]
        }
      },
      "aggs": {
        "admin_activity_analysis": {
          "terms": { "field": "source.user.name", "size": 50 },
          "aggs": {
            "login_pattern": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "1h"
              }
            },
            "after_hours_activity": {
              "filter": {
                "script": {
                  "script": {
                    "source": "doc['@timestamp'].value.getHour() < 6 || doc['@timestamp'].value.getHour() > 22"
                  }
                }
              }
            },
            "geographic_locations": {
              "terms": { "field": "source.geo.country_name", "size": 10 }
            },
            "failed_attempts": {
              "filter": { "term": { "event.outcome": "failure" } }
            },
            "successful_connections": {
              "filter": { "term": { "fortinet.firewall.action": "accept" } }
            },
            "data_access_volume": {
              "sum": { "field": "network.bytes" }
            },
            "unique_destinations": {
              "cardinality": { "field": "destination.ip" }
            }
          }
        },
        "risk_indicators": {
          "filters": {
            "filters": {
              "multiple_countries": {
                "range": {
                  "source.geo.country_name": { "gte": 2 }
                }
              },
              "high_volume_access": {
                "range": { "network.bytes": { "gte": 10485760 } }
              },
              "weekend_access": {
                "bool": {
                  "filter": {
                    "script": {
                      "script": {
                        "source": "doc['@timestamp'].value.getDayOfWeek() >= 6"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Email Security: Phát hiện email phishing và malware qua traffic SMTP/POP3/IMAP?",
    "keywords": [
      "email phishing",
      "phishing qua email",
      "malware email",
      "email độc hại",
      "SMTP traffic",
      "lưu lượng SMTP",
      "email security",
      "bảo mật email",
      "suspicious attachments",
      "file đính kèm đáng nghi",
      "email filtering",
      "lọc email",
      "spam detection",
      "phát hiện spam"
    ],
    "scenario": "EMAIL THREAT DETECTION",
    "phase": "Giai đoạn 1: Phát hiện mối đe dọa qua email",
    "securityFramework": "MITRE ATT&CK T1566 - Phishing",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-24h" } } },
            { "term": { "fortinet.firewall.action": "accept" } },
            {
              "bool": {
                "should": [
                  { "term": { "destination.port": 25 } },
                  { "term": { "destination.port": 110 } },
                  { "term": { "destination.port": 143 } },
                  { "term": { "destination.port": 993 } },
                  { "term": { "destination.port": 995 } }
                ]
              }
            }
          ]
        }
      },
      "aggs": {
        "email_traffic_analysis": {
          "terms": { "field": "destination.port", "size": 10 },
          "aggs": {
            "email_servers": {
              "terms": { "field": "destination.ip", "size": 30 }
            },
            "email_users": {
              "terms": { "field": "source.user.name", "size": 50 }
            },
            "email_volume": {
              "sum": { "field": "network.bytes" }
            },
            "connection_timeline": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "1h"
              }
            },
            "external_servers": {
              "filter": {
                "bool": {
                  "must_not": [{ "term": { "network.direction": "internal" } }]
                }
              },
              "aggs": {
                "server_countries": {
                  "terms": { "field": "destination.geo.country_name", "size": 20 }
                },
                "server_organizations": {
                  "terms": { "field": "destination.as.organization.name", "size": 15 }
                }
              }
            }
          }
        },
        "suspicious_patterns": {
          "filters": {
            "filters": {
              "large_attachments": {
                "range": { "network.bytes": { "gte": 10485760 } }
              },
              "unusual_hours": {
                "bool": {
                  "filter": {
                    "script": {
                      "script": {
                        "source": "doc['@timestamp'].value.getHour() < 6 || doc['@timestamp'].value.getHour() > 22"
                      }
                    }
                  }
                }
              },
              "foreign_servers": {
                "bool": {
                  "must_not": [{ "terms": { "destination.geo.country_name": ["Vietnam", "United States"] } }]
                }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Data Loss Prevention: Phát hiện truyền file lớn ra ngoài qua FTP/HTTP?",
    "keywords": [
      "data loss prevention",
      "ngăn chặn mất dữ liệu",
      "file transfer",
      "truyền file",
      "data exfiltration",
      "đánh cắp dữ liệu",
      "large file upload",
      "upload file lớn",
      "FTP traffic",
      "lưu lượng FTP",
      "HTTP upload",
      "upload qua HTTP",
      "data leakage",
      "rò rỉ dữ liệu"
    ],
    "scenario": "DATA EXFILTRATION DETECTION",
    "phase": "Giai đoạn 2: Giám sát truyền dữ liệu ra ngoài",
    "securityFramework": "MITRE ATT&CK T1041 - Exfiltration Over C2 Channel",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-4h" } } },
            { "term": { "fortinet.firewall.action": "accept" } },
            { "term": { "network.direction": "outbound" } },
            {
              "bool": {
                "should": [
                  { "term": { "destination.port": 21 } },
                  { "term": { "destination.port": 22 } },
                  { "term": { "destination.port": 80 } },
                  { "term": { "destination.port": 443 } }
                ]
              }
            },
            { "range": { "network.bytes": { "gte": 52428800 } } }
          ]
        }
      },
      "aggs": {
        "large_transfers": {
          "terms": { "field": "source.ip", "size": 50 },
          "aggs": {
            "transfer_destinations": {
              "terms": { "field": "destination.ip", "size": 30 }
            },
            "total_data_sent": {
              "sum": { "field": "network.bytes" }
            },
            "transfer_protocols": {
              "terms": { "field": "destination.port", "size": 10 }
            },
            "transfer_timeline": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "30m"
              },
              "aggs": {
                "hourly_bytes": {
                  "sum": { "field": "network.bytes" }
                }
              }
            },
            "user_context": {
              "terms": { "field": "source.user.name", "size": 20 }
            },
            "destination_countries": {
              "terms": { "field": "destination.geo.country_name", "size": 15 }
            }
          }
        },
        "protocol_analysis": {
          "terms": { "field": "destination.port", "size": 10 },
          "aggs": {
            "avg_transfer_size": {
              "avg": { "field": "network.bytes" }
            },
            "max_transfer_size": {
              "max": { "field": "network.bytes" }
            },
            "transfer_frequency": {
              "value_count": { "field": "@timestamp" }
            }
          }
        },
        "risk_indicators": {
          "filters": {
            "filters": {
              "very_large_files": {
                "range": { "network.bytes": { "gte": 1073741824 } }
              },
              "encrypted_transfers": {
                "terms": { "destination.port": [22, 443, 990, 989] }
              },
              "suspicious_destinations": {
                "bool": {
                  "must_not": [{ "terms": { "destination.as.organization.name": ["Google LLC", "Microsoft Corporation", "Amazon.com"] } }]
                }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Dòng thời gian đầy đủ các hoạt động của user nguyenvana trong 7 ngày qua?",
    "keywords": [
      "user timeline",
      "dòng thời gian người dùng",
      "dòng thời gian",
      "timeline",
      "user activity",
      "hoạt động người dùng",
      "hoạt động",
      "activity",
      "account breach",
      "xâm nhập tài khoản",
      "forensic analysis",
      "điều tra số",
      "forensics",
      "điều tra",
      "người dùng",
      "user",
      "nguyenvana",
      "tài khoản",
      "account",
      "7 ngày",
      "week",
      "phân tích",
      "analysis"
    ],
    "scenario": "ỨNG PHỐ SỰ CỐ - PHÁT HIỆN TÀI KHOẢN BỊ XÂM NHẬP",
    "phase": "Giai đoạn 1: Xác định thời điểm và phạm vi",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "term": { "source.user.name": "nguyenvana" } }, { "range": { "@timestamp": { "gte": "now-7d" } } }]
        }
      },
      "_source": [
        "@timestamp",
        "source.ip",
        "source.geo.country_name",
        "destination.ip",
        "destination.port",
        "event.action",
        "rule.name",
        "network.bytes"
      ],
      "sort": [{ "@timestamp": "asc" }],
      "size": 1000
    }
  },
  {
    "question": "User nguyenvana đăng nhập từ bao nhiêu IP khác nhau trong 7 ngày qua?",
    "keywords": [
      "multiple login locations",
      "nhiều địa điểm đăng nhập",
      "multiple logins",
      "nhiều đăng nhập",
      "geographic anomaly",
      "bất thường địa lý",
      "ip analysis",
      "phân tích ip",
      "location tracking",
      "theo dõi vị trí",
      "đăng nhập",
      "login",
      "ip khác nhau",
      "different ip",
      "địa điểm",
      "locations",
      "bao nhiêu",
      "how many",
      "nguyenvana",
      "phân tích",
      "analysis"
    ],
    "scenario": "ỨNG PHỐ SỰ CỐ - PHÁT HIỆN TÀI KHOẢN BỊ XÂM NHẬP",
    "phase": "Giai đoạn 1: Phát hiện nhiều địa điểm đăng nhập",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "term": { "source.user.name": "nguyenvana" } },
            { "term": { "event.action": "login" } },
            { "range": { "@timestamp": { "gte": "now-7d" } } }
          ]
        }
      },
      "aggs": {
        "unique_ips": {
          "terms": { "field": "source.ip", "size": 100 },
          "aggs": {
            "countries": { "terms": { "field": "source.geo.country_name" } },
            "first_seen": { "min": { "field": "@timestamp" } },
            "last_seen": { "max": { "field": "@timestamp" } },
            "login_count": { "value_count": { "field": "@timestamp" } }
          }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Có IP nào đăng nhập đồng thời từ 2 địa điểm khác nhau (di chuyển bất khả thi)?",
    "keywords": [
      "impossible travel",
      "di chuyển bất khả thi",
      "concurrent logins",
      "đăng nhập đồng thời",
      "geographic impossibility",
      "bất khả thi địa lý",
      "account compromise",
      "tài khoản bị đánh cắp",
      "đồng thời",
      "concurrent",
      "2 địa điểm",
      "two locations",
      "bất khả thi",
      "impossible",
      "đăng nhập",
      "login",
      "địa điểm khác nhau",
      "different locations",
      "nguyenvana"
    ],
    "scenario": "ỨNG PHỐ SỰ CỐ - PHÁT HIỆN TÀI KHOẢN BỊ XÂM NHẬP",
    "phase": "Giai đoạn 1: Phát hiện di chuyển bất khả thi",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "term": { "event.action": "login" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }]
        }
      },
      "aggs": {
        "login_timeline": {
          "date_histogram": {
            "field": "@timestamp",
            "fixed_interval": "15m"
          },
          "aggs": {
            "unique_countries": {
              "cardinality": { "field": "source.geo.country_name" }
            },
            "countries": {
              "terms": { "field": "source.geo.country_name" }
            },
            "impossible_travel": {
              "bucket_selector": {
                "buckets_path": { "countries": "unique_countries" },
                "script": "params.countries > 1"
              }
            }
          }
        }
      },
      "size": 0
    }
  },
  {
    "question": "User nguyenvana truy cập những tài nguyên nào khác thường (so với mức cơ bản)?",
    "keywords": [
      "abnormal access",
      "truy cập bất thường",
      "baseline comparison",
      "so sánh mức cơ bản",
      "resource access",
      "truy cập tài nguyên",
      "behavioral analysis",
      "phân tích hành vi",
      "khác thường",
      "unusual",
      "tài nguyên",
      "resources",
      "so với",
      "compared to",
      "mức cơ bản",
      "baseline",
      "nguyenvana",
      "truy cập",
      "access",
      "phân tích",
      "analysis"
    ],
    "scenario": "ỨNG PHỐ SỰ CỐ - PHÁT HIỆN TÀI KHOẢN BỊ XÂM NHẬP",
    "phase": "Giai đoạn 2: Phân tích hành vi bất thường",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "term": { "source.user.name": "nguyenvana" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }]
        }
      },
      "aggs": {
        "recent_destinations": {
          "terms": { "field": "destination.ip", "size": 50 },
          "aggs": {
            "ports": { "terms": { "field": "destination.port" } },
            "total_bytes": { "sum": { "field": "network.bytes" } },
            "protocols": { "terms": { "field": "network.protocol" } }
          }
        }
      },
      "size": 0
    }
  },

  {
    "question": "User nguyenvana có kết nối đến IP/domain đáng ngờ không?",
    "keywords": [
      "malicious connections",
      "kết nối độc hại",
      "c2 communication",
      "giao tiếp c2",
      "suspicious domains",
      "tên miền đáng ngờ",
      "threat intelligence",
      "thông tin mối đe dọa",
      "ip đáng ngờ",
      "suspicious ip",
      "domain đáng ngờ",
      "suspicious domain",
      "kết nối",
      "connection",
      "đáng ngờ",
      "suspicious",
      "nguyenvana",
      "độc hại",
      "malicious"
    ],
    "scenario": "ỨNG PHỐ SỰ CỐ - PHÁT HIỆN TÀI KHOẢN BỊ XÂM NHẬP",
    "phase": "Giai đoạn 2: Kiểm tra kết nối đến máy chủ điều khiển",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "term": { "source.user.name": "nguyenvana" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }],
          "should": [
            { "exists": { "field": "fortinet.firewall.botnetip" } },
            { "exists": { "field": "threat.feed.name" } },
            { "term": { "fortinet.firewall.crlevel": "critical" } },
            { "term": { "rule.category": "malware" } }
          ],
          "minimum_should_match": 1
        }
      },
      "_source": [
        "@timestamp",
        "source.ip",
        "destination.ip",
        "destination.as.organization.name",
        "fortinet.firewall.botnetip",
        "threat.feed.name",
        "fortinet.firewall.attack"
      ],
      "size": 100
    }
  },
  {
    "question": "Có dấu hiệu di chuyển ngang không? (Kết nối nội bộ đến nhiều máy chủ)",
    "keywords": [
      "lateral movement",
      "di chuyển ngang",
      "internal reconnaissance",
      "trinh sát nội bộ",
      "network enumeration",
      "liệt kê mạng",
      "privilege escalation",
      "leo thang đặc quyền",
      "dấu hiệu",
      "signs",
      "di chuyển",
      "movement",
      "nội bộ",
      "internal",
      "nhiều máy chủ",
      "multiple servers",
      "kết nối",
      "connections",
      "nguyenvana"
    ],
    "scenario": "ỨNG PHỐ SỰ CỐ - PHÁT HIỆN TÀI KHOẢN BỊ XÂM NHẬP",
    "phase": "Giai đoạn 2: Phát hiện di chuyển ngang trong mạng",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "term": { "source.user.name": "nguyenvana" } },
            { "term": { "network.direction": "internal" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      },
      "aggs": {
        "internal_destinations": {
          "terms": { "field": "destination.ip", "size": 100 },
          "aggs": {
            "destination_ports": { "terms": { "field": "destination.port" } },
            "first_access": { "min": { "field": "@timestamp" } },
            "protocols_used": { "terms": { "field": "network.protocol" } }
          }
        },
        "unique_dest_count": {
          "cardinality": { "field": "destination.ip" }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Sử dụng băng thông hiện tại so với 7 ngày trước cùng thời điểm?",
    "keywords": [
      "bandwidth comparison",
      "so sánh băng thông",
      "baseline analysis",
      "phân tích mức cơ bản",
      "network performance",
      "hiệu suất mạng",
      "traffic spike",
      "đỉnh lưu lượng",
      "băng thông",
      "bandwidth",
      "hiện tại",
      "current",
      "so với",
      "compared to",
      "7 ngày trước",
      "7 days ago",
      "cùng thời điểm",
      "same time",
      "so sánh",
      "comparison"
    ],
    "scenario": "SUY GIẢM HIỆU SUẤT - TỐC ĐỘ MẠNG CHẬM",
    "phase": "Giai đoạn 1: So sánh mức cơ bản",
    "query": {
      "query": {
        "bool": {
          "should": [
            {
              "range": {
                "@timestamp": {
                  "gte": "now-1h",
                  "lte": "now"
                }
              }
            },
            {
              "range": {
                "@timestamp": {
                  "gte": "now-7d-1h",
                  "lte": "now-7d"
                }
              }
            }
          ]
        }
      },
      "aggs": {
        "by_time_range": {
          "filters": {
            "filters": {
              "current": { "range": { "@timestamp": { "gte": "now-1h" } } },
              "last_week": {
                "range": {
                  "@timestamp": {
                    "gte": "now-7d-1h",
                    "lte": "now-7d"
                  }
                }
              }
            }
          },
          "aggs": {
            "total_bandwidth": { "sum": { "field": "network.bytes" } },
            "total_sessions": { "value_count": { "field": "@timestamp" } },
            "avg_session_size": { "avg": { "field": "network.bytes" } }
          }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Mẫu lưu lượng theo từng 5 phút trong 2 giờ qua?",
    "keywords": [
      "traffic pattern",
      "mẫu lưu lượng",
      "timeline analysis",
      "phân tích dòng thời gian",
      "network trending",
      "xu hướng mạng",
      "peak detection",
      "phát hiện đỉnh",
      "mẫu",
      "pattern",
      "lưu lượng",
      "traffic",
      "5 phút",
      "5 minutes",
      "2 giờ",
      "2 hours",
      "theo từng",
      "every",
      "phân tích",
      "analysis"
    ],
    "scenario": "SUY GIẢM HIỆU SUẤT - TỐC ĐỘ MẠNG CHẬM",
    "phase": "Giai đoạn 1: Vẽ biểu đồ lưu lượng",
    "query": {
      "query": {
        "range": { "@timestamp": { "gte": "now-2h" } }
      },
      "aggs": {
        "traffic_timeline": {
          "date_histogram": {
            "field": "@timestamp",
            "fixed_interval": "5m"
          },
          "aggs": {
            "total_bytes": { "sum": { "field": "network.bytes" } },
            "session_count": { "value_count": { "field": "@timestamp" } },
            "unique_sources": { "cardinality": { "field": "source.ip" } },
            "unique_destinations": { "cardinality": { "field": "destination.ip" } },
            "inbound": {
              "filter": { "term": { "network.direction": "inbound" } },
              "aggs": { "bytes": { "sum": { "field": "network.bytes" } } }
            },
            "outbound": {
              "filter": { "term": { "network.direction": "outbound" } },
              "aggs": { "bytes": { "sum": { "field": "network.bytes" } } }
            }
          }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Top 20 users tiêu tốn băng thông nhiều nhất trong 2h qua?",
    "keywords": [
      "bandwidth hogs",
      "người dùng tiêu thụ băng thông",
      "top consumers",
      "người tiêu thụ hàng đầu",
      "network abuse",
      "lạm dụng mạng",
      "user analysis",
      "phân tích người dùng",
      "top 20",
      "users",
      "người dùng",
      "tiêu tốn",
      "consume",
      "băng thông",
      "bandwidth",
      "nhiều nhất",
      "most",
      "2h qua",
      "2 hours"
    ],
    "scenario": "SUY GIẢM HIỆU SUẤT - TỐC ĐỘ MẠNG CHẬM",
    "phase": "Giai đoạn 2: Tìm thủ phạm tiêu thụ băng thông",
    "query": {
      "query": {
        "range": { "@timestamp": { "gte": "now-2h" } }
      },
      "aggs": {
        "top_users": {
          "terms": {
            "field": "source.user.name",
            "size": 20,
            "order": { "total_bandwidth": "desc" }
          },
          "aggs": {
            "total_bandwidth": { "sum": { "field": "network.bytes" } },
            "session_count": { "value_count": { "field": "@timestamp" } },
            "top_destinations": {
              "terms": { "field": "destination.ip", "size": 5 },
              "aggs": { "bytes": { "sum": { "field": "network.bytes" } } }
            },
            "top_applications": {
              "terms": { "field": "network.application", "size": 5 },
              "aggs": { "bytes": { "sum": { "field": "network.bytes" } } }
            },
            "upload_vs_download": {
              "stats": { "field": "source.bytes" }
            }
          }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Top 20 applications đang chiếm bandwidth?",
    "keywords": [
      "application usage",
      "sử dụng ứng dụng",
      "bandwidth by app",
      "băng thông theo ứng dụng",
      "resource consumption",
      "tiêu thụ tài nguyên",
      "app analysis",
      "phân tích ứng dụng",
      "top 20",
      "applications",
      "ứng dụng",
      "chiếm",
      "consuming",
      "băng thông",
      "bandwidth",
      "đang",
      "currently",
      "phân tích",
      "analysis"
    ],
    "scenario": "SUY GIẢM HIỆU SUẤT - TỐC ĐỘ MẠNG CHẬM",
    "phase": "Giai đoạn 2: Xác định ứng dụng chiếm băng thông",
    "query": {
      "query": {
        "range": { "@timestamp": { "gte": "now-2h" } }
      },
      "aggs": {
        "top_apps": {
          "terms": {
            "field": "network.application",
            "size": 20,
            "order": { "total_bytes": "desc" }
          },
          "aggs": {
            "total_bytes": { "sum": { "field": "network.bytes" } },
            "session_count": { "value_count": { "field": "@timestamp" } },
            "unique_users": { "cardinality": { "field": "source.user.name" } },
            "avg_session_duration": { "avg": { "field": "event.duration" } },
            "protocols": { "terms": { "field": "network.protocol" } }
          }
        }
      },
      "size": 0
    }
  },
  {
    "question": "Network Scanning: Phát hiện port scan và network reconnaissance từ source IP?",
    "keywords": [
      "port scanning",
      "quét cổng",
      "network reconnaissance",
      "trinh sát mạng",
      "scanning activity",
      "hoạt động quét",
      "port probe",
      "thăm dò cổng",
      "network mapping",
      "lập bản đồ mạng",
      "vulnerability scan",
      "quét lỗ hổng",
      "aggressive scanning",
      "quét tích cực"
    ],
    "scenario": "NETWORK SCANNING DETECTION",
    "phase": "Giai đoạn 1: Phát hiện hoạt động quét mạng",
    "securityFramework": "MITRE ATT&CK T1046 - Network Service Scanning",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-1h" } } }, { "term": { "fortinet.firewall.action": "deny" } }]
        }
      },
      "aggs": {
        "scanning_sources": {
          "terms": { "field": "source.ip", "size": 100 },
          "aggs": {
            "unique_dest_ports": {
              "cardinality": { "field": "destination.port" }
            },
            "unique_dest_ips": {
              "cardinality": { "field": "destination.ip" }
            },
            "scan_attempts": {
              "value_count": { "field": "@timestamp" }
            },
            "scanned_ports": {
              "terms": { "field": "destination.port", "size": 50 }
            },
            "target_hosts": {
              "terms": { "field": "destination.ip", "size": 30 }
            },
            "scan_timeline": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "5m"
              }
            },
            "protocols_used": {
              "terms": { "field": "network.protocol", "size": 5 }
            },
            "source_country": {
              "terms": { "field": "source.geo.country_name", "size": 10 }
            }
          }
        },
        "scanning_patterns": {
          "filters": {
            "filters": {
              "port_sweep": {
                "range": {
                  "destination.port": { "gte": 1, "lte": 65535 }
                }
              },
              "host_sweep": {
                "bool": {
                  "must": [{ "exists": { "field": "destination.ip" } }]
                }
              },
              "common_ports": {
                "terms": { "destination.port": [22, 23, 80, 443, 3389, 445, 135] }
              }
            }
          }
        },
        "targeted_services": {
          "terms": { "field": "destination.port", "size": 30 },
          "aggs": {
            "scanning_sources": {
              "terms": { "field": "source.ip", "size": 20 }
            },
            "scan_frequency": {
              "value_count": { "field": "@timestamp" }
            }
          }
        }
      }
    }
  },
  {
    "question": "DDoS Detection: Phát hiện tấn công từ chối dịch vụ dựa trên volume và pattern?",
    "keywords": [
      "DDoS attack",
      "tấn công DDoS",
      "denial of service",
      "từ chối dịch vụ",
      "traffic flooding",
      "làm ngập lưu lượng",
      "volumetric attack",
      "tấn công khối lượng",
      "bandwidth exhaustion",
      "cạn kiệt băng thông",
      "connection flooding",
      "làm ngập kết nối",
      "amplification attack",
      "tấn công khuếch đại"
    ],
    "scenario": "DDOS ATTACK DETECTION",
    "phase": "Giai đoạn 2: Phát hiện tấn công DDoS",
    "securityFramework": "MITRE ATT&CK T1498 - Network Denial of Service",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-10m" } } }]
        }
      },
      "aggs": {
        "traffic_volume_analysis": {
          "date_histogram": {
            "field": "@timestamp",
            "fixed_interval": "1m"
          },
          "aggs": {
            "total_bytes": {
              "sum": { "field": "network.bytes" }
            },
            "total_packets": {
              "sum": { "field": "network.packets" }
            },
            "connection_count": {
              "value_count": { "field": "@timestamp" }
            },
            "unique_sources": {
              "cardinality": { "field": "source.ip" }
            }
          }
        },
        "attack_sources": {
          "terms": { "field": "source.ip", "size": 200 },
          "aggs": {
            "request_count": {
              "value_count": { "field": "@timestamp" }
            },
            "bytes_sent": {
              "sum": { "field": "network.bytes" }
            },
            "target_ports": {
              "terms": { "field": "destination.port", "size": 20 }
            },
            "protocols_used": {
              "terms": { "field": "network.protocol", "size": 5 }
            },
            "request_rate": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "30s"
              }
            }
          }
        },
        "targeted_services": {
          "terms": { "field": "destination.ip", "size": 50 },
          "aggs": {
            "attack_volume": {
              "sum": { "field": "network.bytes" }
            },
            "attacking_sources": {
              "cardinality": { "field": "source.ip" }
            },
            "service_ports": {
              "terms": { "field": "destination.port", "size": 15 }
            }
          }
        },
        "ddos_indicators": {
          "filters": {
            "filters": {
              "high_volume": {
                "range": { "network.bytes": { "gte": 1048576 } }
              },
              "high_frequency": {
                "range": {
                  "@timestamp": { "gte": "now-1m" }
                }
              },
              "syn_flood": {
                "bool": {
                  "must": [{ "term": { "network.protocol": "tcp" } }, { "term": { "fortinet.firewall.action": "deny" } }]
                }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Bandwidth Abuse: Phát hiện user hoặc application sử dụng băng thông quá mức?",
    "keywords": [
      "bandwidth abuse",
      "lạm dụng băng thông",
      "excessive usage",
      "sử dụng quá mức",
      "traffic shaping",
      "định hình lưu lượng",
      "QoS violation",
      "vi phạm QoS",
      "network congestion",
      "tắc nghẽn mạng",
      "heavy users",
      "người dùng nặng",
      "application abuse",
      "lạm dụng ứng dụng"
    ],
    "scenario": "BANDWIDTH UTILIZATION MONITORING",
    "phase": "Giai đoạn 3: Giám sát sử dụng băng thông",
    "securityFramework": "Network Performance Management",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-2h" } } }, { "term": { "fortinet.firewall.action": "accept" } }]
        }
      },
      "aggs": {
        "bandwidth_users": {
          "terms": { "field": "source.user.name", "size": 50 },
          "aggs": {
            "total_bandwidth": {
              "sum": { "field": "network.bytes" }
            },
            "session_count": {
              "value_count": { "field": "@timestamp" }
            },
            "usage_timeline": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "10m"
              },
              "aggs": {
                "period_usage": {
                  "sum": { "field": "network.bytes" }
                }
              }
            },
            "top_destinations": {
              "terms": { "field": "destination.ip", "size": 20 }
            },
            "protocol_breakdown": {
              "terms": { "field": "network.protocol", "size": 10 }
            },
            "service_ports": {
              "terms": { "field": "destination.port", "size": 15 }
            }
          }
        },
        "heavy_applications": {
          "terms": { "field": "destination.port", "size": 30 },
          "aggs": {
            "app_bandwidth": {
              "sum": { "field": "network.bytes" }
            },
            "app_users": {
              "cardinality": { "field": "source.user.name" }
            },
            "avg_session_size": {
              "avg": { "field": "network.bytes" }
            }
          }
        },
        "network_segments": {
          "terms": { "field": "fortinet.firewall.src_int", "size": 20 },
          "aggs": {
            "segment_usage": {
              "sum": { "field": "network.bytes" }
            },
            "segment_users": {
              "cardinality": { "field": "source.ip" }
            }
          }
        },
        "usage_thresholds": {
          "filters": {
            "filters": {
              "heavy_usage": {
                "range": { "network.bytes": { "gte": 104857600 } }
              },
              "streaming_traffic": {
                "terms": { "destination.port": [1935, 8080, 554] }
              },
              "p2p_traffic": {
                "range": { "destination.port": { "gte": 6881, "lte": 6999 } }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Mô hình lưu lượng ICMP: Có kích thước payload bất thường hoặc tần suất lạ?",
    "keywords": [
      "icmp tunneling",
      "đường hầm icmp",
      "icmp traffic",
      "lưu lượng icmp",
      "payload bất thường",
      "unusual payload",
      "đánh cắp dữ liệu",
      "data exfiltration",
      "covert channels",
      "kênh bí mật",
      "network forensics",
      "điều tra mạng",
      "kích thước",
      "payload size",
      "tần suất",
      "frequency",
      "mô hình lưu lượng",
      "traffic pattern"
    ],
    "scenario": "NETWORK COVERT CHANNELS DETECTION",
    "phase": "Giai đoạn 1: Protocol Anomaly Detection",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "term": { "network.protocol": "icmp" } }]
        }
      },
      "aggs": {
        "icmp_analysis": {
          "terms": { "field": "source.ip", "size": 50 },
          "aggs": {
            "packet_sizes": {
              "histogram": {
                "field": "network.bytes",
                "interval": 100
              },
              "aggs": {
                "avg_bytes": { "avg": { "field": "network.bytes" } }
              }
            },
            "frequency_pattern": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "1m"
              }
            },
            "avg_packet_size": { "avg": { "field": "network.bytes" } },
            "unusual_payloads": {
              "bucket_selector": {
                "buckets_path": { "avg_size": "avg_packet_size" },
                "script": "params.avg_size > 1000"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Performance Analysis: Rule nào gây bottleneck và ảnh hưởng hiệu suất firewall?",
    "keywords": [
      "performance bottleneck",
      "bottleneck hiệu suất",
      "firewall performance",
      "hiệu suất firewall",
      "rule optimization",
      "tối ưu rule",
      "throughput analysis",
      "phân tích thông lượng",
      "resource utilization",
      "sử dụng tài nguyên",
      "connection drops",
      "mất kết nối",
      "slow response",
      "phản hồi chậm"
    ],
    "scenario": "NETWORK PERFORMANCE OPTIMIZATION",
    "phase": "Giai đoạn 1: Phân tích tác động hiệu suất",
    "operationalGoal": "Tối ưu hóa hiệu suất firewall và giảm thiểu bottleneck",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-4h" } } },
            {
              "bool": {
                "should": [
                  { "range": { "event.duration": { "gte": 1000 } } },
                  { "range": { "fortinet.firewall.durationdelta": { "gte": 1000 } } },
                  { "term": { "event.outcome": "failure" } },
                  { "term": { "fortinet.firewall.action": "deny" } }
                ]
              }
            }
          ]
        }
      },
      "aggs": {
        "performance_analysis": {
          "terms": { "field": "rule.name", "size": 100 },
          "aggs": {
            "avg_processing_time": {
              "avg": { "field": "event.duration" }
            },
            "max_processing_time": {
              "max": { "field": "event.duration" }
            },
            "total_packets": {
              "value_count": { "field": "@timestamp" }
            },
            "dropped_packets": {
              "filter": { "term": { "fortinet.firewall.action": "deny" } }
            },
            "traffic_volume": {
              "sum": { "field": "network.bytes" }
            },
            "hourly_pattern": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "1h"
              },
              "aggs": {
                "hourly_avg_latency": {
                  "avg": { "field": "event.duration" }
                }
              }
            },
            "source_destinations": {
              "terms": {
                "script": {
                  "source": "doc['source.ip'].value + ' -> ' + doc['destination.ip'].value"
                },
                "size": 50
              }
            }
          }
        },
        "connection_health": {
          "filters": {
            "filters": {
              "successful_connections": { "term": { "fortinet.firewall.action": "accept" } },
              "failed_connections": { "term": { "fortinet.firewall.action": "deny" } },
              "timeout_connections": { "term": { "event.outcome": "timeout" } },
              "high_latency": { "range": { "event.duration": { "gte": 5000 } } }
            }
          }
        },
        "protocol_performance": {
          "terms": { "field": "network.protocol", "size": 20 },
          "aggs": {
            "avg_throughput": {
              "avg": { "field": "network.bytes" }
            },
            "connection_success_rate": {
              "filters": {
                "filters": {
                  "successful": { "term": { "fortinet.firewall.action": "accept" } },
                  "failed": { "term": { "fortinet.firewall.action": "deny" } }
                }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Capacity Planning: Dự báo nhu cầu băng thông và tài nguyên hệ thống trong 30 ngày tới?",
    "keywords": [
      "capacity planning",
      "lập kế hoạch dung lượng",
      "bandwidth forecasting",
      "dự báo băng thông",
      "resource planning",
      "lập kế hoạch tài nguyên",
      "growth prediction",
      "dự đoán tăng trưởng",
      "utilization trends",
      "xu hướng sử dụng",
      "peak usage analysis",
      "phân tích sử dụng đỉnh",
      "infrastructure scaling",
      "mở rộng hạ tầng",
      "future requirements",
      "yêu cầu tương lai"
    ],
    "scenario": "INFRASTRUCTURE CAPACITY PLANNING",
    "phase": "Giai đoạn 2: Dự báo và lập kế hoạch",
    "operationalGoal": "Đảm bảo hạ tầng đáp ứng nhu cầu tương lai",
    "query": {
      "query": {
        "range": { "@timestamp": { "gte": "now-30d" } }
      },
      "aggs": {
        "bandwidth_trends": {
          "date_histogram": {
            "field": "@timestamp",
            "calendar_interval": "1d"
          },
          "aggs": {
            "daily_total_bytes": {
              "sum": { "field": "network.bytes" }
            },
            "daily_packet_count": {
              "value_count": { "field": "@timestamp" }
            },
            "daily_unique_sources": {
              "cardinality": { "field": "source.ip" }
            },
            "daily_unique_destinations": {
              "cardinality": { "field": "destination.ip" }
            },
            "peak_hour_usage": {
              "max_bucket": {
                "buckets_path": "hourly_breakdown>total_bytes"
              }
            },
            "hourly_breakdown": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "1h"
              },
              "aggs": {
                "total_bytes": {
                  "sum": { "field": "network.bytes" }
                }
              }
            }
          }
        },
        "growth_analysis": {
          "date_histogram": {
            "field": "@timestamp",
            "calendar_interval": "1w"
          },
          "aggs": {
            "weekly_bytes": {
              "sum": { "field": "network.bytes" }
            },
            "weekly_connections": {
              "value_count": { "field": "@timestamp" }
            },
            "growth_rate": {
              "derivative": {
                "buckets_path": "weekly_bytes"
              }
            }
          }
        },
        "resource_utilization": {
          "terms": { "field": "destination.port", "size": 50 },
          "aggs": {
            "port_usage_trend": {
              "date_histogram": {
                "field": "@timestamp",
                "calendar_interval": "1d"
              },
              "aggs": {
                "daily_connections": {
                  "value_count": { "field": "@timestamp" }
                }
              }
            },
            "total_traffic": {
              "sum": { "field": "network.bytes" }
            }
          }
        },
        "predictive_metrics": {
          "avg_bucket": {
            "buckets_path": "bandwidth_trends>daily_total_bytes"
          }
        }
      }
    }
  },
  {
    "question": "Threat Hunting: Phát hiện kết nối đến botnet trong 48h qua?",
    "keywords": [
      "botnet detection",
      "phát hiện botnet",
      "command control",
      "điều khiển từ xa",
      "malicious IP",
      "IP độc hại",
      "threat hunting",
      "săn lùng mối đe dọa",
      "IOC detection",
      "phát hiện IOC",
      "C2 communication",
      "giao tiếp C2",
      "malware communication",
      "giao tiếp malware",
      "botnet IP",
      "IP botnet"
    ],
    "scenario": "BOTNET DETECTION AND ANALYSIS",
    "phase": "Giai đoạn 1: Phát hiện kết nối botnet",
    "securityFramework": "MITRE ATT&CK T1071 - Application Layer Protocol",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-48h" } } }, { "exists": { "field": "fortinet.firewall.botnetip" } }]
        }
      },
      "aggs": {
        "botnet_analysis": {
          "terms": { "field": "fortinet.firewall.botnetip", "size": 50 },
          "aggs": {
            "affected_sources": {
              "terms": { "field": "source.ip", "size": 100 }
            },
            "botnet_domains": {
              "terms": { "field": "fortinet.firewall.botnetdomain", "size": 30 }
            },
            "communication_timeline": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "1h"
              }
            },
            "total_connections": {
              "value_count": { "field": "@timestamp" }
            },
            "data_transferred": {
              "sum": { "field": "network.bytes" }
            },
            "protocols_used": {
              "terms": { "field": "network.protocol", "size": 10 }
            },
            "destination_ports": {
              "terms": { "field": "destination.port", "size": 20 }
            }
          }
        },
        "infected_hosts": {
          "terms": { "field": "source.ip", "size": 100 },
          "aggs": {
            "botnet_contacts": {
              "terms": { "field": "fortinet.firewall.botnetip", "size": 20 }
            },
            "infection_timeline": {
              "date_histogram": {
                "field": "@timestamp",
                "calendar_interval": "1h"
              }
            },
            "host_details": {
              "terms": { "field": "host.name", "size": 50 }
            },
            "user_context": {
              "terms": { "field": "source.user.name", "size": 30 }
            }
          }
        }
      },
      "_source": [
        "@timestamp",
        "source.ip",
        "fortinet.firewall.botnetip",
        "fortinet.firewall.botnetdomain",
        "network.bytes",
        "destination.port",
        "host.name",
        "source.user.name"
      ],
      "size": 100
    }
  },
  {
    "question": "Living off the Land: Phát hiện sử dụng DNS để truyền dữ liệu bất thường?",
    "keywords": [
      "DNS tunneling",
      "đường hầm DNS",
      "data exfiltration",
      "đánh cắp dữ liệu",
      "covert channels",
      "kênh bí mật",
      "DNS abuse",
      "lạm dụng DNS",
      "abnormal DNS",
      "DNS bất thường",
      "living off the land",
      "sống bằng đất",
      "legitimate protocol abuse",
      "lạm dụng giao thức hợp pháp"
    ],
    "scenario": "DNS TUNNELING DETECTION",
    "phase": "Giai đoạn 2: Phát hiện lạm dụng DNS",
    "securityFramework": "MITRE ATT&CK T1071.004 - DNS",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-2h" } } },
            { "term": { "destination.port": 53 } },
            { "term": { "network.protocol": "udp" } },
            { "exists": { "field": "dns.question.name" } }
          ]
        }
      },
      "aggs": {
        "dns_analysis": {
          "terms": { "field": "source.ip", "size": 100 },
          "aggs": {
            "query_patterns": {
              "terms": { "field": "dns.question.name", "size": 50 }
            },
            "query_types": {
              "terms": { "field": "dns.question.type", "size": 10 }
            },
            "query_frequency": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "1m"
              }
            },
            "unique_domains": {
              "cardinality": { "field": "dns.question.registered_domain" }
            },
            "total_queries": {
              "value_count": { "field": "dns.question.name" }
            },
            "suspicious_tlds": {
              "terms": { "field": "dns.question.top_level_domain", "size": 20 }
            },
            "long_queries": {
              "filter": {
                "script": {
                  "script": {
                    "source": "doc['dns.question.name'].size() > 0 && doc['dns.question.name'].value.length() > 50"
                  }
                }
              }
            },
            "subdomain_analysis": {
              "terms": { "field": "dns.question.subdomain", "size": 30 }
            }
          }
        },
        "anomaly_indicators": {
          "filters": {
            "filters": {
              "high_frequency": {
                "range": { "@timestamp": { "gte": "now-1m" } }
              },
              "unusual_record_types": {
                "terms": { "dns.question.type": ["TXT", "NULL", "CNAME"] }
              },
              "non_standard_ports": {
                "bool": {
                  "must_not": [{ "term": { "destination.port": 53 } }]
                }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Lateral Movement: Phát hiện kết nối SMB/RDP bất thường giữa các host?",
    "keywords": [
      "lateral movement",
      "di chuyển ngang",
      "SMB traffic",
      "lưu lượng SMB",
      "RDP connections",
      "kết nối RDP",
      "internal spreading",
      "lan truyền nội bộ",
      "administrative access",
      "truy cập quản trị",
      "credential abuse",
      "lạm dụng credential",
      "network reconnaissance",
      "trinh sát mạng"
    ],
    "scenario": "LATERAL MOVEMENT DETECTION",
    "phase": "Giai đoạn 3: Phát hiện di chuyển ngang",
    "securityFramework": "MITRE ATT&CK T1021 - Remote Services",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-4h" } } },
            { "term": { "network.direction": "internal" } },
            { "term": { "fortinet.firewall.action": "accept" } },
            {
              "bool": {
                "should": [
                  { "term": { "destination.port": 445 } },
                  { "term": { "destination.port": 3389 } },
                  { "term": { "destination.port": 139 } },
                  { "term": { "destination.port": 135 } }
                ]
              }
            }
          ]
        }
      },
      "aggs": {
        "lateral_movement_analysis": {
          "terms": { "field": "source.ip", "size": 100 },
          "aggs": {
            "target_hosts": {
              "terms": { "field": "destination.ip", "size": 50 },
              "aggs": {
                "connection_ports": {
                  "terms": { "field": "destination.port", "size": 10 }
                },
                "connection_timeline": {
                  "date_histogram": {
                    "field": "@timestamp",
                    "fixed_interval": "10m"
                  }
                }
              }
            },
            "protocols_used": {
              "terms": { "field": "network.protocol", "size": 5 }
            },
            "user_context": {
              "terms": { "field": "source.user.name", "size": 20 }
            },
            "total_connections": {
              "value_count": { "field": "@timestamp" }
            },
            "data_volume": {
              "sum": { "field": "network.bytes" }
            },
            "unique_targets": {
              "cardinality": { "field": "destination.ip" }
            }
          }
        },
        "service_analysis": {
          "terms": { "field": "destination.port", "size": 10 },
          "aggs": {
            "service_usage": {
              "terms": {
                "script": {
                  "source": "doc['source.ip'].value + ' -> ' + doc['destination.ip'].value"
                },
                "size": 100
              }
            },
            "hourly_pattern": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "1h"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Phân tích vi phạm Zero Trust: Kết nối nào không thông qua xác thực trong 24h qua?",
    "keywords": [
      "zero trust violation",
      "vi phạm zero trust",
      "authentication bypass",
      "bỏ qua xác thực",
      "unauthenticated access",
      "truy cập không xác thực",
      "lateral movement",
      "di chuyển ngang",
      "trust boundary",
      "ranh giới tin cậy",
      "verify explicitly",
      "xác minh rõ ràng",
      "least privilege",
      "quyền tối thiểu"
    ],
    "scenario": "ZERO TRUST ARCHITECTURE MONITORING",
    "phase": "Giai đoạn 1: Phát hiện vi phạm chính sách Zero Trust",
    "securityFramework": "NIST Zero Trust Architecture SP 800-207",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-24h" } } },
            { "term": { "fortinet.firewall.action": "accept" } },
            {
              "bool": {
                "must_not": [{ "exists": { "field": "source.user.name" } }]
              }
            },
            {
              "bool": {
                "should": [{ "term": { "network.direction": "inbound" } }, { "term": { "network.direction": "internal" } }]
              }
            }
          ]
        }
      },
      "aggs": {
        "unauthenticated_connections": {
          "terms": { "field": "source.ip", "size": 100 },
          "aggs": {
            "connection_types": {
              "terms": { "field": "event.action", "size": 20 }
            },
            "accessed_resources": {
              "terms": { "field": "destination.ip", "size": 50 }
            },
            "protocols_used": {
              "terms": { "field": "network.protocol", "size": 10 }
            },
            "ports_accessed": {
              "terms": { "field": "destination.port", "size": 30 }
            },
            "data_transferred": {
              "sum": { "field": "network.bytes" }
            },
            "connection_timeline": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "1h"
              }
            },
            "source_countries": {
              "terms": { "field": "source.geo.country_name", "size": 20 }
            }
          }
        },
        "network_segments": {
          "terms": { "field": "fortinet.firewall.dintf", "size": 20 },
          "aggs": {
            "segment_traffic": {
              "sum": { "field": "network.bytes" }
            },
            "unique_sources": {
              "cardinality": { "field": "source.ip" }
            }
          }
        }
      }
    }
  },
  {
    "question": "Micro-segmentation: Lưu lượng East-West không được phép giữa các vùng mạng?",
    "keywords": [
      "micro-segmentation",
      "phân đoạn vi mô",
      "east-west traffic",
      "lưu lượng east-west",
      "lateral movement",
      "di chuyển ngang",
      "network zones",
      "vùng mạng",
      "segment violation",
      "vi phạm phân đoạn",
      "network isolation",
      "cô lập mạng",
      "inter-zone communication",
      "giao tiếp liên vùng"
    ],
    "scenario": "MICRO-SEGMENTATION MONITORING",
    "phase": "Giai đoạn 2: Giám sát giao tiếp liên vùng",
    "securityFramework": "Zero Trust Network Segmentation",
    "query": {
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-1h" } } },
            { "term": { "network.direction": "internal" } },
            { "term": { "fortinet.firewall.action": "accept" } },
            {
              "bool": {
                "should": [
                  {
                    "bool": {
                      "must": [{ "term": { "fortinet.firewall.srcintfrole": "lan" } }, { "term": { "fortinet.firewall.dstintfrole": "dmz" } }]
                    }
                  },
                  {
                    "bool": {
                      "must": [{ "term": { "fortinet.firewall.srcintfrole": "dmz" } }, { "term": { "fortinet.firewall.dstintfrole": "lan" } }]
                    }
                  },
                  {
                    "bool": {
                      "must": [{ "term": { "fortinet.firewall.src_int": "internal" } }, { "term": { "fortinet.firewall.dst_int": "dmz" } }]
                    }
                  }
                ]
              }
            }
          ]
        }
      },
      "aggs": {
        "unauthorized_flows": {
          "terms": {
            "script": {
              "source": "doc['source.ip'].value + ' -> ' + doc['destination.ip'].value"
            },
            "size": 100
          },
          "aggs": {
            "flow_volume": {
              "sum": { "field": "network.bytes" }
            },
            "protocol_breakdown": {
              "terms": { "field": "network.protocol", "size": 10 }
            },
            "port_analysis": {
              "terms": { "field": "destination.port", "size": 20 }
            },
            "timeline": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "5m"
              }
            },
            "source_interface": {
              "terms": { "field": "fortinet.firewall.src_int", "size": 10 }
            },
            "dest_interface": {
              "terms": { "field": "fortinet.firewall.dst_int", "size": 10 }
            }
          }
        },
        "interface_roles": {
          "terms": { "field": "fortinet.firewall.srcintfrole", "size": 10 },
          "aggs": {
            "dest_roles": {
              "terms": { "field": "fortinet.firewall.dstintfrole", "size": 10 }
            }
          }
        }
      }
    }
  }
]
