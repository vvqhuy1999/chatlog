[
  {
    "question": "Trong 24 giờ qua, những IP nguồn nào bị chặn (deny) nhiều nhất?",
    "keywords": ["IP nguồn", "chặn", "deny", "nhiều nhất"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "term": { "fortinet.firewall.action": "deny" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      },
      "aggs": {
        "top_blocked_sources": {
          "terms": { "field": "source.ip", "size": 50 }
        }
      }
    }
  },
  {
    "question": "Từ IP nguồn 192.0.2.10, đích nào nhận nhiều bytes nhất trong 24 giờ qua?",
    "keywords": ["IP nguồn", "đích", "bytes", "nhiều nhất"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "term": { "source.ip": "192.0.2.10" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      },
      "aggs": {
        "by_dst": {
          "terms": { "field": "destination.ip", "size": 50, "order": { "bytes_sum": "desc" } },
          "aggs": {
            "bytes_sum": { "sum": { "field": "network.bytes" } }
          }
        }
      }
    }
  },
  {
    "question": "Liệt kê các phiên có mức rủi ro IPS cao (crlevel = high/critical) trong 1 ngày qua.",
    "keywords": ["phiên", "rủi ro", "IPS", "cao", "critical"],
    "query": {
      "size": 50,
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "filter": [
            { "terms": { "fortinet.firewall.crlevel": ["high", "critical"] } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Trong 7 ngày qua, các kết nối outbound từ Việt Nam ra nước ngoài (không phải Việt Nam) là gì?",
    "keywords": ["kết nối", "outbound", "Việt Nam", "nước ngoài"],
    "query": {
      "size": 100,
      "query": {
        "bool": {
          "must": [
            { "term": { "network.direction": "outbound" } },
            { "term": { "source.geo.country_name": "Vietnam" } }
          ],
          "must_not": [
            { "term": { "destination.geo.country_name": "Vietnam" } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-7d" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Có những lần đăng nhập thất bại của người dùng 'alice' trong 48 giờ qua không?",
    "keywords": ["đăng nhập", "thất bại", "người dùng", "alice"],
    "query": {
      "size": 100,
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "must": [
            { "term": { "source.user.name": "alice" } },
            { "term": { "event.action": "login" } },
            { "term": { "event.outcome": "failure" } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-48h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Những rule nào chặn nhiều nhất trong 24 giờ qua?",
    "keywords": ["rule", "chặn", "nhiều nhất"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "term": { "fortinet.firewall.action": "deny" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      },
      "aggs": {
        "rules": {
          "terms": { "field": "rule.name", "size": 50 }
        }
      }
    }
  },
  {
    "question": "Trong 1 giờ qua, có lưu lượng RDP (port 3389) đi vào từ WAN không?",
    "keywords": ["RDP", "port 3389", "WAN", "lưu lượng"],
    "query": {
      "size": 100,
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "filter": [
            { "term": { "destination.port": 3389 } },
            { "term": { "fortinet.firewall.srcintfrole": "wan" } },
            { "range": { "@timestamp": { "gte": "now-1h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Các phiên DNAT tới server nội bộ 10.0.0.10 trong 24 giờ gần đây là gì?",
    "keywords": ["phiên", "DNAT", "server", "nội bộ"],
    "query": {
      "size": 100,
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "filter": [
            { "term": { "fortinet.firewall.trandisp": "dnat" } },
            { "term": { "destination.ip": "10.0.0.10" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Trong 1 giờ qua, IP nguồn nào gửi nhiều gói ICMP bất thường (> 10.000 packets)?",
    "keywords": ["IP nguồn", "ICMP", "bất thường", "packets"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "term": { "network.protocol": "icmp" } },
            { "range": { "@timestamp": { "gte": "now-1h" } } }
          ]
        }
      },
      "aggs": {
        "by_source": {
          "terms": { "field": "source.ip", "size": 50 },
          "aggs": {
            "pkt_sum": { "sum": { "field": "network.packets" } },
            "heavy_senders": {
              "bucket_selector": {
                "buckets_path": { "p": "pkt_sum" },
                "script": "params.p > 10000"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Có traffic bị 'drop' bởi policy shaping tên 'Limit-Guest' trên thiết bị FGT-01 trong 24 giờ qua không?",
    "keywords": ["traffic", "drop", "policy", "shaping", "Limit-Guest"],
    "query": {
      "size": 100,
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "must": [
            { "term": { "observer.name": "FGT-01" } },
            { "term": { "fortinet.firewall.shapingpolicyname": "Limit-Guest" } }
          ],
          "filter": [
            { "term": { "fortinet.firewall.action": "deny" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  
  {
    "question": "Ai đã đăng nhập vào thiết bị Fortigate bằng tài khoản admin trong 24 giờ qua?",
    "keywords": ["đăng nhập", "Fortigate", "admin", "tài khoản"],
    "query": {
      "size": 50,
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "must": [
            { "term": { "source.user.roles":"Administrator" } },
            { "term": { "event.action": "login" } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Có phiên đăng nhập quản trị thất bại (admin login failed) nào trong 1 giờ qua không?",
    "keywords": ["phiên", "đăng nhập", "quản trị", "thất bại", "admin"],
    "query": {
      "size": 50,
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "must": [
            { "term": { "event.action": "login" } },
            { "term": { "event.outcome": "failure" } },
            { "term": { "source.user.roles":"Administrator" } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-1h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Trong 7 ngày qua có thay đổi nào về rule firewall không?",
    "keywords": ["thay đổi", "rule", "firewall"],
    "query": {
      "size": 100,
      "sort": [{ "@timestamp": "desc" }],
      "query": {
        "bool": {
          "must": [
            { "term": { "event.type": "configuration" } },
            { "term": { "rule.ruleset": "firewall" } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-7d" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Ai đã thay đổi cấu hình hệ thống trong 24 giờ qua?",
    "keywords": ["thay đổi", "cấu hình", "hệ thống"],
    "query": {
      "size": 100,
      "query": {
        "bool": {
          "must": [
            { "term": { "event.type": "configuration" } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      },
      "aggs": {
        "by_user": {
          "terms": { "field": "source.user.name", "size": 50 }
        }
      }
    }
  },
  {
    "question": "Có đăng nhập quản trị nào từ quốc gia khác Việt Nam trong 48 giờ qua?",
    "keywords": ["đăng nhập", "quản trị", "quốc gia", "Việt Nam"],
    "query": {
      "size": 50,
      "query": {
        "bool": {
          "must": [
            { "term": { "event.action": "login" } },
            { "term": { "fortinet.firewall.srcintfrole": "wan" } }
          ],
          "must_not": [
            { "term": { "source.geo.country_name": "Vietnam" } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-48h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Trong 24 giờ qua có ai bật/tắt tính năng IPS hoặc AV không?",
    "keywords": ["bật", "tắt", "tính năng", "IPS", "AV"],
    "query": {
      "size": 50,
      "query": {
        "bool": {
          "must": [
            { "term": { "event.type": "configuration" } },
            { "terms": { "rule.category": ["IPS", "Antivirus"] } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Có dấu hiệu brute-force login (quá nhiều login failure từ 1 IP) trong 1 giờ qua không?",
    "keywords": ["brute-force", "login", "failure", "IP"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "must": [
            { "term": { "event.action": "login" } },
            { "term": { "event.outcome": "failure" } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-1h" } } }
          ]
        }
      },
      "aggs": {
        "by_ip": {
          "terms": { "field": "source.ip", "size": 20 },
          "aggs": {
            "fail_count": { "value_count": { "field": "event.outcome" } },
            "brute_force": {
              "bucket_selector": {
                "buckets_path": { "c": "fail_count" },
                "script": "params.c > 10"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Có IP nào thực hiện quá nhiều kết nối đến port quản trị (443, 22) trong 15 phút gần đây không?",
    "keywords": ["IP", "kết nối", "port", "quản trị", "443", "22"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "terms": { "destination.port": [22, 443] } },
            { "range": { "@timestamp": { "gte": "now-15m" } } }
          ]
        }
      },
      "aggs": {
        "by_src": {
          "terms": { "field": "source.ip", "size": 20 },
          "aggs": {
            "conn_count": { "value_count": { "field": "destination.port" } },
            "suspicious": {
              "bucket_selector": {
                "buckets_path": { "c": "conn_count" },
                "script": "params.c > 50"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Ai đã thay đổi policy shaping trong 7 ngày qua?",
    "keywords": ["thay đổi", "policy", "shaping"],
    "query": {
      "size": 100,
      "query": {
        "bool": {
          "must": [
            { "term": { "event.type": "configuration" } },
            { "exists": { "field": "fortinet.firewall.shapingpolicyname" } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-7d" } } }
          ]
        }
      },
      "aggs": {
        "by_user": {
          "terms": { "field": "source.user.name", "size": 50 }
        }
      }
    }
  },
  {
    "question": "Có thay đổi nào trong cấu hình interface WAN trong 24 giờ qua không?",
    "keywords": ["thay đổi", "cấu hình", "interface", "WAN"],
    "query": {
      "size": 50,
      "query": {
        "bool": {
          "must": [
            { "term": { "event.type": "configuration" } }
          ],
          "should": [
            { "term": { "observer.ingress.interface.name": "wan" } },
            { "term": { "observer.egress.interface.name": "wan" } }
          ],
          "minimum_should_match": 1,
          "filter": [
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Trong 24 giờ qua, những user nào bị chặn khi cố gắng kết nối SSH?",
    "keywords": ["user", "chặn", "kết nối", "SSH"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "term": { "destination.port": 22 } },
            { "term": { "fortinet.firewall.action": "deny" } },
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      },
      "aggs": {
        "blocked_users": {
          "terms": { "field": "source.user.name", "size": 50 }
        }
      }
    }
  },
  {
    "question": "Có user nào bị chặn khi truy cập RDP (3389) từ LAN ra ngoài internet không?",
    "keywords": ["user", "chặn", "RDP", "3389", "LAN"],
    "query": {
      "size": 50,
      "query": {
        "bool": {
          "must": [
            { "term": { "destination.port": 3389 } },
            { "term": { "fortinet.firewall.action": "deny" } },
            { "term": { "fortinet.firewall.srcintfrole": "lan" } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Trong 1 giờ qua có user nào gửi nhiều gói ICMP bị chặn?",
    "keywords": ["user", "ICMP", "bị chặn"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "term": { "network.protocol": "icmp" } },
            { "term": { "fortinet.firewall.action": "deny" } },
            { "range": { "@timestamp": { "gte": "now-1h" } } }
          ]
        }
      },
      "aggs": {
        "blocked_icmp": {
          "terms": { "field": "source.user.name", "size": 50 },
          "aggs": {
            "pkt_sum": { "sum": { "field": "network.packets" } }
          }
        }
      }
    }
  },
  {
    "question": "Những user nào cố gắng quét port (nhiều destination.port khác nhau) trong 15 phút gần đây?",
    "keywords": ["user", "quét", "port", "destination"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            { "range": { "@timestamp": { "gte": "now-15m" } } }
          ]
        }
      },
      "aggs": {
        "by_user": {
          "terms": { "field": "source.user.name", "size": 20 },
          "aggs": {
            "unique_ports": { "cardinality": { "field": "destination.port" } },
            "port_scan": {
              "bucket_selector": {
                "buckets_path": { "p": "unique_ports" },
                "script": "params.p > 10"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Có user nào bị chặn khi tải file qua FTP (port 21) không?",
    "keywords": ["user", "chặn", "tải file", "FTP", "21"],
    "query": {
      "size": 50,
      "query": {
        "bool": {
          "must": [
            { "term": { "destination.port": 21 } },
            { "term": { "fortinet.firewall.action": "deny" } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Trong 7 ngày qua, user nào bị chặn nhiều nhất vì truy cập web không hợp lệ?",
    "keywords": ["user", "chặn", "nhiều nhất", "web", "không hợp lệ"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "must": [
            { "term": { "fortinet.firewall.subtype": "webfilter" } },
            { "term": { "fortinet.firewall.action": "deny" } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-7d" } } }
          ]
        }
      },
      "aggs": {
        "top_users": {
          "terms": { "field": "source.user.name", "size": 50 }
        }
      }
    }
  },
  {
    "question": "Có user nào kết nối đến quốc gia bị hạn chế (ví dụ: Russia, China) trong 24 giờ qua không?",
    "keywords": ["user", "kết nối", "quốc gia", "hạn chế", "Russia", "China"],
    "query": {
      "size": 50,
      "query": {
        "bool": {
          "must": [
            { "terms": { "destination.geo.country_name": ["Russia", "China"] } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Trong 1 giờ qua có user nào upload quá nhiều dữ liệu ra ngoài (>1GB) không?",
    "keywords": ["user", "upload", "dữ liệu", "1GB"],
    "query": {
      "size": 0,
      "query": {
        "bool": {
          "must": [
            { "term": { "network.direction": "outbound" } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-1h" } } }
          ]
        }
      },
      "aggs": {
        "by_user": {
          "terms": { "field": "source.user.name", "size": 20 },
          "aggs": {
            "bytes_sent": { "sum": { "field": "network.bytes" } },
            "big_upload": {
              "bucket_selector": {
                "buckets_path": { "b": "bytes_sent" },
                "script": "params.b > 1073741824"
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Có user nào trong LAN cố gắng truy cập dịch vụ quản trị web của Fortigate (port 443) bị chặn?",
    "keywords": ["user", "LAN", "truy cập", "quản trị", "web", "Fortigate", "443"],
    "query": {
      "size": 50,
      "query": {
        "bool": {
          "must": [
            { "term": { "destination.port": 443 } },
            { "term": { "fortinet.firewall.action": "deny" } },
            { "term": { "fortinet.firewall.srcintfrole": "lan" } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Trong 24 giờ qua, có user nào bị chặn khi dùng ứng dụng P2P (torrent) không?",
    "keywords": ["user", "chặn", "ứng dụng", "P2P", "torrent"],
    "query": {
      "size": 50,
      "query": {
        "bool": {
          "must": [
            { "term": { "rule.category": "p2p" } },
            { "term": { "fortinet.firewall.action": "deny" } }
          ],
          "filter": [
            { "range": { "@timestamp": { "gte": "now-24h" } } }
          ]
        }
      }
    }
  },
  {
    "question": "Hiển thị log của user QuynhTX từ 8h sáng đến 5h chiều hôm nay",
    "keywords": ["log", "user", "quynhtx", "8h sáng", "5h chiều", "hôm nay"],
    "query": { "query": { "bool": { "filter": [ { "term": { "source.user.name": "QuynhTX" } }, { "range": { "@timestamp": { "gte": "now/d+8h", "lte": "now/d+17h" } } } ] } }, "_source": ["@timestamp", "source.user.name", "source.ip", "destination.ip", "event.action", "rule.name"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  },
  {
    "question": "Traffic trong khung giờ 22h-6h sáng (ngoài giờ làm việc) trong 3 ngày qua",
    "keywords": ["traffic", "khung giờ", "22h-6h", "ngoài giờ", "3 ngày"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-3d" } } }], "must": { "script": { "script": { "source": "doc['@timestamp'].value.getHour() >= 22 || doc['@timestamp'].value.getHour() < 6" } } } } }, "_source": ["@timestamp", "source.ip", "destination.ip", "network.bytes", "source.user.name"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  },
  {
    "question": "So sánh số lượng connections giữa hôm nay và hôm qua",
    "keywords": ["so sánh", "số lượng", "connections", "hôm nay", "hôm qua"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-2d/d" } } }] } }, "aggs": { "by_day": { "date_histogram": { "field": "@timestamp", "calendar_interval": "day" }, "aggs": { "connection_count": { "value_count": { "field": "@timestamp" } } } } }, "size": 0 }
  },
  {
    "question": "Tìm các kết nối xuất hiện trong 5 phút đầu tiên của mỗi giờ trong 24h qua",
    "keywords": ["5 phút đầu", "mỗi giờ", "24h qua"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }], "must": { "script": { "script": { "source": "doc['@timestamp'].value.getMinute() < 5" } } } } }, "_source": ["@timestamp", "source.ip", "destination.ip", "source.user.name"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  },
  {
    "question": "Log nào được tạo ra vào cuối tuần (thứ 7, chủ nhật) trong tháng này?",
    "keywords": ["cuối tuần", "thứ 7", "chủ nhật", "tháng này"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now/M" } } }], "must": { "script": { "script": { "source": "doc['@timestamp'].value.getDayOfWeek() >= 6" } } } } }, "_source": ["@timestamp", "source.ip", "source.user.name", "event.action"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  },
  {
    "question": "Traffic cao điểm nhất trong ngày là lúc nào? (group by hour)",
    "keywords": ["traffic", "cao điểm", "group by hour", "lúc nào"],
    "query": { "query": { "range": { "@timestamp": { "gte": "now-24h" } } }, "aggs": { "by_hour": { "date_histogram": { "field": "@timestamp", "calendar_interval": "hour" }, "aggs": { "total_bytes": { "sum": { "field": "network.bytes" } } } } }, "size": 0 }
  },
  {
    "question": "Có log nào được tạo ra giữa 15-09-2025 10:00 và 15-09-2025 15:30 không?",
    "keywords": ["giữa", "15-09-2025", "10:00", "15:30"],
    "query": { "query": { "range": { "@timestamp": { "gte": "2025-09-15T10:00:00.000+07:00", "lte": "2025-09-15T15:30:00.000+07:00" } } }, "_source": ["@timestamp", "source.ip", "destination.ip", "source.user.name", "event.action"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  },
  {
    "question": "Khoảng thời gian nào có nhiều kết nối bị chặn nhất trong 7 ngày qua?",
    "keywords": ["khoảng thời gian", "nhiều nhất", "kết nối bị chặn", "7 ngày"],
    "query": { "query": { "bool": { "filter": [{ "term": { "fortinet.firewall.action": "deny" } }, { "range": { "@timestamp": { "gte": "now-7d" } } }] } }, "aggs": { "by_hour": { "date_histogram": { "field": "@timestamp", "calendar_interval": "hour" }, "aggs": { "denied_count": { "value_count": { "field": "@timestamp" } } } } }, "size": 0 }
  },
  {
    "question": "User nào làm việc ngoài giờ (sau 18h hoặc trước 8h) nhiều nhất?",
    "keywords": ["user", "ngoài giờ", "sau 18h", "trước 8h", "nhiều nhất"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-7d" } } }], "must": { "script": { "script": { "source": "doc['@timestamp'].value.getHour() >= 18 || doc['@timestamp'].value.getHour() < 8" } } } } }, "aggs": { "by_user": { "terms": { "field": "source.user.name", "size": 10 } } }, "size": 0 }
  },
  {
    "question": "Tìm các phiên kết nối kéo dài quá 1 giờ",
    "keywords": ["phiên", "kết nối", "kéo dài", "1 giờ", "duration"],
    "query": { "query": { "bool": { "filter": [{ "range": { "event.duration": { "gt": 3600000000000 } } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } }, "_source": ["@timestamp", "source.ip", "destination.ip", "source.user.name", "event.duration", "rule.name"], "sort": [{ "event.duration": "desc" }], "size": 50 }
  },
  {
    "question": "Top 10 applications được sử dụng nhiều nhất theo network.protocol",
    "keywords": ["top 10", "applications", "network.protocol", "nhiều nhất"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "network.protocol" } }] } }, "aggs": { "top_apps": { "terms": { "field": "network.protocol", "size": 10 } } }, "size": 0 }
  },
  {
    "question": "Tìm tất cả DNS queries đến domain có chứa 'google' trong 6h qua",
    "keywords": ["dns queries", "domain", "google", "6h"],
    "query": { "query": { "bool": { "filter": [{ "wildcard": { "dns.question.name": "*google*" } }, { "range": { "@timestamp": { "gte": "now-6h" } } }] } }, "_source": ["@timestamp", "source.ip", "dns.question.name", "dns.question.type", "dns.resolved_ip"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  },
  {
    "question": "Có bao nhiêu HTTPS sessions (port 443) với TLS version 1.2?",
    "keywords": ["bao nhiêu", "https", "port 443", "tls 1.2"],
    "query": { "query": { "bool": { "filter": [{ "term": { "destination.port": 443 } }, { "term": { "tls.version": "1.2" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } }, "aggs": { "session_count": { "value_count": { "field": "@timestamp" } } }, "size": 0 }
  },
  {
    "question": "Liệt kê các HTTP requests với method POST trong 3h qua",
    "keywords": ["http requests", "method post", "3h"],
    "query": { "query": { "bool": { "filter": [{ "term": { "http.request.method": "POST" } }, { "range": { "@timestamp": { "gte": "now-3h" } } }] } }, "_source": ["@timestamp", "source.ip", "source.user.name", "destination.ip", "url.original", "http.request.method"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  },
  {
    "question": "Traffic ICMP chiếm bao nhiêu phần trăm tổng traffic?",
    "keywords": ["traffic icmp", "phần trăm", "tổng traffic"],
    "query": { "query": { "range": { "@timestamp": { "gte": "now-24h" } } }, "aggs": { "total_traffic": { "sum": { "field": "network.bytes" } }, "icmp_traffic": { "filter": { "term": { "network.protocol": "icmp" } }, "aggs": { "bytes": { "sum": { "field": "network.bytes" } } } } }, "size": 0 }
  },
  {
    "question": "User nào truy cập nhiều domains khác nhau nhất?",
    "keywords": ["user", "domains", "khác nhau", "nhiều nhất"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "url.domain" } }] } }, "aggs": { "by_user": { "terms": { "field": "source.user.name", "size": 10, "order": { "unique_domains": "desc" } }, "aggs": { "unique_domains": { "cardinality": { "field": "url.domain" } } } } }, "size": 0 }
  },
  {
    "question": "Có kết nối nào sử dụng protocol không phổ biến?",
    "keywords": ["protocol", "không phổ biến"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }], "must_not": [{ "terms": { "network.transport": ["tcp", "udp"] } }, { "terms": { "network.protocol": ["icmp", "dns", "http", "https"] } }] } }, "_source": ["@timestamp", "source.ip", "destination.ip", "network.protocol", "network.transport"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  },
  {
    "question": "Top 5 TLS cipher suites được sử dụng nhiều nhất",
    "keywords": ["top 5", "tls", "cipher suites", "nhiều nhất"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "tls.cipher" } }] } }, "aggs": { "top_ciphers": { "terms": { "field": "tls.cipher", "size": 5 } } }, "size": 0 }
  },
  {
    "question": "Tìm các DNS queries không thành công trong 24h qua",
    "keywords": ["dns queries", "không thành công", "24h"],
    "query": { "query": { "bool": { "filter": [{ "exists": { "field": "dns.question.name" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }], "must_not": [{ "exists": { "field": "dns.resolved_ip" } }] } }, "_source": ["@timestamp", "source.ip", "dns.question.name", "dns.question.type"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  },
  {
    "question": "Kết nối nào có URL path chứa '/admin' hoặc '/login'?",
    "keywords": ["url path", "/admin", "/login"],
    "query": { "query": { "bool": { "should": [{ "wildcard": { "url.path": "*/admin*" } }, { "wildcard": { "url.path": "*/login*" } }], "minimum_should_match": 1, "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }] } }, "_source": ["@timestamp", "source.ip", "source.user.name", "url.original", "url.path"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  },
  {
    "question": "Traffic đi qua interface WiFi-HPTVIETNAM nhiều hơn hay port3?",
    "keywords": ["traffic", "interface", "wifi-hptvietnam", "port3"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }], "should": [{ "term": { "observer.ingress.interface.name": "WiFi-HPTVIETNAM" } }, { "term": { "observer.ingress.interface.name": "port3" } }], "minimum_should_match": 1 } }, "aggs": { "by_interface": { "terms": { "field": "observer.ingress.interface.name", "size": 10 }, "aggs": { "total_bytes": { "sum": { "field": "network.bytes" } } } } }, "size": 0 }
  },
  {
    "question": "Tìm các kết nối internal (source và destination đều trong mạng nội bộ)",
    "keywords": ["internal", "nội bộ"],
    "query": { "query": { "bool": { "filter": [{ "term": { "network.direction": "internal" } }, { "range": { "@timestamp": { "gte": "now-6h" } } }] } }, "_source": ["@timestamp", "source.ip", "destination.ip", "network.bytes", "rule.name"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  },
  {
    "question": "Top 10 destination ports được truy cập nhiều nhất từ LAN",
    "keywords": ["top 10", "destination ports", "lan"],
    "query": { "query": { "bool": { "filter": [{ "term": { "fortinet.firewall.srcintfrole": "lan" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } }, "aggs": { "top_ports": { "terms": { "field": "destination.port", "size": 10 } } }, "size": 0 }
  },
  {
    "question": "Có traffic nào đi từ DMZ ra WAN không?",
    "keywords": ["traffic", "dmz", "wan"],
    "query": { "query": { "bool": { "filter": [{ "term": { "fortinet.firewall.srcintfrole": "dmz" } }, { "term": { "fortinet.firewall.dstintfrole": "wan" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } }, "_source": ["@timestamp", "source.ip", "destination.ip", "network.bytes", "rule.name"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  },
  {
    "question": "Phân tích traffic theo interface role (lan/wan/dmz) trong 24h qua",
    "keywords": ["phân tích", "traffic", "interface role", "lan", "wan", "dmz"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "fortinet.firewall.srcintfrole" } }] } }, "aggs": { "by_interface_role": { "terms": { "field": "fortinet.firewall.srcintfrole", "size": 10 }, "aggs": { "total_bytes": { "sum": { "field": "network.bytes" } } } } }, "size": 0 }
  },
  {
    "question": "Source MAC address nào có nhiều connections nhất?",
    "keywords": ["mac address", "connections", "nhiều nhất"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "source.mac" } }] } }, "aggs": { "top_macs": { "terms": { "field": "source.mac", "size": 10 } } }, "size": 0 }
  },
  {
    "question": "Tìm các kết nối có source port > 50000 (ephemeral ports)",
    "keywords": ["source port", "50000", "ephemeral"],
    "query": { "query": { "bool": { "filter": [{ "range": { "source.port": { "gt": 50000 } } }, { "range": { "@timestamp": { "gte": "now-6h" } } }] } }, "_source": ["@timestamp", "source.ip", "source.port", "destination.ip", "destination.port"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  },
  {
    "question": "Traffic inbound và outbound chiếm tỷ lệ bao nhiêu?",
    "keywords": ["inbound", "outbound", "tỷ lệ"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "network.direction" } }] } }, "aggs": { "by_direction": { "terms": { "field": "network.direction", "size": 10 }, "aggs": { "total_bytes": { "sum": { "field": "network.bytes" } } } } }, "size": 0 }
  },
  {
    "question": "Có kết nối nào từ observer.name = 'FTG-CNHN' đến observer khác không?",
    "keywords": ["observer.name", "ftg-chnhn"],
    "query": { "query": { "bool": { "filter": [{ "term": { "observer.name": "FTG-CNHN" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } }, "_source": ["@timestamp", "observer.name", "source.ip", "destination.ip", "rule.name"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  },
  {
    "question": "Liệt kê các egress interfaces được sử dụng nhiều nhất",
    "keywords": ["egress", "interfaces", "nhiều nhất"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "observer.egress.interface.name" } }] } }, "aggs": { "top_egress": { "terms": { "field": "observer.egress.interface.name", "size": 10 } } }, "size": 0 }
  },
  {
    "question": "Top 10 sessions có network.bytes lớn nhất trong 12h qua",
    "keywords": ["top 10", "sessions", "network.bytes", "lớn nhất", "12h"],
    "query": { "query": { "range": { "@timestamp": { "gte": "now-12h" } } }, "_source": ["@timestamp", "source.ip", "destination.ip", "network.bytes", "source.user.name", "rule.name"], "sort": [{ "network.bytes": "desc" }], "size": 10 }
  },
  {
    "question": "User nào có tổng packets gửi đi (source.packets) nhiều nhất?",
    "keywords": ["user", "tổng packets", "nhiều nhất"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "source.user.name" } }] } }, "aggs": { "top_users": { "terms": { "field": "source.user.name", "size": 10, "order": { "total_packets": "desc" } }, "aggs": { "total_packets": { "sum": { "field": "source.packets" } } } } }, "size": 0 }
  },
  {
    "question": "Tìm các sessions có packet loss > 10%",
    "keywords": ["sessions", "packet loss", "> 10%"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }], "must": { "script": { "script": { "source": "doc['fortinet.firewall.packetloss'].value > 10" } } } } }, "_source": ["@timestamp", "source.ip", "destination.ip", "fortinet.firewall.packetloss"], "sort": [{ "fortinet.firewall.packetloss": "desc" }], "size": 50 }
  },
  {
    "question": "Average bytes per session trong 24h qua là bao nhiêu?",
    "keywords": ["average", "avg", "bytes", "session", "24h"],
    "query": { "query": { "range": { "@timestamp": { "gte": "now-24h" } } }, "aggs": { "avg_bytes": { "avg": { "field": "network.bytes" } } }, "size": 0 }
  },
  {
    "question": "Kết nối nào có destination.bytes lớn hơn source.bytes (download > upload)?",
    "keywords": ["destination.bytes", "source.bytes", "download", "upload"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-6h" } } }], "must": { "script": { "script": { "source": "doc['destination.bytes'].value > doc['source.bytes'].value" } } } } }, "_source": ["@timestamp", "source.ip", "destination.ip", "source.bytes", "destination.bytes"], "sort": [{ "destination.bytes": "desc" }], "size": 50 }
  },
  {
    "question": "Tổng bandwidth sử dụng trong 1 giờ qua là bao nhiêu?",
    "keywords": ["tổng", "bandwidth", "1 giờ"],
    "query": { "query": { "range": { "@timestamp": { "gte": "now-1h" } } }, "aggs": { "total_bandwidth": { "sum": { "field": "network.bytes" } } }, "size": 0 }
  },
  {
    "question": "Top 10 connections có ratio bytes/packets cao nhất (large packets)",
    "keywords": ["top 10", "ratio", "bytes/packets", "large packets"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "range": { "network.packets": { "gt": 0 } } }] } }, "aggs": { "top_connections": { "terms": { "field": "source.ip", "size": 10, "order": { "bytes_per_packet": "desc" } }, "aggs": { "total_bytes": { "sum": { "field": "network.bytes" } }, "total_packets": { "sum": { "field": "network.packets" } }, "bytes_per_packet": { "bucket_script": { "buckets_path": { "bytes": "total_bytes", "packets": "total_packets" }, "script": "params.bytes / params.packets" } } } } }, "size": 0 }
  },
  {
    "question": "Có session nào có duration < 1 giây nhưng bytes > 1MB? (suspicious)",
    "keywords": ["duration", "bytes", "suspicious", "1 giây", "1mb"],
    "query": { "query": { "bool": { "filter": [{ "range": { "event.duration": { "lt": 1000000000 } } }, { "range": { "network.bytes": { "gt": 1048576 } } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } }, "_source": ["@timestamp", "source.ip", "destination.ip", "event.duration", "network.bytes", "rule.name"], "sort": [{ "network.bytes": "desc" }], "size": 50 }
  },
  {
    "question": "User nào có average session duration dài nhất?",
    "keywords": ["user", "average", "session duration", "dài nhất"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "source.user.name" } }, { "exists": { "field": "event.duration" } }] } }, "aggs": { "by_user": { "terms": { "field": "source.user.name", "size": 10, "order": { "avg_duration": "desc" } }, "aggs": { "avg_duration": { "avg": { "field": "event.duration" } } } } }, "size": 0 }
  },
  {
    "question": "Phân tích distribution của network.bytes (histogram)",
    "keywords": ["phân tích", "distribution", "network.bytes", "histogram"],
    "query": { "query": { "range": { "@timestamp": { "gte": "now-24h" } } }, "aggs": { "bytes_distribution": { "histogram": { "field": "network.bytes", "interval": 1048576 } } }, "size": 0 }
  },
  {
    "question": "Có bao nhiêu MacBooks đang kết nối trong mạng?",
    "keywords": ["bao nhiêu", "macbooks", "kết nối"],
    "query": { "query": { "bool": { "filter": [{ "term": { "fortinet.firewall.srchwversion": "MacBook Pro" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } }, "aggs": { "unique_macbooks": { "cardinality": { "field": "source.ip" } } }, "size": 0 }
  },
  {
    "question": "Liệt kê tất cả các OS versions đang được sử dụng",
    "keywords": ["liệt kê", "os versions"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "fortinet.firewall.srcswversion" } }] } }, "aggs": { "os_versions": { "terms": { "field": "fortinet.firewall.srcswversion", "size": 20 } } }, "size": 0 }
  },
  {
    "question": "Device nào có nhiều source MAC addresses khác nhau? (MAC spoofing?)",
    "keywords": ["device", "mac addresses", "mac spoofing"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "host.name" } }] } }, "aggs": { "by_device": { "terms": { "field": "host.name", "size": 20, "order": { "unique_macs": "desc" } }, "aggs": { "unique_macs": { "cardinality": { "field": "source.mac" } } } } }, "size": 0 }
  },
  {
    "question": "Tìm các Windows devices với OS version cũ (< Windows 10)",
    "keywords": ["windows", "os version", "cũ", "< windows 10"],
    "query": { "query": { "bool": { "filter": [{ "term": { "fortinet.firewall.osname": "Windows" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }], "must_not": [{ "wildcard": { "fortinet.firewall.srcswversion": "*10*" } }, { "wildcard": { "fortinet.firewall.srcswversion": "*11*" } }] } }, "_source": ["@timestamp", "source.ip", "fortinet.firewall.osname", "fortinet.firewall.srcswversion", "host.name"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  },
  {
    "question": "Top 10 device types (Laptop/Desktop/Mobile) có traffic nhiều nhất",
    "keywords": ["top 10", "device types", "laptop", "desktop", "mobile", "traffic"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "fortinet.firewall.devtype" } }] } }, "aggs": { "top_device_types": { "terms": { "field": "fortinet.firewall.devtype", "size": 10, "order": { "total_bytes": "desc" } }, "aggs": { "total_bytes": { "sum": { "field": "network.bytes" } } } } }, "size": 0 }
  },
  {
    "question": "Có device nào đổi IP address trong 6h qua không?",
    "keywords": ["device", "đổi ip", "6h"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-6h" } } }, { "exists": { "field": "host.name" } }] } }, "aggs": { "by_hostname": { "terms": { "field": "host.name", "size": 50 }, "aggs": { "unique_ips": { "cardinality": { "field": "source.ip" } }, "ip_change": { "bucket_selector": { "buckets_path": { "ips": "unique_ips" }, "script": "params.ips > 1" } } } } }, "size": 0 }
  },
  {
    "question": "Devices từ vendor Apple chiếm bao nhiêu phần trăm?",
    "keywords": ["devices", "vendor", "apple", "phần trăm"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }, { "exists": { "field": "fortinet.firewall.srchwvendor" } }] } }, "aggs": { "total_devices": { "cardinality": { "field": "source.ip" } }, "apple_devices": { "filter": { "term": { "fortinet.firewall.srchwvendor": "Apple" } }, "aggs": { "count": { "cardinality": { "field": "source.ip" } } } } }, "size": 0 }
  },
  {
    "question": "Tìm các unidentified devices (không có devtype)",
    "keywords": ["unidentified", "devices", "không có devtype"],
    "query": { "query": { "bool": { "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }], "must_not": [{ "exists": { "field": "fortinet.firewall.devtype" } }] } }, "_source": ["@timestamp", "source.ip", "source.mac", "host.name"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  },
  {
    "question": "Host nào có nhiều failed connections nhất?",
    "keywords": ["host", "failed connections", "nhiều nhất"],
    "query": { "query": { "bool": { "filter": [{ "term": { "event.outcome": "failure" } }, { "range": { "@timestamp": { "gte": "now-24h" } } }] } }, "aggs": { "top_failed_hosts": { "terms": { "field": "host.name", "size": 10 } } }, "size": 0 }
  },
  {
    "question": "Liệt kê các container hoặc cloud instances",
    "keywords": ["container", "cloud instances"],
    "query": { "query": { "bool": { "should": [{ "exists": { "field": "container.id" } }, { "exists": { "field": "cloud.instance.id" } }], "minimum_should_match": 1, "filter": [{ "range": { "@timestamp": { "gte": "now-24h" } } }] } }, "_source": ["@timestamp", "container.id", "container.name", "cloud.instance.id", "cloud.provider", "source.ip"], "sort": [{ "@timestamp": "desc" }], "size": 50 }
  }

]
