[
  {
    "question": "Network Scanning: Phát hiện port scan và network reconnaissance từ source IP?",
    "keywords": [
      "port scanning",
      "quét cổng",
      "network reconnaissance",
      "trinh sát mạng",
      "scanning activity",
      "hoạt động quét",
      "port probe",
      "thăm dò cổng",
      "network mapping",
      "lập bản đồ mạng",
      "vulnerability scan",
      "quét lỗ hổng",
      "aggressive scanning",
      "quét tích cực"
    ],
    "scenario": "NETWORK SCANNING DETECTION",
    "phase": "Giai đoạn 1: Phát hiện hoạt động quét mạng",
    "securityFramework": "MITRE ATT&CK T1046 - Network Service Scanning",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-1h" } } }, { "term": { "fortinet.firewall.action": "deny" } }]
        }
      },
      "aggs": {
        "scanning_sources": {
          "terms": { "field": "source.ip", "size": 100 },
          "aggs": {
            "unique_dest_ports": {
              "cardinality": { "field": "destination.port" }
            },
            "unique_dest_ips": {
              "cardinality": { "field": "destination.ip" }
            },
            "scan_attempts": {
              "value_count": { "field": "@timestamp" }
            },
            "scanned_ports": {
              "terms": { "field": "destination.port", "size": 50 }
            },
            "target_hosts": {
              "terms": { "field": "destination.ip", "size": 30 }
            },
            "scan_timeline": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "5m"
              }
            },
            "protocols_used": {
              "terms": { "field": "network.protocol", "size": 5 }
            },
            "source_country": {
              "terms": { "field": "source.geo.country_name", "size": 10 }
            }
          }
        },
        "scanning_patterns": {
          "filters": {
            "filters": {
              "port_sweep": {
                "range": {
                  "destination.port": { "gte": 1, "lte": 65535 }
                }
              },
              "host_sweep": {
                "bool": {
                  "must": [{ "exists": { "field": "destination.ip" } }]
                }
              },
              "common_ports": {
                "terms": { "destination.port": [22, 23, 80, 443, 3389, 445, 135] }
              }
            }
          }
        },
        "targeted_services": {
          "terms": { "field": "destination.port", "size": 30 },
          "aggs": {
            "scanning_sources": {
              "terms": { "field": "source.ip", "size": 20 }
            },
            "scan_frequency": {
              "value_count": { "field": "@timestamp" }
            }
          }
        }
      }
    }
  },
  {
    "question": "DDoS Detection: Phát hiện tấn công từ chối dịch vụ dựa trên volume và pattern?",
    "keywords": [
      "DDoS attack",
      "tấn công DDoS",
      "denial of service",
      "từ chối dịch vụ",
      "traffic flooding",
      "làm ngập lưu lượng",
      "volumetric attack",
      "tấn công khối lượng",
      "bandwidth exhaustion",
      "cạn kiệt băng thông",
      "connection flooding",
      "làm ngập kết nối",
      "amplification attack",
      "tấn công khuếch đại"
    ],
    "scenario": "DDOS ATTACK DETECTION",
    "phase": "Giai đoạn 2: Phát hiện tấn công DDoS",
    "securityFramework": "MITRE ATT&CK T1498 - Network Denial of Service",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-10m" } } }]
        }
      },
      "aggs": {
        "traffic_volume_analysis": {
          "date_histogram": {
            "field": "@timestamp",
            "fixed_interval": "1m"
          },
          "aggs": {
            "total_bytes": {
              "sum": { "field": "network.bytes" }
            },
            "total_packets": {
              "sum": { "field": "network.packets" }
            },
            "connection_count": {
              "value_count": { "field": "@timestamp" }
            },
            "unique_sources": {
              "cardinality": { "field": "source.ip" }
            }
          }
        },
        "attack_sources": {
          "terms": { "field": "source.ip", "size": 200 },
          "aggs": {
            "request_count": {
              "value_count": { "field": "@timestamp" }
            },
            "bytes_sent": {
              "sum": { "field": "network.bytes" }
            },
            "target_ports": {
              "terms": { "field": "destination.port", "size": 20 }
            },
            "protocols_used": {
              "terms": { "field": "network.protocol", "size": 5 }
            },
            "request_rate": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "30s"
              }
            }
          }
        },
        "targeted_services": {
          "terms": { "field": "destination.ip", "size": 50 },
          "aggs": {
            "attack_volume": {
              "sum": { "field": "network.bytes" }
            },
            "attacking_sources": {
              "cardinality": { "field": "source.ip" }
            },
            "service_ports": {
              "terms": { "field": "destination.port", "size": 15 }
            }
          }
        },
        "ddos_indicators": {
          "filters": {
            "filters": {
              "high_volume": {
                "range": { "network.bytes": { "gte": 1048576 } }
              },
              "high_frequency": {
                "range": {
                  "@timestamp": { "gte": "now-1m" }
                }
              },
              "syn_flood": {
                "bool": {
                  "must": [{ "term": { "network.protocol": "tcp" } }, { "term": { "fortinet.firewall.action": "deny" } }]
                }
              }
            }
          }
        }
      }
    }
  },
  {
    "question": "Bandwidth Abuse: Phát hiện user hoặc application sử dụng băng thông quá mức?",
    "keywords": [
      "bandwidth abuse",
      "lạm dụng băng thông",
      "excessive usage",
      "sử dụng quá mức",
      "traffic shaping",
      "định hình lưu lượng",
      "QoS violation",
      "vi phạm QoS",
      "network congestion",
      "tắc nghẽn mạng",
      "heavy users",
      "người dùng nặng",
      "application abuse",
      "lạm dụng ứng dụng"
    ],
    "scenario": "BANDWIDTH UTILIZATION MONITORING",
    "phase": "Giai đoạn 3: Giám sát sử dụng băng thông",
    "securityFramework": "Network Performance Management",
    "query": {
      "query": {
        "bool": {
          "filter": [{ "range": { "@timestamp": { "gte": "now-2h" } } }, { "term": { "fortinet.firewall.action": "accept" } }]
        }
      },
      "aggs": {
        "bandwidth_users": {
          "terms": { "field": "source.user.name", "size": 50 },
          "aggs": {
            "total_bandwidth": {
              "sum": { "field": "network.bytes" }
            },
            "session_count": {
              "value_count": { "field": "@timestamp" }
            },
            "usage_timeline": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "10m"
              },
              "aggs": {
                "period_usage": {
                  "sum": { "field": "network.bytes" }
                }
              }
            },
            "top_destinations": {
              "terms": { "field": "destination.ip", "size": 20 }
            },
            "protocol_breakdown": {
              "terms": { "field": "network.protocol", "size": 10 }
            },
            "service_ports": {
              "terms": { "field": "destination.port", "size": 15 }
            }
          }
        },
        "heavy_applications": {
          "terms": { "field": "destination.port", "size": 30 },
          "aggs": {
            "app_bandwidth": {
              "sum": { "field": "network.bytes" }
            },
            "app_users": {
              "cardinality": { "field": "source.user.name" }
            },
            "avg_session_size": {
              "avg": { "field": "network.bytes" }
            }
          }
        },
        "network_segments": {
          "terms": { "field": "fortinet.firewall.src_int", "size": 20 },
          "aggs": {
            "segment_usage": {
              "sum": { "field": "network.bytes" }
            },
            "segment_users": {
              "cardinality": { "field": "source.ip" }
            }
          }
        },
        "usage_thresholds": {
          "filters": {
            "filters": {
              "heavy_usage": {
                "range": { "network.bytes": { "gte": 104857600 } }
              },
              "streaming_traffic": {
                "terms": { "destination.port": [1935, 8080, 554] }
              },
              "p2p_traffic": {
                "range": { "destination.port": { "gte": 6881, "lte": 6999 } }
              }
            }
          }
        }
      }
    }
  }
]
