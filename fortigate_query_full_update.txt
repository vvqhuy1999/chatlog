Câu 1: Hiển thị log của user QuynhTX từ 8h sáng đến 5h chiều hôm nay
json{"query":{"bool":{"filter":[{"term":{"source.user.name":"QuynhTX"}},{"range":{"@timestamp":{"gte":"now/d+8h","lte":"now/d+17h"}}}]}},"_source":["@timestamp","source.user.name","source.ip","destination.ip","event.action","rule.name"],"sort":[{"@timestamp":"desc"}],"size":50}
Câu 2: Traffic trong khung giờ 22h-6h sáng (ngoài giờ làm việc) trong 3 ngày qua
json{"query":{"bool":{"should":[{"range":{"@timestamp":{"gte":"now-3d","lte":"now","format":"hour_minute","time_zone":"+07:00"}},"script":{"script":{"source":"doc['@timestamp'].value.getHour() >= 22 || doc['@timestamp'].value.getHour() < 6"}}}],"filter":[{"range":{"@timestamp":{"gte":"now-3d"}}}]}},"_source":["@timestamp","source.ip","destination.ip","network.bytes","source.user.name"],"sort":[{"@timestamp":"desc"}],"size":50}
Câu 3: So sánh số lượng connections giữa hôm nay và hôm qua
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-2d/d"}}}]}},"aggs":{"by_day":{"date_histogram":{"field":"@timestamp","calendar_interval":"day"},"aggs":{"connection_count":{"value_count":{"field":"@timestamp"}}}}},"size":0}
Câu 4: Tìm các kết nối xuất hiện trong 5 phút đầu tiên của mỗi giờ trong 24h qua
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}}],"must":{"script":{"script":{"source":"doc['@timestamp'].value.getMinute() < 5"}}}}},"_source":["@timestamp","source.ip","destination.ip","source.user.name"],"sort":[{"@timestamp":"desc"}],"size":50}
Câu 5: Log nào được tạo ra vào cuối tuần (thứ 7, chủ nhật) trong tháng này?
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now/M"}}}],"must":{"script":{"script":{"source":"doc['@timestamp'].value.getDayOfWeek() >= 6"}}}}},"_source":["@timestamp","source.ip","source.user.name","event.action"],"sort":[{"@timestamp":"desc"}],"size":50}
Câu 6: Traffic cao điểm nhất trong ngày là lúc nào? (group by hour)
json{"query":{"range":{"@timestamp":{"gte":"now-24h"}}},"aggs":{"by_hour":{"date_histogram":{"field":"@timestamp","calendar_interval":"hour"},"aggs":{"total_bytes":{"sum":{"field":"network.bytes"}}}}},"size":0}
Câu 7: Có log nào được tạo ra giữa 15-09-2025 10:00 và 15-09-2025 15:30 không?
json{"query":{"range":{"@timestamp":{"gte":"2025-09-15T10:00:00.000+07:00","lte":"2025-09-15T15:30:00.000+07:00"}}},"_source":["@timestamp","source.ip","destination.ip","source.user.name","event.action"],"sort":[{"@timestamp":"desc"}],"size":50}
Câu 8: Khoảng thời gian nào có nhiều kết nối bị chặn nhất trong 7 ngày qua?
json{"query":{"bool":{"filter":[{"term":{"fortinet.firewall.action":"deny"}},{"range":{"@timestamp":{"gte":"now-7d"}}}]}},"aggs":{"by_hour":{"date_histogram":{"field":"@timestamp","calendar_interval":"hour"},"aggs":{"denied_count":{"value_count":{"field":"@timestamp"}}}}},"size":0}
Câu 9: User nào làm việc ngoài giờ (sau 18h hoặc trước 8h) nhiều nhất?
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-7d"}}}],"must":{"script":{"script":{"source":"doc['@timestamp'].value.getHour() >= 18 || doc['@timestamp'].value.getHour() < 8"}}}}},"aggs":{"by_user":{"terms":{"field":"source.user.name","size":10}}},"size":0}
Câu 10: Tìm các phiên kết nối kéo dài quá 1 giờ
json{"query":{"bool":{"filter":[{"range":{"event.duration":{"gt":3600000000000}}},{"range":{"@timestamp":{"gte":"now-24h"}}}]}},"_source":["@timestamp","source.ip","destination.ip","source.user.name","event.duration","rule.name"],"sort":[{"event.duration":"desc"}],"size":50}
B. APPLICATION & PROTOCOL ANALYSIS (10 câu)
Câu 11: Top 10 applications được sử dụng nhiều nhất theo network.protocol
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}},{"exists":{"field":"network.protocol"}}]}},"aggs":{"top_apps":{"terms":{"field":"network.protocol","size":10}}},"size":0}
Câu 12: Tìm tất cả DNS queries đến domain có chứa "google" trong 6h qua
json{"query":{"bool":{"filter":[{"wildcard":{"dns.question.name":"*google*"}},{"range":{"@timestamp":{"gte":"now-6h"}}}]}},"_source":["@timestamp","source.ip","dns.question.name","dns.question.type","dns.resolved_ip"],"sort":[{"@timestamp":"desc"}],"size":50}
Câu 13: Có bao nhiêu HTTPS sessions (port 443) với TLS version 1.2?
json{"query":{"bool":{"filter":[{"term":{"destination.port":443}},{"term":{"tls.version":"1.2"}},{"range":{"@timestamp":{"gte":"now-24h"}}}]}},"aggs":{"session_count":{"value_count":{"field":"@timestamp"}}},"size":0}
Câu 14: Liệt kê các HTTP requests với method POST trong 3h qua
json{"query":{"bool":{"filter":[{"term":{"http.request.method":"POST"}},{"range":{"@timestamp":{"gte":"now-3h"}}}]}},"_source":["@timestamp","source.ip","source.user.name","destination.ip","url.original","http.request.method"],"sort":[{"@timestamp":"desc"}],"size":50}
Câu 15: Traffic ICMP chiếm bao nhiêu phần trăm tổng traffic?
json{"query":{"range":{"@timestamp":{"gte":"now-24h"}}},"aggs":{"total_traffic":{"sum":{"field":"network.bytes"}},"icmp_traffic":{"filter":{"term":{"network.protocol":"icmp"}},"aggs":{"bytes":{"sum":{"field":"network.bytes"}}}}},"size":0}
Câu 16: User nào truy cập nhiều domains khác nhau nhất?
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}},{"exists":{"field":"url.domain"}}]}},"aggs":{"by_user":{"terms":{"field":"source.user.name","size":10,"order":{"unique_domains":"desc"}},"aggs":{"unique_domains":{"cardinality":{"field":"url.domain"}}}}},"size":0}
Câu 17: Có kết nối nào sử dụng protocol không phổ biến?
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}}],"must_not":[{"terms":{"network.transport":["tcp","udp"]}},{"terms":{"network.protocol":["icmp","dns","http","https"]}}]}},"_source":["@timestamp","source.ip","destination.ip","network.protocol","network.transport"],"sort":[{"@timestamp":"desc"}],"size":50}
Câu 18: Top 5 TLS cipher suites được sử dụng nhiều nhất
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}},{"exists":{"field":"tls.cipher"}}]}},"aggs":{"top_ciphers":{"terms":{"field":"tls.cipher","size":5}}},"size":0}
Câu 19: Tìm các DNS queries không thành công trong 24h qua
json{"query":{"bool":{"filter":[{"exists":{"field":"dns.question.name"}},{"range":{"@timestamp":{"gte":"now-24h"}}}],"must_not":[{"exists":{"field":"dns.resolved_ip"}}]}},"_source":["@timestamp","source.ip","dns.question.name","dns.question.type"],"sort":[{"@timestamp":"desc"}],"size":50}
Câu 20: Kết nối nào có URL path chứa "/admin" hoặc "/login"?
json{"query":{"bool":{"should":[{"wildcard":{"url.path":"*/admin*"}},{"wildcard":{"url.path":"*/login*"}}],"minimum_should_match":1,"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}}]}},"_source":["@timestamp","source.ip","source.user.name","url.original","url.path"],"sort":[{"@timestamp":"desc"}],"size":50}
C. NETWORK & INTERFACE ANALYSIS (10 câu)
Câu 21: Traffic đi qua interface WiFi-HPTVIETNAM nhiều hơn hay port3?
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}}],"should":[{"term":{"observer.ingress.interface.name":"WiFi-HPTVIETNAM"}},{"term":{"observer.ingress.interface.name":"port3"}}],"minimum_should_match":1}},"aggs":{"by_interface":{"terms":{"field":"observer.ingress.interface.name","size":10},"aggs":{"total_bytes":{"sum":{"field":"network.bytes"}}}}},"size":0}
Câu 22: Tìm các kết nối internal (source và destination đều trong mạng nội bộ)
json{"query":{"bool":{"filter":[{"term":{"network.direction":"internal"}},{"range":{"@timestamp":{"gte":"now-6h"}}}]}},"_source":["@timestamp","source.ip","destination.ip","network.bytes","rule.name"],"sort":[{"@timestamp":"desc"}],"size":50}
Câu 23: Top 10 destination ports được truy cập nhiều nhất từ LAN
json{"query":{"bool":{"filter":[{"term":{"fortinet.firewall.srcintfrole":"lan"}},{"range":{"@timestamp":{"gte":"now-24h"}}}]}},"aggs":{"top_ports":{"terms":{"field":"destination.port","size":10}}},"size":0}
Câu 24: Có traffic nào đi từ DMZ ra WAN không?
json{"query":{"bool":{"filter":[{"term":{"fortinet.firewall.srcintfrole":"dmz"}},{"term":{"fortinet.firewall.dstintfrole":"wan"}},{"range":{"@timestamp":{"gte":"now-24h"}}}]}},"_source":["@timestamp","source.ip","destination.ip","network.bytes","rule.name"],"sort":[{"@timestamp":"desc"}],"size":50}
Câu 25: Phân tích traffic theo interface role (lan/wan/dmz) trong 24h qua
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}},{"exists":{"field":"fortinet.firewall.srcintfrole"}}]}},"aggs":{"by_interface_role":{"terms":{"field":"fortinet.firewall.srcintfrole","size":10},"aggs":{"total_bytes":{"sum":{"field":"network.bytes"}}}}},"size":0}
Câu 26: Source MAC address nào có nhiều connections nhất?
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}},{"exists":{"field":"source.mac"}}]}},"aggs":{"top_macs":{"terms":{"field":"source.mac","size":10}}},"size":0}
Câu 27: Tìm các kết nối có source port > 50000 (ephemeral ports)
json{"query":{"bool":{"filter":[{"range":{"source.port":{"gt":50000}}},{"range":{"@timestamp":{"gte":"now-6h"}}}]}},"_source":["@timestamp","source.ip","source.port","destination.ip","destination.port"],"sort":[{"@timestamp":"desc"}],"size":50}
Câu 28: Traffic inbound và outbound chiếm tỷ lệ bao nhiêu?
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}},{"exists":{"field":"network.direction"}}]}},"aggs":{"by_direction":{"terms":{"field":"network.direction","size":10},"aggs":{"total_bytes":{"sum":{"field":"network.bytes"}}}}},"size":0}
Câu 29: Có kết nối nào từ observer.name = "FTG-CNHN" đến observer khác không?
json{"query":{"bool":{"filter":[{"term":{"observer.name":"FTG-CNHN"}},{"range":{"@timestamp":{"gte":"now-24h"}}}]}},"_source":["@timestamp","observer.name","source.ip","destination.ip","rule.name"],"sort":[{"@timestamp":"desc"}],"size":50}
Câu 30: Liệt kê các egress interfaces được sử dụng nhiều nhất
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}},{"exists":{"field":"observer.egress.interface.name"}}]}},"aggs":{"top_egress":{"terms":{"field":"observer.egress.interface.name","size":10}}},"size":0}
D. TRAFFIC VOLUME & PERFORMANCE (10 câu)
Câu 31: Top 10 sessions có network.bytes lớn nhất trong 12h qua
json{"query":{"range":{"@timestamp":{"gte":"now-12h"}}},"_source":["@timestamp","source.ip","destination.ip","network.bytes","source.user.name","rule.name"],"sort":[{"network.bytes":"desc"}],"size":10}
Câu 32: User nào có tổng packets gửi đi (source.packets) nhiều nhất?
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}},{"exists":{"field":"source.user.name"}}]}},"aggs":{"top_users":{"terms":{"field":"source.user.name","size":10,"order":{"total_packets":"desc"}},"aggs":{"total_packets":{"sum":{"field":"source.packets"}}}}},"size":0}
Câu 33: Tìm các sessions có packet loss > 10%
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}}],"must":{"script":{"script":{"source":"doc['fortinet.firewall.packetloss'].value > 10"}}}}},"_source":["@timestamp","source.ip","destination.ip","fortinet.firewall.packetloss"],"sort":[{"fortinet.firewall.packetloss":"desc"}],"size":50}
Câu 34: Average bytes per session trong 24h qua là bao nhiêu?
json{"query":{"range":{"@timestamp":{"gte":"now-24h"}}},"aggs":{"avg_bytes":{"avg":{"field":"network.bytes"}}},"size":0}
Câu 35: Kết nối nào có destination.bytes lớn hơn source.bytes (download > upload)?
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-6h"}}}],"must":{"script":{"script":{"source":"doc['destination.bytes'].value > doc['source.bytes'].value"}}}}},"_source":["@timestamp","source.ip","destination.ip","source.bytes","destination.bytes"],"sort":[{"destination.bytes":"desc"}],"size":50}
Câu 36: Tổng bandwidth sử dụng trong 1 giờ qua là bao nhiêu?
json{"query":{"range":{"@timestamp":{"gte":"now-1h"}}},"aggs":{"total_bandwidth":{"sum":{"field":"network.bytes"}}},"size":0}
Câu 37: Top 10 connections có ratio bytes/packets cao nhất (large packets)
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}},{"range":{"network.packets":{"gt":0}}}]}},"aggs":{"top_connections":{"terms":{"field":"source.ip","size":10,"order":{"bytes_per_packet":"desc"}},"aggs":{"total_bytes":{"sum":{"field":"network.bytes"}},"total_packets":{"sum":{"field":"network.packets"}},"bytes_per_packet":{"bucket_script":{"buckets_path":{"bytes":"total_bytes","packets":"total_packets"},"script":"params.bytes / params.packets"}}}}},"size":0}
Câu 38: Có session nào có duration < 1 giây nhưng bytes > 1MB? (suspicious)
json{"query":{"bool":{"filter":[{"range":{"event.duration":{"lt":1000000000}}},{"range":{"network.bytes":{"gt":1048576}}},{"range":{"@timestamp":{"gte":"now-24h"}}}]}},"_source":["@timestamp","source.ip","destination.ip","event.duration","network.bytes","rule.name"],"sort":[{"network.bytes":"desc"}],"size":50}
Câu 39: User nào có average session duration dài nhất?
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}},{"exists":{"field":"source.user.name"}},{"exists":{"field":"event.duration"}}]}},"aggs":{"by_user":{"terms":{"field":"source.user.name","size":10,"order":{"avg_duration":"desc"}},"aggs":{"avg_duration":{"avg":{"field":"event.duration"}}}}},"size":0}
Câu 40: Phân tích distribution của network.bytes (histogram)
json{"query":{"range":{"@timestamp":{"gte":"now-24h"}}},"aggs":{"bytes_distribution":{"histogram":{"field":"network.bytes","interval":1048576}}},"size":0}
E. DEVICE & ENDPOINT ANALYSIS (10 câu)
Câu 41: Có bao nhiêu MacBooks đang kết nối trong mạng?
json{"query":{"bool":{"filter":[{"term":{"fortinet.firewall.srchwversion":"MacBook Pro"}},{"range":{"@timestamp":{"gte":"now-24h"}}}]}},"aggs":{"unique_macbooks":{"cardinality":{"field":"source.ip"}}},"size":0}
Câu 42: Liệt kê tất cả các OS versions đang được sử dụng
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}},{"exists":{"field":"fortinet.firewall.srcswversion"}}]}},"aggs":{"os_versions":{"terms":{"field":"fortinet.firewall.srcswversion","size":20}}},"size":0}
Câu 43: Device nào có nhiều source MAC addresses khác nhau? (MAC spoofing?)
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}},{"exists":{"field":"host.name"}}]}},"aggs":{"by_device":{"terms":{"field":"host.name","size":20,"order":{"unique_macs":"desc"}},"aggs":{"unique_macs":{"cardinality":{"field":"source.mac"}}}}},"size":0}
Câu 44: Tìm các Windows devices với OS version cũ (< Windows 10)
json{"query":{"bool":{"filter":[{"term":{"fortinet.firewall.osname":"Windows"}},{"range":{"@timestamp":{"gte":"now-24h"}}}],"must_not":[{"wildcard":{"fortinet.firewall.srcswversion":"*10*"}},{"wildcard":{"fortinet.firewall.srcswversion":"*11*"}}]}},"_source":["@timestamp","source.ip","fortinet.firewall.osname","fortinet.firewall.srcswversion","host.name"],"sort":[{"@timestamp":"desc"}],"size":50}
Câu 45: Top 10 device types (Laptop/Desktop/Mobile) có traffic nhiều nhất
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}},{"exists":{"field":"fortinet.firewall.devtype"}}]}},"aggs":{"top_device_types":{"terms":{"field":"fortinet.firewall.devtype","size":10,"order":{"total_bytes":"desc"}},"aggs":{"total_bytes":{"sum":{"field":"network.bytes"}}}}},"size":0}
Câu 46: Có device nào đổi IP address trong 6h qua không?
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-6h"}}},{"exists":{"field":"host.name"}}]}},"aggs":{"by_hostname":{"terms":{"field":"host.name","size":50},"aggs":{"unique_ips":{"cardinality":{"field":"source.ip"}},"ip_change":{"bucket_selector":{"buckets_path":{"ips":"unique_ips"},"script":"params.ips > 1"}}}}},"size":0}
Câu 47: Devices từ vendor Apple chiếm bao nhiêu phần trăm?
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}},{"exists":{"field":"fortinet.firewall.srchwvendor"}}]}},"aggs":{"total_devices":{"cardinality":{"field":"source.ip"}},"apple_devices":{"filter":{"term":{"fortinet.firewall.srchwvendor":"Apple"}},"aggs":{"count":{"cardinality":{"field":"source.ip"}}}}},"size":0}
Câu 48: Tìm các unidentified devices (không có devtype)
json{"query":{"bool":{"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}}],"must_not":[{"exists":{"field":"fortinet.firewall.devtype"}}]}},"_source":["@timestamp","source.ip","source.mac","host.name"],"sort":[{"@timestamp":"desc"}],"size":50}
Câu 49: Host nào có nhiều failed connections nhất?
json{"query":{"bool":{"filter":[{"term":{"event.outcome":"failure"}},{"range":{"@timestamp":{"gte":"now-24h"}}}]}},"aggs":{"top_failed_hosts":{"terms":{"field":"host.name","size":10}}},"size":0}
Câu 50: Liệt kê các container hoặc cloud instances
json{"query":{"bool":{"should":[{"exists":{"field":"container.id"}},{"exists":{"field":"cloud.instance.id"}}],"minimum_should_match":1,"filter":[{"range":{"@timestamp":{"gte":"now-24h"}}}]}},"_source":["@timestamp","container.id","container.name","cloud.instance.id","cloud.provider","source.ip"],"sort":[{"@timestamp":"desc"}],"size":50}