{
  "query": {
    "bool": {
      "filter": [{ "range": { "@timestamp": { "gte": "now-4h" } } }, { "term": { "fortinet.firewall.action": "accept" } }]
    }
  },
  "aggs": {
    "rule_analysis": {
      "terms": { "field": "rule.name", "size": 10 },
      "aggs": {
        "avg_duration": {
          "avg": { "field": "event.duration" }
        },
        "traffic_volume": {
          "sum": { "field": "network.bytes" }
        }
      }
    }
  },
  "size": 0
}
